!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase)}(this,function(Rv){"use strict";try{(function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e,l,n,r=t(Rv),i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function o(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function m(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function w(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function u(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(n=l=l||{})[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT";function a(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=f[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,u(["["+i+"]  "+t.name+":"],n))}}var c={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},h=l.INFO,f=((e={})[l.DEBUG]="log",e[l.VERBOSE]="log",e[l.INFO]="info",e[l.WARN]="warn",e[l.ERROR]="error",e),p=(Object.defineProperty(d.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),d.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?c[t]:t},Object.defineProperty(d.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),d.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.DEBUG],t)),this._logHandler.apply(this,u([this,l.DEBUG],t))},d.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.VERBOSE],t)),this._logHandler.apply(this,u([this,l.VERBOSE],t))},d.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.INFO],t)),this._logHandler.apply(this,u([this,l.INFO],t))},d.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.WARN],t)),this._logHandler.apply(this,u([this,l.WARN],t))},d.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.ERROR],t)),this._logHandler.apply(this,u([this,l.ERROR],t))},d);function d(t){this.name=t,this._logLevel=h,this._logHandler=a,this._userLogHandler=null}function v(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var y,g="FirebaseError",b=(o(E,y=Error),E);function E(t,e){var n=y.call(this,e)||this;return n.code=t,n.name=g,Object.setPrototypeOf(n,E.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,I.prototype.create),n}var I=(T.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(_,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",c=new b(o,a),h=0,f=Object.keys(i);h<f.length;h++){var l=f[h];"_"!==l.slice(-1)&&(l in c&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),c[l]=i[l])}return c},T);function T(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var _=/\{\$([^}]+)}/g,N=function(t,e){return(N=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function A(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var S,D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},x={},O=D||self;function R(){}function k(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function L(t){var e=k(t);return"array"==e||"object"==e&&"number"==typeof t.length}function P(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var U="closure_uid_"+(1e9*Math.random()>>>0),C=0;function M(t,e,n){return t.call.apply(t.bind,arguments)}function V(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function F(t,e,n){return(F=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?M:V).apply(null,arguments)}function j(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var q=Date.now;function B(t,e){function n(){}n.prototype=e.prototype,t.S=e.prototype,t.prototype=new n,t.prototype.constructor=t}function z(){this.j=this.j,this.i=this.i}z.prototype.j=!1,z.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,U)&&t[U]||(t[U]=++C))},z.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var G=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},H=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function W(t){return Array.prototype.concat.apply([],arguments)}function K(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Q(t){return/^[\s\xa0]*$/.test(t)}var Y,X=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function J(t,e){return-1!=t.indexOf(e)}function Z(t,e){return t<e?-1:e<t?1:0}t:{var $=O.navigator;if($){var tt=$.userAgent;if(tt){Y=tt;break t}}Y=""}function et(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function nt(t){var e,n={};for(e in t)n[e]=t[e];return n}var rt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function it(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<rt.length;o++)n=rt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function ot(t){return ot[" "](t),t}ot[" "]=R;var st,ut,at=J(Y,"Opera"),ct=J(Y,"Trident")||J(Y,"MSIE"),ht=J(Y,"Edge"),ft=ht||ct,lt=J(Y,"Gecko")&&!(J(Y.toLowerCase(),"webkit")&&!J(Y,"Edge"))&&!(J(Y,"Trident")||J(Y,"MSIE"))&&!J(Y,"Edge"),pt=J(Y.toLowerCase(),"webkit")&&!J(Y,"Edge");function dt(){var t=O.document;return t?t.documentMode:void 0}t:{var vt="",yt=(ut=Y,lt?/rv:([^\);]+)(\)|;)/.exec(ut):ht?/Edge\/([\d\.]+)/.exec(ut):ct?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ut):pt?/WebKit\/(\S+)/.exec(ut):at?/(?:Version)[ \/]?(\S+)/.exec(ut):void 0);if(yt&&(vt=yt?yt[1]:""),ct){var gt=dt();if(null!=gt&&gt>parseFloat(vt)){st=String(gt);break t}}st=vt}var mt={};function wt(u){return t=u,e=function(){for(var t=0,e=X(String(st)).split("."),n=X(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=Z(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||Z(0==o[2].length,0==s[2].length)||Z(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=mt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var bt=O.document&&ct?dt()||(parseInt(st,10)||void 0):void 0,Et=!ct||9<=Number(bt),It=ct&&!wt("9"),Tt=function(){if(!O.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{O.addEventListener("test",R,e),O.removeEventListener("test",R,e)}catch(t){}return t}();function _t(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Nt(t,e){if(_t.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(lt){t:{try{ot(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:At[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}_t.prototype.b=function(){this.defaultPrevented=!0},B(Nt,_t);var At={2:"touch",3:"pen",4:"mouse"};Nt.prototype.b=function(){Nt.S.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,It)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var St="closure_listenable_"+(1e6*Math.random()|0),Dt=0;function xt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++Dt,this.Y=this.Z=!1}function Ot(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Rt(t){this.src=t,this.a={},this.b=0}function kt(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=G(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(Ot(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function Lt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}Rt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Lt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new xt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Pt="closure_lm_"+(1e6*Math.random()|0),Ut={};function Ct(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Gt(r);return e&&e[St]?e.wa(n,r,P(i)?!!i.capture:!!i,o):Mt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ct(t,e[o],n,r,i);return null}return n=Gt(n),t&&t[St]?t.va(e,n,P(r)?!!r.capture:!!r,i):Mt(t,e,n,!1,r,i)}function Mt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=P(i)?!!i.capture:!!i;if(s&&!Et)return null;var u,a,c=Bt(t);if(c||(t[Pt]=c=new Rt(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(u=qt,r=a=Et?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)Tt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ft(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Vt(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[St]?kt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ft(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Bt(e))?(kt(n,t),0==n.b&&(n.src=null,e[Pt]=null)):Ot(t)))}function Ft(t){return t in Ut?Ut[t]:Ut[t]="on"+t}function jt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Vt(t),n.call(r,e)}function qt(t,e){if(t.Y)return!0;if(Et)return jt(t,new Nt(e,this));if(!e)t:{e=["window","event"];for(var n=O,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return jt(t,e=new Nt(e,this))}function Bt(t){return(t=t[Pt])instanceof Rt?t:null}var zt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Gt(e){return"function"==k(e)?e:(e[zt]||(e[zt]=function(t){return e.handleEvent(t)}),e[zt])}function Ht(){z.call(this),this.c=new Rt(this),(this.J=this).C=null}function Wt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.Y&&a.capture==n&&(s=a.listener,u=a.ca||a.src,a.Z&&kt(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}B(Ht,z),Ht.prototype[St]=!0,(S=Ht.prototype).addEventListener=function(t,e,n,r){Ct(this,t,e,n,r)},S.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=P(i)?!!i.capture:!!i,r=Gt(r),e&&e[St]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Lt(s=e.a[n],r,i,o))&&(Ot(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Bt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Lt(n,r,i,o)),(r=-1<e?n[e]:null)&&Vt(r))}(this,t,e,n,r)},S.dispatchEvent=function(t){var e,n=this.C;if(n)for(e=[];n;n=n.C)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t?t=new _t(t,n):t instanceof _t?t.target=t.target||n:(s=t,it(t=new _t(r,n),s)),s=!0,e)for(var i=e.length-1;0<=i;i--)var o=t.a=e[i],s=Wt(o,r,!0,t)&&s;if(s=Wt(o=t.a=n,r,!0,t)&&s,s=Wt(o,r,!1,t)&&s,e)for(i=0;i<e.length;i++)s=Wt(o=t.a=e[i],r,!1,t)&&s;return s},S.G=function(){if(Ht.S.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Ot(n[r]);delete e.a[t],e.b--}}this.C=null},S.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},S.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Kt=O.JSON.stringify;function Qt(){this.b=this.a=null}var Yt,Xt=(Jt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Jt(function(){return new Zt},function(t){t.reset()},100));function Jt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Zt(){this.next=this.b=this.a=null}function $t(t,e){var n;Yt||(n=O.Promise.resolve(void 0),Yt=function(){n.then(ne)}),te||(Yt(),te=!0),ee.add(t,e)}Qt.prototype.add=function(t,e){var n=Xt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Zt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var te=!(Zt.prototype.reset=function(){this.next=this.b=this.a=null}),ee=new Qt;function ne(){for(var t,e,n;n=e=void 0,n=null,(e=ee).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){O.setTimeout(function(){throw t},0)}(t)}var r=Xt;r.g(t),r.b<r.f&&(r.b++,t.next=r.a,r.a=t)}te=!1}function re(t,e){Ht.call(this),this.b=t||1,this.a=e||O,this.f=F(this.Ya,this),this.g=q()}function ie(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function oe(t,e,n){if("function"==k(t))n&&(t=F(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=F(t.handleEvent,t)}return 2147483647<Number(e)?-1:O.setTimeout(t,e||0)}B(re,Ht),(S=re.prototype).aa=!1,S.M=null,S.Ya=function(){var t;this.aa&&(0<(t=q()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(ie(this),this.start())))},S.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=q())},S.G=function(){re.S.G.call(this),ie(this),delete this.a};var se,ue,ae,ce=(N(ue=fe,ae=se=z),ue.prototype=null===ae?Object.create(ae):(he.prototype=ae.prototype,new he),fe.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=oe(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},fe.prototype.G=function(){se.prototype.G.call(this),this.a&&(O.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},fe);function he(){this.constructor=ue}function fe(t,e,n){var r=se.call(this)||this;return r.g=null!=n?t.bind(n):t,r.h=e,r.b=null,r.c=!1,r.a=null,r}function le(t){z.call(this),this.b=t,this.a={}}B(le,z);var pe=[];function de(t,e,n,r){Array.isArray(n)||(n&&(pe[0]=n.toString()),n=pe);for(var i=0;i<n.length;i++){var o=Ct(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ve(t){et(t.a,function(t,e){this.a.hasOwnProperty(e)&&Vt(t)},t),t.a={}}function ye(){this.a=!0}function ge(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Kt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}le.prototype.G=function(){le.S.G.call(this),ve(this)},le.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ye.prototype.info=function(){};var me=null;function we(){return me=me||new Ht}function be(t){_t.call(this,"serverreachability",t)}function Ee(t){var e=we();e.dispatchEvent(new be(e))}function Ie(t){_t.call(this,"statevent",t)}function Te(t){var e=we();e.dispatchEvent(new Ie(e))}function _e(t){_t.call(this,"timingevent",t)}function Ne(t,e){if("function"!=k(t))throw Error("Fn must not be null and must be a function");return O.setTimeout(function(){t()},e)}B(be,_t),B(Ie,_t),B(_e,_t);var Ae={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},Se={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function De(){}function xe(t){var e;return(e=t.a)||(e=t.a={}),e}function Oe(){}De.prototype.a=null;var Re,ke={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function Le(){_t.call(this,"d")}function Pe(){_t.call(this,"c")}function Ue(){}function Ce(t,e,n,r){this.g=t,this.c=e,this.f=n,this.T=r||1,this.J=new le(this),this.P=Me,t=ft?125:void 0,this.R=new re(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}B(Le,_t),B(Pe,_t),B(Ue,De),Re=new Ue;var Me=45e3,Ve={},Fe={};function je(t,e,n){t.H=1,t.i=an(en(e)),t.j=n,t.I=!0,qe(t,null)}function qe(t,e){t.u=q(),ze(t),t.l=en(t.i);var s,u,a,c,h,f,n=t.l,r=t.T;Array.isArray(r)||(r=[String(r)]),En(n.b,"t",r),t.D=0,t.a=dr(t.g,t.g.C?e:null),0<t.O&&(t.F=new ce(F(t.Ca,t,t.a),t.O)),de(t.J,t.a,"readystatechange",t.Wa),e=t.B?nt(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),Ee(1),s=t.c,u=t.m,a=t.l,c=t.f,h=t.T,f=t.j,s.info(function(){if(s.a)if(f)for(var t="",e=f.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=f;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+u+"\n"+a+"\n"+t})}function Be(t,e,n){for(var r,i,o,s,u=!0;!t.A&&t.D<n.length;){var a=(i=n,s=o=void 0,o=(r=t).D,-1==(s=i.indexOf("\n",o))?Fe:(o=Number(i.substring(o,s)),isNaN(o)?Ve:(s+=1)+o>i.length?Fe:(i=i.substr(s,o),r.D=s+o,i)));if(a==Fe){4==e&&(t.h=4,Te(14),u=!1),ge(t.c,t.f,null,"[Incomplete Response]");break}if(a==Ve){t.h=4,Te(15),ge(t.c,t.f,n,"[Invalid Chunk]"),u=!1;break}ge(t.c,t.f,a,null),Qe(t,a)}4==e&&0==n.length&&(t.h=1,Te(16),u=!1),t.b=t.b&&u,u?0<n.length&&!t.W&&(t.W=!0,(e=t.g).a==t&&e.V&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),sr(e),e.F=!0)):(ge(t.c,t.f,n,"[Invalid Chunked Response]"),Ke(t),We(t))}function ze(t){t.U=q()+t.P,Ge(t,t.P)}function Ge(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Ne(F(t.Ua,t),e)}function He(t){t.o&&(O.clearTimeout(t.o),t.o=null)}function We(t){0==t.g.v||t.A||cr(t.g,t)}function Ke(t){He(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,ie(t.R),ve(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Qe(t,e){try{var n,r,i,o,s,u,a,c,h,f,l,p=t.g;if(0!=p.v&&(p.a==t||Dn(p.b,t)))if(p.I=t.N,!t.C&&Dn(p.b,t)&&3==p.v){try{var d=p.ka.a.parse(e)}catch(t){d=null}if(Array.isArray(d)&&3==d.length){var v=d;if(0==v[0]){t:if(!p.j){if(p.a){if(!(p.a.u+3e3<t.u))break t;ar(p),Jn(p)}or(p),Te(18)}}else p.oa=v[1],0<p.oa-p.P&&v[2]<37500&&p.H&&0==p.o&&!p.m&&(p.m=Ne(F(p.Ra,p),6e3));if(Sn(p.b)<=1&&p.ea){try{p.ea()}catch(t){}p.ea=void 0}}else fr(p,11)}else if(!t.C&&p.a!=t||ar(p),!Q(e))for(e=d=p.ka.a.parse(e),d=0;d<e.length;d++){v=e[d],p.P=v[0],v=v[1],2==p.v?"c"==v[0]?(p.J=v[1],p.ga=v[2],null!=(n=v[3])&&(p.ha=n,p.c.info("VER="+p.ha)),null!=(r=v[4])&&(p.pa=r,p.c.info("SVER="+p.pa)),null!=(i=v[5])&&"number"==typeof i&&0<i&&(o=1.5*i,p.D=o,p.c.info("backChannelRequestTimeoutMs_="+o)),o=p,(s=t.a)&&(!(u=s.a?s.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(a=o.b).a&&(J(u,"spdy")||J(u,"quic")||J(u,"h2"))&&(a.f=a.g,a.a=new Set,a.b&&(xn(a,a.b),a.b=null)),!o.A||(c=s.a?s.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(o.na=c,un(o.B,o.A,c))),p.v=3,p.f&&p.f.ta(),p.V&&(p.N=q()-t.u,p.c.info("Handshake RTT: "+p.N+"ms")),h=t,(o=p).la=pr(o,o.C?o.ga:null,o.fa),h.C?(On(o.b,h),f=h,(l=o.D)&&f.setTimeout(l),f.o&&(He(f),ze(f)),o.a=h):ir(o),0<p.g.length&&tr(p)):"stop"!=v[0]&&"close"!=v[0]||fr(p,7):3==p.v&&("stop"==v[0]||"close"==v[0]?"stop"==v[0]?fr(p,7):Xn(p):"noop"!=v[0]&&p.f&&p.f.sa(v),p.o=0)}Ee(4)}catch(t){}}function Ye(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(L(t)||"string"==typeof t)H(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(L(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(L(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Xe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Xe)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Je(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ze(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)Ze(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Ze(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(S=Ce.prototype).setTimeout=function(t){this.P=t},S.Wa=function(t){t=t.target;var e=this.F;e&&3==Wn(t)?e.f():this.Ca(t)},S.Ca=function(t){try{if(t==this.a)t:{var e=Wn(this.a),n=this.a.ua(),r=this.a.X();if(!(e<3||3==e&&!ft&&!this.a.$())){this.A||4!=e||7==n||Ee(8==n||r<=0?3:2),He(this);var i=this.a.X();this.N=i;var o=this.a.$();if(this.b=200==i,c=this.c,h=this.m,f=this.l,l=this.f,p=this.T,d=e,v=i,c.info(function(){return"XMLHTTP RESP ("+l+") [ attempt "+p+"]: "+h+"\n"+f+"\n"+d+" "+v}),this.b){if(this.V&&!this.C){e:{if(this.a){var s,u=this.a;if((s=u.a?u.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Q(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.h=3,Te(12),Ke(this),We(this);break t}ge(this.c,this.f,a,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Qe(this,a)}this.I?(Be(this,e,o),ft&&this.b&&3==e&&(de(this.J,this.R,"tick",this.Va),this.R.start())):(ge(this.c,this.f,o,null),Qe(this,o)),4==e&&Ke(this),this.b&&!this.A&&(4==e?cr(this.g,this):(this.b=!1,ze(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,Te(12)):(this.h=0,Te(13)),Ke(this),We(this)}}}catch(t){}var c,h,f,l,p,d,v},S.Va=function(){var t,e;this.a&&(t=Wn(this.a),e=this.a.$(),this.D<e.length&&(He(this),Be(this,t,e),this.b&&4!=t&&ze(this)))},S.cancel=function(){this.A=!0,Ke(this)},S.Ua=function(){this.o=null;var t,e,n=q();0<=n-this.U?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(Ee(3),Te(17)),Ke(this),this.h=2,We(this)):Ge(this,this.U-n)},(S=Xe.prototype).K=function(){Je(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},S.L=function(){return Je(this),this.a.concat()},S.get=function(t,e){return Ze(this.b,t)?this.b[t]:e},S.set=function(t,e){Ze(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},S.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var $e=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function tn(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof tn?(this.a=void 0!==e?e:t.a,nn(this,t.f),this.j=t.j,rn(this,t.c),on(this,t.h),this.g=t.g,e=t.b,(n=new gn).c=e.c,e.a&&(n.a=new Xe(e.a),n.b=e.b),sn(this,n),this.i=t.i):t&&(n=String(t).match($e))?(this.a=!!e,nn(this,n[1]||"",!0),this.j=cn(n[2]||""),rn(this,n[3]||"",!0),on(this,n[4]),this.g=cn(n[5]||"",!0),sn(this,n[6]||"",!0),this.i=cn(n[7]||"")):(this.a=!!e,this.b=new gn(null,this.a))}function en(t){return new tn(t)}function nn(t,e,n){t.f=n?cn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function rn(t,e,n){t.c=n?cn(e,!0):e}function on(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function sn(t,e,n){var r,i;e instanceof gn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(mn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(wn(this,e),En(this,n,t))},r)),r.f=i):(n||(e=hn(e,vn)),t.b=new gn(e,t.a))}function un(t,e,n){t.b.set(e,n)}function an(t){return un(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)),t}function cn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function hn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,fn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function fn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}tn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(hn(e,ln,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(hn(e,ln,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(hn(n,"/"==n.charAt(0)?dn:pn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",hn(n,yn)),t.join("")};var ln=/[#\/\?@]/g,pn=/[#\?:]/g,dn=/[#\?]/g,vn=/[#\?@]/g,yn=/#/g;function gn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function mn(n){n.a||(n.a=new Xe,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function wn(t,e){mn(t),e=In(t,e),Ze(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ze((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Je(t)))}function bn(t,e){return mn(t),e=In(t,e),Ze(t.a.b,e)}function En(t,e,n){wn(t,e),0<n.length&&(t.c=null,t.a.set(In(t,e),K(n)),t.b+=n.length)}function In(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function Tn(t,e){this.b=t,this.a=e}function _n(t){this.g=t||Nn,t=O.PerformanceNavigationTiming?0<(t=O.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(O.ia&&O.ia.ya&&O.ia.ya()&&O.ia.ya().qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(S=gn.prototype).add=function(t,e){mn(this),this.c=null,t=In(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},S.forEach=function(n,r){mn(this),this.a.forEach(function(t,e){H(t,function(t){n.call(r,t,e,this)},this)},this)},S.L=function(){mn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},S.K=function(t){mn(this);var e=[];if("string"==typeof t)bn(this,t)&&(e=W(e,this.a.get(In(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=W(e,t[n])}return e},S.set=function(t,e){return mn(this),this.c=null,bn(this,t=In(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},S.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},S.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var Nn=10;function An(t){return t.b||t.a&&t.a.size>=t.f}function Sn(t){return t.b?1:t.a?t.a.size:0}function Dn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function xn(t,e){t.a?t.a.add(e):t.b=e}function On(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Rn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return K(t.c);var r=t.c;try{for(var i=A(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function kn(){}function Ln(){this.a=new kn}function Pn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}_n.prototype.cancel=function(){var e,t;if(this.c=Rn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=A(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},kn.prototype.stringify=function(t){return O.JSON.stringify(t,void 0)},kn.prototype.parse=function(t){return O.JSON.parse(t,void 0)};var Un=O.JSON.parse;function Cn(t){Ht.call(this),this.headers=new Xe,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Mn,this.D=this.F=!1}B(Cn,Ht);var Mn="",Vn=/^https?$/i,Fn=["POST","PUT"];function jn(t){return"content-type"==t.toLowerCase()}function qn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Bn(t),Gn(t)}function Bn(t){t.u||(t.u=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function zn(t){if(t.b&&void 0!==x&&(!t.s[1]||4!=Wn(t)||2!=t.X()))if(t.l&&4==Wn(t))oe(t.za,0,t);else if(t.dispatchEvent("readystatechange"),4==Wn(t)){t.b=!1;try{var e,n,r,i,o=t.X();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.B).match($e)[1]||null)&&O.self&&O.self.location&&(i=(r=O.self.location.protocol).substr(0,r.length-1)),n=!Vn.test(i?i.toLowerCase():"")),e=n),e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<Wn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.X()+"]",Bn(t)}}finally{Gn(t)}}}function Gn(t,e){if(t.a){Hn(t);var n=t.a,r=t.s[0]?R:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Hn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(O.clearTimeout(t.m),t.m=null)}function Wn(t){return t.a?t.a.readyState:0}function Kn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",et(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):un(t,e,n))}function Qn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Yn(t){this.pa=0,this.g=[],this.c=new ye,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=Qn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=Qn("baseRetryDelayMs",5e3,t),this.Ma=Qn("retryDelaySeedMs",1e4,t),this.Ja=Qn("forwardChannelMaxRetries",2,t),this.ma=Qn("forwardChannelRequestTimeoutMs",2e4,t),this.Ka=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new _n(t&&t.concurrentRequestLimit),this.ka=new Ln,this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function Xn(t){var e,n;Zn(t),3==t.v&&(e=t.R++,un(n=en(t.B),"SID",t.J),un(n,"RID",e),un(n,"TYPE","terminate"),nr(t,n),(e=new Ce(t,t.c,e,void 0)).H=2,e.i=an(en(n)),n=!1,O.navigator&&O.navigator.sendBeacon&&(n=O.navigator.sendBeacon(e.i.toString(),"")),!n&&O.Image&&((new Image).src=e.i,n=!0),n||(e.a=dr(e.g,null),e.a.ba(e.i)),e.u=q(),ze(e)),lr(t)}function Jn(t){t.a&&(sr(t),t.a.cancel(),t.a=null)}function Zn(t){Jn(t),t.j&&(O.clearTimeout(t.j),t.j=null),ar(t),t.b.cancel(),t.h&&("number"==typeof t.h&&O.clearTimeout(t.h),t.h=null)}function $n(t,e){t.g.push(new Tn(t.La++,e)),3==t.v&&tr(t)}function tr(t){An(t.b)||t.h||(t.h=!0,$t(t.Ba,t),t.u=0)}function er(t,e){var n=e?e.f:t.R++,r=en(t.B);un(r,"SID",t.J),un(r,"RID",n),un(r,"AID",t.P),nr(t,r),t.i&&t.l&&Kn(r,t.i,t.l),n=new Ce(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=rr(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),xn(t.b,n),je(n,r,e)}function nr(t,n){t.f&&Ye({},function(t,e){un(n,e,t)})}function rr(t,e,n){n=Math.min(t.g.length,n);var r=t.f?F(t.f.Ha,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if((c-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{!function(t,r,e){var i=e||"";try{Ye(t,function(t,e){var n=t;P(t)&&(n=Kt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function ir(t){t.a||t.j||(t.U=1,$t(t.Aa,t),t.o=0)}function or(t){return!(t.a||t.j||3<=t.o)&&(t.U++,t.j=Ne(F(t.Aa,t),hr(t,t.o)),t.o++,1)}function sr(t){null!=t.s&&(O.clearTimeout(t.s),t.s=null)}function ur(t){t.a=new Ce(t,t.c,"rpc",t.U),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=en(t.la);un(e,"RID","rpc"),un(e,"SID",t.J),un(e,"CI",t.H?"0":"1"),un(e,"AID",t.P),nr(t,e),un(e,"TYPE","xmlhttp"),t.i&&t.l&&Kn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=an(en(e)),n.j=null,n.I=!0,qe(n,t)}function ar(t){null!=t.m&&(O.clearTimeout(t.m),t.m=null)}function cr(t,e){var n,r=null;if(t.a==e){ar(t),sr(t),t.a=null;var i=2}else{if(!Dn(t.b,e))return;r=e.s,On(t.b,e),i=1}if(t.I=e.N,0!=t.v)if(e.b){1==i?(r=e.j?e.j.length:0,e=q()-e.u,n=t.u,(i=we()).dispatchEvent(new _e(i)),tr(t)):ir(t)}else if(3==(n=e.h)||0==n&&0<t.I||!(1==i&&function(t,e){if(!(Sn(t.b)>=t.b.f-(t.h?1:0))){if(t.h)return t.g=e.s.concat(t.g),1;if(!(1==t.v||2==t.v||t.u>=(t.Ia?0:t.Ja)))return t.h=Ne(F(t.Ba,t,e),hr(t,t.u)),t.u++,1}}(t,e)||2==i&&or(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:fr(t,5);break;case 4:fr(t,10);break;case 3:fr(t,6);break;default:fr(t,2)}}function hr(t,e){var n=t.Fa+Math.floor(Math.random()*t.Ma);return t.f||(n*=2),n*e}function fr(t,e){var n,r,i,o,s,u;t.c.info("Error code "+e),2==e?(n=null,t.f&&(n=null),r=F(t.Xa,t),n||(n=new tn("//www.google.com/images/cleardot.gif"),O.location&&"http"==O.location.protocol||nn(n,"https"),an(n)),i=n.toString(),o=r,u=new ye,O.Image?((s=new Image).onload=j(Pn,u,s,"TestLoadImage: loaded",!0,o),s.onerror=j(Pn,u,s,"TestLoadImage: error",!1,o),s.onabort=j(Pn,u,s,"TestLoadImage: abort",!1,o),s.ontimeout=j(Pn,u,s,"TestLoadImage: timeout",!1,o),O.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=i):o(!1)):Te(2),t.v=0,t.f&&t.f.ra(e),lr(t),Zn(t)}function lr(t){t.v=0,t.I=-1,t.f&&(0==Rn(t.b).length&&0==t.g.length||(t.b.c.length=0,K(t.g),t.g.length=0),t.f.qa())}function pr(t,e,n){var r,i,o,s,u,a,c,h=(r=n)instanceof tn?en(r):new tn(r,void 0);return""!=h.c?(e&&rn(h,e+"."+h.c),on(h,h.h)):(i=O.location,o=i.protocol,s=e?e+"."+i.hostname:i.hostname,u=+i.port,a=n,c=new tn(null,void 0),o&&nn(c,o),s&&rn(c,s),u&&on(c,u),a&&(c.g=a),h=c),t.W&&et(t.W,function(t,e){un(h,e,t)}),e=t.A,n=t.na,e&&n&&un(h,e,n),un(h,"VER",t.ha),nr(t,h),h}function dr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Cn(t.Ka)).F=t.C,e}function vr(){}function yr(){if(ct&&!(10<=Number(bt)))throw Error("Environmental error: no available transport.")}function gr(t,e){Ht.call(this),this.a=new Yn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!Q(t)&&(this.a.i=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Q(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new br(this)}function mr(t){Le.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function wr(){Pe.call(this),this.status=1}function br(t){this.a=t}(S=Cn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?xe(this.H):xe(Re),this.a.onreadystatechange=F(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void qn(this,t)}t=n||"";var i,o=new Xe(this.headers);r&&Ye(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=jn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=O.FormData&&t instanceof O.FormData,0<=G(Fn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Hn(this),0<this.o&&((this.D=(i=this.a,ct&&wt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=F(this.xa,this)):this.m=oe(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){qn(this,t)}},S.xa=function(){void 0!==x&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},S.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Gn(this))},S.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Gn(this,!0)),Cn.S.G.call(this)},S.za=function(){this.j||(this.A||this.l||this.g?zn(this):this.Ta())},S.Ta=function(){zn(this)},S.X=function(){try{return 2<Wn(this)?this.a.status:-1}catch(t){return-1}},S.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},S.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Un(e)}},S.ua=function(){return this.h},S.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(S=Yn.prototype).ha=8,S.v=1,S.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ce(this,this.c,t,void 0),r=this.l;if(this.O&&(r?it(r=nt(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=rr(this,n,e),un(i=en(this.B),"RID",t),un(i,"CVER",22),this.A&&un(i,"X-HTTP-Session-Id",this.A),nr(this,i),this.i&&r&&Kn(i,this.i,r),xn(this.b,n),this.Ga&&un(i,"TYPE","init"),this.da?(un(i,"$req",e),un(i,"SID","null"),n.V=!0,je(n,i,null)):je(n,i,e),this.v=2}}else 3==this.v&&(t?er(this,t):0==this.g.length||An(this.b)||er(this))},S.Aa=function(){var t;this.j=null,ur(this),this.V&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=Ne(F(this.Sa,this),t))},S.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Jn(this),ur(this))},S.Ra=function(){null!=this.m&&(this.m=null,Jn(this),or(this),Te(19))},S.Xa=function(t){t?(this.c.info("Successfully pinged google.com"),Te(2)):(this.c.info("Failed to ping google.com"),Te(1))},(S=vr.prototype).ta=function(){},S.sa=function(){},S.ra=function(){},S.qa=function(){},S.Ha=function(){},yr.prototype.a=function(t,e){return new gr(t,e)},B(gr,Ht),(S=gr.prototype).addEventListener=function(t,e,n,r){gr.S.addEventListener.call(this,t,e,n,r)},S.removeEventListener=function(t,e,n,r){gr.S.removeEventListener.call(this,t,e,n,r)},S.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var t=this.a,e=this.l,n=this.b||void 0;Te(0),t.fa=e,t.W=n||{},t.H=t.T,t.B=pr(t,null,t.fa),tr(t)},S.close=function(){Xn(this.a)},S.Pa=function(t){var e;"string"==typeof t?((e={}).__data__=t,$n(this.a,e)):this.g?((e={}).__data__=Kt(t),$n(this.a,e)):$n(this.a,t)},S.G=function(){this.a.f=null,delete this.f,Xn(this.a),delete this.a,gr.S.G.call(this)},B(mr,Le),B(wr,Pe),B(br,vr),br.prototype.ta=function(){this.a.dispatchEvent("a")},br.prototype.sa=function(t){this.a.dispatchEvent(new mr(t))},br.prototype.ra=function(t){this.a.dispatchEvent(new wr)},br.prototype.qa=function(){this.a.dispatchEvent("b")},yr.prototype.createWebChannel=yr.prototype.a,gr.prototype.send=gr.prototype.Pa,gr.prototype.open=gr.prototype.Oa,Ae.NO_ERROR=0,Ae.TIMEOUT=8,Ae.HTTP_ERROR=6,Se.COMPLETE="complete",(Oe.EventType=ke).OPEN="a",ke.CLOSE="b",ke.ERROR="c",ke.MESSAGE="d",Ht.prototype.listen=Ht.prototype.va,Cn.prototype.listenOnce=Cn.prototype.wa,Cn.prototype.getLastError=Cn.prototype.Qa,Cn.prototype.getLastErrorCode=Cn.prototype.ua,Cn.prototype.getStatus=Cn.prototype.X,Cn.prototype.getResponseJson=Cn.prototype.Na,Cn.prototype.getResponseText=Cn.prototype.$,Cn.prototype.send=Cn.prototype.ba;var Er={createWebChannelTransport:function(){return new yr},ErrorCode:Ae,EventType:Se,WebChannel:Oe,XhrIo:Cn},Ir=Er.createWebChannelTransport,Tr=Er.ErrorCode,_r=Er.EventType,Nr=Er.WebChannel,Ar=Er.XhrIo,Sr=(Dr.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Dr.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Dr.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Dr);function Dr(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var xr,Or={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Rr=(o(Lr,xr=Error),Lr),kr=new p("@firebase/firestore");function Lr(t,e){var n=this;return(n=xr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function Pr(){return kr.logLevel}function Ur(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];kr.logLevel<=l.DEBUG&&(e=n.map(Vr),kr.debug.apply(kr,s(["Firestore (7.21.0): "+t],e)))}function Cr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];kr.logLevel<=l.ERROR&&(e=n.map(Vr),kr.error.apply(kr,s(["Firestore (7.21.0): "+t],e)))}function Mr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];kr.logLevel<=l.WARN&&(e=n.map(Vr),kr.warn.apply(kr,s(["Firestore (7.21.0): "+t],e)))}function Vr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Fr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (7.21.0) INTERNAL ASSERTION FAILED: "+t;throw Cr(e),new Error(e)}function jr(t){t||Fr()}function qr(t){var e,n=0;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n++;return n}function Br(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function zr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Gr,Hr,Wr=(Object.defineProperty(ti.prototype,"length",{get:function(){return this.t},enumerable:!1,configurable:!0}),ti.prototype.isEqual=function(t){return 0===ti.i(this,t)},ti.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof ti?t.forEach(function(t){e.push(t)}):e.push(t),this.o(e)},ti.prototype.limit=function(){return this.offset+this.length},ti.prototype.u=function(t){return t=void 0===t?1:t,this.o(this.segments,this.offset+t,this.length-t)},ti.prototype.h=function(){return this.o(this.segments,this.offset,this.length-1)},ti.prototype.l=function(){return this.segments[this.offset]},ti.prototype._=function(){return this.get(this.length-1)},ti.prototype.get=function(t){return this.segments[this.offset+t]},ti.prototype.m=function(){return 0===this.length},ti.prototype.T=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ti.prototype.I=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ti.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},ti.prototype.A=function(){return this.segments.slice(this.offset,this.limit())},ti.i=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},ti),Kr=(o($r,Hr=Wr),$r.prototype.o=function(t,e,n){return new $r(t,e,n)},$r.prototype.R=function(){return this.A().join("/")},$r.prototype.toString=function(){return this.R()},$r.P=function(t){if(0<=t.indexOf("//"))throw new Rr(Or.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new $r(t.split("/").filter(function(t){return 0<t.length}))},$r.g=function(){return new $r([])},$r),Qr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Yr=(o(Zr,Gr=Wr),Zr.prototype.o=function(t,e,n){return new Zr(t,e,n)},Zr.V=function(t){return Qr.test(t)},Zr.prototype.R=function(){return this.A().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Zr.V(t)||(t="`"+t+"`"),t}).join(".")},Zr.prototype.toString=function(){return this.R()},Zr.prototype.p=function(){return 1===this.length&&"__name__"===this.get(0)},Zr.v=function(){return new Zr(["__name__"])},Zr.S=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Rr(Or.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Rr(Or.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Rr(Or.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Rr(Or.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Zr(e)},Zr.g=function(){return new Zr([])},Zr),Xr=(Jr.D=function(t){return new Jr(Kr.P(t))},Jr.C=function(t){return new Jr(Kr.P(t).u(5))},Jr.prototype.N=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Jr.prototype.isEqual=function(t){return null!==t&&0===Kr.i(this.path,t.path)},Jr.prototype.toString=function(){return this.path.toString()},Jr.i=function(t,e){return Kr.i(t.path,e.path)},Jr.F=function(t){return t.length%2==0},Jr.$=function(t){return new Jr(new Kr(t.slice()))},Jr);function Jr(t){this.path=t}function Zr(){return null!==Gr&&Gr.apply(this,arguments)||this}function $r(){return null!==Hr&&Hr.apply(this,arguments)||this}function ti(t,e,n){void 0===e?e=0:e>t.length&&Fr(),void 0===n?n=t.length-e:n>t.length-e&&Fr(),this.segments=t,this.offset=e,this.t=n}function ei(t,e){if(0!==e.length)throw new Rr(Or.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+wi(e.length,"argument")+".")}function ni(t,e,n){if(e.length!==n)throw new Rr(Or.INVALID_ARGUMENT,"Function "+t+"() requires "+wi(n,"argument")+", but was called with "+wi(e.length,"argument")+".")}function ri(t,e,n){if(e.length<n)throw new Rr(Or.INVALID_ARGUMENT,"Function "+t+"() requires at least "+wi(n,"argument")+", but was called with "+wi(e.length,"argument")+".")}function ii(t,e,n,r){if(e.length<n||e.length>r)throw new Rr(Or.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+wi(e.length,"argument")+".")}function oi(t,e,n,r){fi(t,e,mi(n)+" argument",r)}function si(t,e,n,r){void 0!==r&&oi(t,e,n,r)}function ui(t,e,n,r){fi(t,e,n+" option",r)}function ai(t,e,n,r){void 0!==r&&ui(t,e,n,r)}function ci(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(pi(s))}var u=pi(n);throw new Rr(Or.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function hi(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Rr(Or.INVALID_ARGUMENT,"Invalid value "+pi(r)+" provided to function "+t+"() for its "+mi(n)+" argument. Acceptable values: "+e.join(", "));return r}function fi(t,e,n,r){if(!("object"===e?li(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=pi(r);throw new Rr(Or.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function li(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function pi(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Fr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function di(t,e,n){if(void 0===n)throw new Rr(Or.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+mi(e)+" argument, but it was undefined.")}function vi(n,t,r){Br(t,function(t,e){if(r.indexOf(t)<0)throw new Rr(Or.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function yi(t,e,n,r){var i=pi(r);return new Rr(Or.INVALID_ARGUMENT,"Function "+t+"() requires its "+mi(n)+" argument to be a "+e+", but it was: "+i)}function gi(t,e,n){if(n<=0)throw new Rr(Or.INVALID_ARGUMENT,"Function "+t+"() requires its "+mi(e)+" argument to be a positive number, but it was: "+n+".")}function mi(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function wi(t,e){return t+" "+e+(1===t?"":"s")}var bi=(Ei.k=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Ei);function Ei(){}function Ii(t,e){return t<e?-1:e<t?1:0}function Ti(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function _i(t){return t+"\0"}var Ni=(Ai.fromBase64String=function(t){return new Ai(atob(t))},Ai.fromUint8Array=function(t){return new Ai(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Ai.prototype.toBase64=function(){return t=this.M,btoa(t);var t},Ai.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.M)},Ai.prototype.O=function(){return 2*this.M.length},Ai.prototype.L=function(t){return Ii(this.M,t.M)},Ai.prototype.isEqual=function(t){return this.M===t.M},Ai);function Ai(t){this.M=t}Ni.B=new Ni("");var Si=(Di.fromBase64String=function(t){try{return new Di(Ni.fromBase64String(t))}catch(t){throw new Rr(Or.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+t)}},Di.fromUint8Array=function(t){return new Di(Ni.fromUint8Array(t))},Di.prototype.toBase64=function(){return this.q.toBase64()},Di.prototype.toUint8Array=function(){return this.q.toUint8Array()},Di.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},Di.prototype.isEqual=function(t){return this.q.isEqual(t.q)},Di);function Di(t){this.q=t}function xi(){if("undefined"==typeof Uint8Array)throw new Rr(Or.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Oi(){if("undefined"==typeof atob)throw new Rr(Or.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}function Ri(t,e,n,r,i){this.U=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var ki,Li=(o(Bi,ki=Si),Bi.fromBase64String=function(t){ni("Blob.fromBase64String",arguments,1),oi("Blob.fromBase64String","string",1,t),Oi();try{return new Bi(Ni.fromBase64String(t))}catch(t){throw new Rr(Or.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Bi.fromUint8Array=function(t){if(ni("Blob.fromUint8Array",arguments,1),xi(),!(t instanceof Uint8Array))throw yi("Blob.fromUint8Array","Uint8Array",1,t);return new Bi(Ni.fromUint8Array(t))},Bi.prototype.toBase64=function(){return ni("Blob.toBase64",arguments,0),Oi(),ki.prototype.toBase64.call(this)},Bi.prototype.toUint8Array=function(){return ni("Blob.toUint8Array",arguments,0),xi(),ki.prototype.toUint8Array.call(this)},Bi.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Bi),Pi=(Object.defineProperty(qi.prototype,"W",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),qi.prototype.isEqual=function(t){return t instanceof qi&&t.projectId===this.projectId&&t.database===this.database},qi.prototype.L=function(t){return Ii(this.projectId,t.projectId)||Ii(this.database,t.database)},qi),Ui=(ji.prototype.get=function(t){var e=this.j(t),n=this.G[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.K(s,t))return u}},ji.prototype.has=function(t){return void 0!==this.get(t)},ji.prototype.set=function(t,e){var n=this.j(t),r=this.G[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.K(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.G[n]=[[t,e]]},ji.prototype.delete=function(t){var e=this.j(t),n=this.G[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.K(n[r][0],t))return 1===n.length?delete this.G[e]:n.splice(r,1),!0;return!1},ji.prototype.forEach=function(u){Br(this.G,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},ji.prototype.m=function(){return zr(this.G)},ji),Ci=(Fi.now=function(){return Fi.fromMillis(Date.now())},Fi.fromDate=function(t){return Fi.fromMillis(t.getTime())},Fi.fromMillis=function(t){var e=Math.floor(t/1e3);return new Fi(e,1e6*(t-1e3*e))},Fi.prototype.toDate=function(){return new Date(this.toMillis())},Fi.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Fi.prototype.H=function(t){return this.seconds===t.seconds?Ii(this.nanoseconds,t.nanoseconds):Ii(this.seconds,t.seconds)},Fi.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Fi.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Fi.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},Fi.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Fi),Mi=(Vi.Y=function(t){return new Vi(t)},Vi.min=function(){return new Vi(new Ci(0,0))},Vi.prototype.L=function(t){return this.timestamp.H(t.timestamp)},Vi.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Vi.prototype.J=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Vi.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Vi.prototype.X=function(){return this.timestamp},Vi);function Vi(t){this.timestamp=t}function Fi(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Rr(Or.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Rr(Or.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Rr(Or.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Rr(Or.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function ji(t,e){this.j=t,this.K=e,this.G={}}function qi(t,e){this.projectId=t,this.database=e||"(default)"}function Bi(){return null!==ki&&ki.apply(this,arguments)||this}function zi(t){return null==t}function Gi(t){return-0===t&&1/t==-1/0}function Hi(t){return"number"==typeof t&&Number.isInteger(t)&&!Gi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Wi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Z=null};function Ki(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Wi(t,e,n,r,i,o,s)}function Qi(t){var e,n=t;return null===n.Z&&(e=n.path.R(),null!==n.collectionGroup&&(e+="|cg:"+n.collectionGroup),e+="|f:",e+=n.filters.map(function(t){return(e=t).field.R()+e.op.toString()+Yo(e.value);var e}).join(","),e+="|ob:",e+=n.orderBy.map(function(t){return(e=t).field.R()+e.dir;var e}).join(","),zi(n.limit)||(e+="|l:",e+=n.limit),n.startAt&&(e+="|lb:",e+=xa(n.startAt)),n.endAt&&(e+="|ub:",e+=xa(n.endAt)),n.Z=e),n.Z}function Yi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],o.op!==s.op||!o.field.isEqual(s.field)||!Ho(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ra(t.startAt,e.startAt)&&Ra(t.endAt,e.endAt)}function Xi(t){return Xr.F(t.path)&&null===t.collectionGroup&&0===t.filters.length}function Ji(t){this.count=t}var Zi,$i,to=(eo.prototype.nt=function(t){return new eo(this.target,this.targetId,this.tt,t,this.et,this.lastLimboFreeSnapshotVersion,this.resumeToken)},eo.prototype.st=function(t,e){return new eo(this.target,this.targetId,this.tt,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},eo.prototype.it=function(t){return new eo(this.target,this.targetId,this.tt,this.sequenceNumber,this.et,t,this.resumeToken)},eo);function eo(t,e,n,r,i,o,s){void 0===i&&(i=Mi.min()),void 0===o&&(o=Mi.min()),void 0===s&&(s=Ni.B),this.target=t,this.targetId=e,this.tt=n,this.sequenceNumber=r,this.et=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function no(t){switch(t){case Or.OK:return Fr(),0;case Or.CANCELLED:case Or.UNKNOWN:case Or.DEADLINE_EXCEEDED:case Or.RESOURCE_EXHAUSTED:case Or.INTERNAL:case Or.UNAVAILABLE:case Or.UNAUTHENTICATED:return;case Or.INVALID_ARGUMENT:case Or.NOT_FOUND:case Or.ALREADY_EXISTS:case Or.PERMISSION_DENIED:case Or.FAILED_PRECONDITION:case Or.ABORTED:case Or.OUT_OF_RANGE:case Or.UNIMPLEMENTED:case Or.DATA_LOSS:return 1;default:return Fr(),0}}function ro(t){if(void 0===t)return Cr("GRPC error has no .code"),Or.UNKNOWN;switch(t){case Zi.OK:return Or.OK;case Zi.CANCELLED:return Or.CANCELLED;case Zi.UNKNOWN:return Or.UNKNOWN;case Zi.DEADLINE_EXCEEDED:return Or.DEADLINE_EXCEEDED;case Zi.RESOURCE_EXHAUSTED:return Or.RESOURCE_EXHAUSTED;case Zi.INTERNAL:return Or.INTERNAL;case Zi.UNAVAILABLE:return Or.UNAVAILABLE;case Zi.UNAUTHENTICATED:return Or.UNAUTHENTICATED;case Zi.INVALID_ARGUMENT:return Or.INVALID_ARGUMENT;case Zi.NOT_FOUND:return Or.NOT_FOUND;case Zi.ALREADY_EXISTS:return Or.ALREADY_EXISTS;case Zi.PERMISSION_DENIED:return Or.PERMISSION_DENIED;case Zi.FAILED_PRECONDITION:return Or.FAILED_PRECONDITION;case Zi.ABORTED:return Or.ABORTED;case Zi.OUT_OF_RANGE:return Or.OUT_OF_RANGE;case Zi.UNIMPLEMENTED:return Or.UNIMPLEMENTED;case Zi.DATA_LOSS:return Or.DATA_LOSS;default:return Fr()}}($i=Zi=Zi||{})[$i.OK=0]="OK",$i[$i.CANCELLED=1]="CANCELLED",$i[$i.UNKNOWN=2]="UNKNOWN",$i[$i.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",$i[$i.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",$i[$i.NOT_FOUND=5]="NOT_FOUND",$i[$i.ALREADY_EXISTS=6]="ALREADY_EXISTS",$i[$i.PERMISSION_DENIED=7]="PERMISSION_DENIED",$i[$i.UNAUTHENTICATED=16]="UNAUTHENTICATED",$i[$i.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",$i[$i.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",$i[$i.ABORTED=10]="ABORTED",$i[$i.OUT_OF_RANGE=11]="OUT_OF_RANGE",$i[$i.UNIMPLEMENTED=12]="UNIMPLEMENTED",$i[$i.INTERNAL=13]="INTERNAL",$i[$i.UNAVAILABLE=14]="UNAVAILABLE",$i[$i.DATA_LOSS=15]="DATA_LOSS";var io=(co.prototype.rt=function(t,e){return new co(this.i,this.root.rt(t,e,this.i).copy(null,null,so.ot,null,null))},co.prototype.remove=function(t){return new co(this.i,this.root.remove(t,this.i).copy(null,null,so.ot,null,null))},co.prototype.get=function(t){for(var e=this.root;!e.m();){var n=this.i(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},co.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.m();){var r=this.i(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},co.prototype.m=function(){return this.root.m()},Object.defineProperty(co.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),co.prototype.at=function(){return this.root.at()},co.prototype.ct=function(){return this.root.ct()},co.prototype.ut=function(t){return this.root.ut(t)},co.prototype.forEach=function(n){this.ut(function(t,e){return n(t,e),!1})},co.prototype.toString=function(){var n=[];return this.ut(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},co.prototype.ht=function(t){return this.root.ht(t)},co.prototype.lt=function(){return new oo(this.root,null,this.i,!1)},co.prototype._t=function(t){return new oo(this.root,t,this.i,!1)},co.prototype.ft=function(){return new oo(this.root,null,this.i,!0)},co.prototype.dt=function(t){return new oo(this.root,t,this.i,!0)},co),oo=(ao.prototype.Et=function(){var t=this.Tt.pop(),e={key:t.key,value:t.value};if(this.wt)for(t=t.left;!t.m();)this.Tt.push(t),t=t.right;else for(t=t.right;!t.m();)this.Tt.push(t),t=t.left;return e},ao.prototype.It=function(){return 0<this.Tt.length},ao.prototype.At=function(){if(0===this.Tt.length)return null;var t=this.Tt[this.Tt.length-1];return{key:t.key,value:t.value}},ao),so=(uo.prototype.copy=function(t,e,n,r,i){return new uo(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},uo.prototype.m=function(){return!1},uo.prototype.ut=function(t){return this.left.ut(t)||t(this.key,this.value)||this.right.ut(t)},uo.prototype.ht=function(t){return this.right.ht(t)||t(this.key,this.value)||this.left.ht(t)},uo.prototype.min=function(){return this.left.m()?this:this.left.min()},uo.prototype.at=function(){return this.min().key},uo.prototype.ct=function(){return this.right.m()?this.key:this.right.ct()},uo.prototype.rt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.rt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.rt(t,e,n))).Rt()},uo.prototype.Pt=function(){if(this.left.m())return uo.EMPTY;var t=this;return t.left.gt()||t.left.left.gt()||(t=t.yt()),(t=t.copy(null,null,null,t.left.Pt(),null)).Rt()},uo.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.m()||r.left.gt()||r.left.left.gt()||(r=r.yt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.gt()&&(r=r.Vt()),r.right.m()||r.right.gt()||r.right.left.gt()||(r=r.bt()),0===e(t,r.key)){if(r.right.m())return uo.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.Pt())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Rt()},uo.prototype.gt=function(){return this.color},uo.prototype.Rt=function(){var t=this;return t.right.gt()&&!t.left.gt()&&(t=t.vt()),t.left.gt()&&t.left.left.gt()&&(t=t.Vt()),t.left.gt()&&t.right.gt()&&(t=t.St()),t},uo.prototype.yt=function(){var t=this.St();return t.right.left.gt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Vt())).vt()).St()),t},uo.prototype.bt=function(){var t=this.St();return t.left.left.gt()&&(t=(t=t.Vt()).St()),t},uo.prototype.vt=function(){var t=this.copy(null,null,uo.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},uo.prototype.Vt=function(){var t=this.copy(null,null,uo.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},uo.prototype.St=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},uo.prototype.Dt=function(){var t=this.Ct();return Math.pow(2,t)<=this.size+1},uo.prototype.Ct=function(){if(this.gt()&&this.left.gt())throw Fr();if(this.right.gt())throw Fr();var t=this.left.Ct();if(t!==this.right.Ct())throw Fr();return t+(this.gt()?0:1)},uo);function uo(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:uo.RED,this.left=null!=r?r:uo.EMPTY,this.right=null!=i?i:uo.EMPTY,this.size=this.left.size+1+this.right.size}function ao(t,e,n,r){this.wt=r,this.Tt=[];for(var i=1;!t.m();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.wt?t.left:t.right;else{if(0===i){this.Tt.push(t);break}this.Tt.push(t),t=this.wt?t.right:t.left}}function co(t,e){this.i=t,this.root=e||so.EMPTY}function ho(){this.size=0}so.EMPTY=null,so.RED=!0,so.ot=!1,so.EMPTY=(Object.defineProperty(ho.prototype,"key",{get:function(){throw Fr()},enumerable:!1,configurable:!0}),Object.defineProperty(ho.prototype,"value",{get:function(){throw Fr()},enumerable:!1,configurable:!0}),Object.defineProperty(ho.prototype,"color",{get:function(){throw Fr()},enumerable:!1,configurable:!0}),Object.defineProperty(ho.prototype,"left",{get:function(){throw Fr()},enumerable:!1,configurable:!0}),Object.defineProperty(ho.prototype,"right",{get:function(){throw Fr()},enumerable:!1,configurable:!0}),ho.prototype.copy=function(t,e,n,r,i){return this},ho.prototype.rt=function(t,e,n){return new so(t,e)},ho.prototype.remove=function(t,e){return this},ho.prototype.m=function(){return!0},ho.prototype.ut=function(t){return!1},ho.prototype.ht=function(t){return!1},ho.prototype.at=function(){return null},ho.prototype.ct=function(){return null},ho.prototype.gt=function(){return!1},ho.prototype.Dt=function(){return!0},ho.prototype.Ct=function(){return 0},new ho);var fo=(yo.prototype.has=function(t){return null!==this.data.get(t)},yo.prototype.first=function(){return this.data.at()},yo.prototype.last=function(){return this.data.ct()},Object.defineProperty(yo.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),yo.prototype.indexOf=function(t){return this.data.indexOf(t)},yo.prototype.forEach=function(n){this.data.ut(function(t,e){return n(t),!1})},yo.prototype.Nt=function(t,e){for(var n=this.data._t(t[0]);n.It();){var r=n.Et();if(0<=this.i(r.key,t[1]))return;e(r.key)}},yo.prototype.Ft=function(t,e){for(var n=void 0!==e?this.data._t(e):this.data.lt();n.It();)if(!t(n.Et().key))return},yo.prototype.xt=function(t){var e=this.data._t(t);return e.It()?e.Et().key:null},yo.prototype.lt=function(){return new lo(this.data.lt())},yo.prototype._t=function(t){return new lo(this.data._t(t))},yo.prototype.add=function(t){return this.copy(this.data.remove(t).rt(t,!0))},yo.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},yo.prototype.m=function(){return this.data.m()},yo.prototype.$t=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},yo.prototype.isEqual=function(t){if(!(t instanceof yo))return!1;if(this.size!==t.size)return!1;for(var e=this.data.lt(),n=t.data.lt();e.It();){var r=e.Et().key,i=n.Et().key;if(0!==this.i(r,i))return!1}return!0},yo.prototype.A=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},yo.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},yo.prototype.copy=function(t){var e=new yo(this.i);return e.data=t,e},yo),lo=(vo.prototype.Et=function(){return this.kt.Et().key},vo.prototype.It=function(){return this.kt.It()},vo),po=new io(Xr.i);function vo(t){this.kt=t}function yo(t){this.i=t,this.data=new io(this.i)}var go=new io(Xr.i);var mo=new io(Xr.i),wo=new fo(Xr.i);function bo(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=wo,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var Eo=new fo(Ii);var Io=(Vo.Lt=function(t){return new Vo(t.i)},Vo.prototype.has=function(t){return null!=this.Mt.get(t)},Vo.prototype.get=function(t){return this.Mt.get(t)},Vo.prototype.first=function(){return this.Ot.at()},Vo.prototype.last=function(){return this.Ot.ct()},Vo.prototype.m=function(){return this.Ot.m()},Vo.prototype.indexOf=function(t){var e=this.Mt.get(t);return e?this.Ot.indexOf(e):-1},Object.defineProperty(Vo.prototype,"size",{get:function(){return this.Ot.size},enumerable:!1,configurable:!0}),Vo.prototype.forEach=function(n){this.Ot.ut(function(t,e){return n(t),!1})},Vo.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Mt.rt(t.key,t),e.Ot.rt(t,null))},Vo.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Mt.remove(t),this.Ot.remove(e)):this},Vo.prototype.isEqual=function(t){if(!(t instanceof Vo))return!1;if(this.size!==t.size)return!1;for(var e=this.Ot.lt(),n=t.Ot.lt();e.It();){var r=e.Et().key,i=n.Et().key;if(!r.isEqual(i))return!1}return!0},Vo.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},Vo.prototype.copy=function(t,e){var n=new Vo;return n.i=this.i,n.Mt=t,n.Ot=e,n},Vo),To=(Mo.prototype.track=function(t){var e=t.doc.key,n=this.Bt.get(e);!n||0!==t.type&&3===n.type?this.Bt=this.Bt.rt(e,t):3===t.type&&1!==n.type?this.Bt=this.Bt.rt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Bt=this.Bt.rt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Bt=this.Bt.rt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Bt=this.Bt.remove(e):1===t.type&&2===n.type?this.Bt=this.Bt.rt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Bt=this.Bt.rt(e,{type:2,doc:t.doc}):Fr()},Mo.prototype.qt=function(){var n=[];return this.Bt.ut(function(t,e){n.push(e)}),n},Mo),_o=(Co.Kt=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new Co(t,e,Io.Lt(e),i,n,r,!0,!1)},Object.defineProperty(Co.prototype,"hasPendingWrites",{get:function(){return!this.Qt.m()},enumerable:!1,configurable:!0}),Co.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Wt===t.Wt&&this.Qt.isEqual(t.Qt)&&Zu(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ut.isEqual(t.Ut)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Co),No=(Uo.Jt=function(t,e){var n=new Map;return n.set(t,Ao.Xt(t,e)),new Uo(Mi.min(),n,Eo,po,bo())},Uo),Ao=(Po.Xt=function(t,e){return new Po(Ni.B,e,bo(),bo(),bo())},Po),So=function(t,e,n,r){this.se=t,this.removedTargetIds=e,this.key=n,this.ie=r},Do=function(t,e){this.targetId=t,this.re=e},xo=function(t,e,n,r){void 0===n&&(n=Ni.B),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Oo=(Object.defineProperty(Lo.prototype,"Zt",{get:function(){return this.ue},enumerable:!1,configurable:!0}),Object.defineProperty(Lo.prototype,"resumeToken",{get:function(){return this.ce},enumerable:!1,configurable:!0}),Object.defineProperty(Lo.prototype,"le",{get:function(){return 0!==this.oe},enumerable:!1,configurable:!0}),Object.defineProperty(Lo.prototype,"_e",{get:function(){return this.he},enumerable:!1,configurable:!0}),Lo.prototype.fe=function(t){0<t.O()&&(this.he=!0,this.ce=t)},Lo.prototype.de=function(){var n=bo(),r=bo(),i=bo();return this.ae.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Fr()}}),new Ao(this.ce,this.ue,n,r,i)},Lo.prototype.we=function(){this.he=!1,this.ae=jo()},Lo.prototype.me=function(t,e){this.he=!0,this.ae=this.ae.rt(t,e)},Lo.prototype.Te=function(t){this.he=!0,this.ae=this.ae.remove(t)},Lo.prototype.Ee=function(){this.oe+=1},Lo.prototype.Ie=function(){--this.oe},Lo.prototype.Ae=function(){this.he=!0,this.ue=!0},Lo),Ro=(ko.prototype.pe=function(t){for(var e=0,n=t.se;e<n.length;e++){var r=n[e];t.ie instanceof Lu?this.be(r,t.ie):t.ie instanceof Pu&&this.ve(r,t.key,t.ie)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.ve(s,t.key,t.ie)}},ko.prototype.Se=function(n){var r=this;this.De(n,function(t){var e=r.Ce(t);switch(n.state){case 0:r.Ne(t)&&e.fe(n.resumeToken);break;case 1:e.Ie(),e.le||e.we(),e.fe(n.resumeToken);break;case 2:e.Ie(),e.le||r.removeTarget(t);break;case 3:r.Ne(t)&&(e.Ae(),e.fe(n.resumeToken));break;case 4:r.Ne(t)&&(r.Fe(t),e.fe(n.resumeToken));break;default:Fr()}})},ko.prototype.De=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Pe.forEach(function(t,e){r.Ne(e)&&n(e)})},ko.prototype.xe=function(t){var e,n,r=t.targetId,i=t.re.count,o=this.$e(r);o&&(Xi(e=o.target)?0===i?(n=new Xr(e.path),this.ve(r,n,new Pu(n,Mi.min()))):jr(1===i):this.ke(r)!==i&&(this.Fe(r),this.Ve=this.Ve.add(r)))},ko.prototype.Me=function(i){var o=this,s=new Map;this.Pe.forEach(function(t,e){var n,r=o.$e(e);r&&(t.Zt&&Xi(r.target)&&(n=new Xr(r.target.path),null!==o.ge.get(n)||o.Oe(e,n)||o.ve(e,n,new Pu(n,i))),t._e&&(s.set(e,t.de()),t.we()))});var r=bo();this.ye.forEach(function(t,e){var n=!0;e.Ft(function(t){var e=o.$e(t);return!e||2===e.tt||(n=!1)}),n&&(r=r.add(t))});var t=new No(i,s,this.Ve,this.ge,r);return this.ge=po,this.ye=Fo(),this.Ve=new fo(Ii),t},ko.prototype.be=function(t,e){var n;this.Ne(t)&&(n=this.Oe(t,e.key)?2:0,this.Ce(t).me(e.key,n),this.ge=this.ge.rt(e.key,e),this.ye=this.ye.rt(e.key,this.Le(e.key).add(t)))},ko.prototype.ve=function(t,e,n){var r;this.Ne(t)&&(r=this.Ce(t),this.Oe(t,e)?r.me(e,1):r.Te(e),this.ye=this.ye.rt(e,this.Le(e).delete(t)),n&&(this.ge=this.ge.rt(e,n)))},ko.prototype.removeTarget=function(t){this.Pe.delete(t)},ko.prototype.ke=function(t){var e=this.Ce(t).de();return this.Re.Be(t).size+e.te.size-e.ne.size},ko.prototype.Ee=function(t){this.Ce(t).Ee()},ko.prototype.Ce=function(t){var e=this.Pe.get(t);return e||(e=new Oo,this.Pe.set(t,e)),e},ko.prototype.Le=function(t){var e=this.ye.get(t);return e||(e=new fo(Ii),this.ye=this.ye.rt(t,e)),e},ko.prototype.Ne=function(t){var e=null!==this.$e(t);return e||Ur("WatchChangeAggregator","Detected inactive target",t),e},ko.prototype.$e=function(t){var e=this.Pe.get(t);return e&&e.le?null:this.Re.qe(t)},ko.prototype.Fe=function(e){var n=this;this.Pe.set(e,new Oo),this.Re.Be(e).forEach(function(t){n.ve(e,t,null)})},ko.prototype.Oe=function(t,e){return this.Re.Be(t).has(e)},ko);function ko(t){this.Re=t,this.Pe=new Map,this.ge=po,this.ye=Fo(),this.Ve=new fo(Ii)}function Lo(){this.oe=0,this.ae=jo(),this.ce=Ni.B,this.ue=!1,this.he=!0}function Po(t,e,n,r,i){this.resumeToken=t,this.Zt=e,this.te=n,this.ee=r,this.ne=i}function Uo(t,e,n,r,i){this.et=t,this.Gt=e,this.zt=n,this.Ht=r,this.Yt=i}function Co(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Ut=n,this.docChanges=r,this.Qt=i,this.fromCache=o,this.Wt=s,this.jt=u}function Mo(){this.Bt=new io(Xr.i)}function Vo(n){this.i=n?function(t,e){return n(t,e)||Xr.i(t.key,e.key)}:function(t,e){return Xr.i(t.key,e.key)},this.Mt=go,this.Ot=new io(this.i)}function Fo(){return new io(Xr.i)}function jo(){return new io(Xr.i)}function qo(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Bo(t){var e=Xo(t.mapValue.fields.__local_write_time__.timestampValue);return new Ci(e.seconds,e.nanos)}var zo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Go(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?qo(t)?4:10:Fr()}function Ho(r,i){var t,e,n,o=Go(r);if(o!==Go(i))return!1;switch(o){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return Bo(r).isEqual(Bo(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=Xo(r.timestampValue),n=Xo(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return n=i,Zo(r.bytesValue).isEqual(Zo(n.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,Jo((t=r).geoPointValue.latitude)===Jo(e.geoPointValue.latitude)&&Jo(t.geoPointValue.longitude)===Jo(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Jo(t.integerValue)===Jo(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Jo(t.doubleValue),r=Jo(e.doubleValue);return n===r?Gi(n)===Gi(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return Ti(r.arrayValue.values||[],i.arrayValue.values||[],Ho);case 10:return function(){var t,e=r.mapValue.fields||{},n=i.mapValue.fields||{};if(qr(e)!==qr(n))return!1;for(t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!Ho(e[t],n[t])))return!1;return!0}();default:return Fr()}}function Wo(t,e){return void 0!==(t.values||[]).find(function(t){return Ho(t,e)})}function Ko(t,e){var n,r,i,o,s,u,a,c,h,f,l=Go(t),p=Go(e);if(l!==p)return Ii(l,p);switch(l){case 0:return 0;case 1:return Ii(t.booleanValue,e.booleanValue);case 2:return c=e,h=Jo(t.integerValue||t.doubleValue),f=Jo(c.integerValue||c.doubleValue),h<f?-1:f<h?1:h===f?0:isNaN(h)?isNaN(f)?0:-1:1;case 3:return Qo(t.timestampValue,e.timestampValue);case 4:return Qo(Bo(t),Bo(e));case 5:return Ii(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=Zo(o),a=Zo(s),u.L(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Ii(n[i],r[i]);if(0!==o)return o}return Ii(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=Ii(Jo(n.latitude),Jo(r.latitude)))?i:Ii(Jo(n.longitude),Jo(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Ko(n[i],r[i]);if(o)return o}return Ii(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Ii(r[s],o[s]);if(0!==u)return u;var a=Ko(n[r[s]],i[o[s]]);if(0!==a)return a}return Ii(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Fr()}}function Qo(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ii(t,e);var n=Xo(t),r=Xo(e),i=Ii(n.seconds,r.seconds);return 0!==i?i:Ii(n.nanos,r.nanos)}function Yo(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=Xo(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?Zo(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,Xr.C(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++){e?e=!1:t+=",",t+=s(r[n])}return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):Fr();var t,e,n}(t)}function Xo(t){if(jr(!!t),"string"!=typeof t)return{seconds:Jo(t.seconds),nanos:Jo(t.nanos)};var e,n=0,r=zo.exec(t);jr(!!r),r[1]&&(e=((e=r[1])+"000000000").substr(0,9),n=Number(e));var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:n}}function Jo(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Zo(t){return"string"==typeof t?Ni.fromBase64String(t):Ni.fromUint8Array(t)}function $o(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.R()}}function ts(t){return t&&"integerValue"in t}function es(t){return!!t&&"arrayValue"in t}function ns(t){return t&&"nullValue"in t}function rs(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function is(t){return t&&"mapValue"in t}var os={asc:"ASCENDING",desc:"DESCENDING"},ss={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},us=function(t,e){this.U=t,this.Ue=e};function as(t){return{integerValue:""+t}}function cs(t,e){if(t.Ue){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Gi(e)?"-0":e}}function hs(t,e){return Hi(e)?as(e):cs(t,e)}function fs(t,e){return t.Ue?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ls(t,e){return t.Ue?e.toBase64():e.toUint8Array()}function ps(t){return jr(!!t),Mi.Y((e=Xo(t),new Ci(e.seconds,e.nanos)));var e}function ds(t,e){return new Kr(["projects",t.projectId,"databases",t.database]).child("documents").child(e).R()}function vs(t){var e=Kr.P(t);return jr(Rs(e)),e}function ys(t,e){return ds(t.U,e.path)}function gs(t,e){var n=vs(e);return jr(n.get(1)===t.U.projectId),jr(!n.get(3)&&!t.U.database||n.get(3)===t.U.database),new Xr(Es(n))}function ms(t,e){return ds(t.U,e)}function ws(t){var e=vs(t);return 4===e.length?Kr.g():Es(e)}function bs(t){return new Kr(["projects",t.U.projectId,"databases",t.U.database]).R()}function Es(t){return jr(4<t.length&&"documents"===t.get(4)),t.u(5)}function Is(t,e,n){return{name:ys(t,e),fields:n.proto.mapValue.fields}}function Ts(t,e){var n,r,i,o,s,u;if(e instanceof hu)n={update:Is(t,e.key,e.value)};else if(e instanceof Eu)n={delete:ys(t,e.key)};else if(e instanceof fu)n={update:Is(t,e.key,e.data),updateMask:(r=e.Qe,i=[],r.fields.forEach(function(t){return i.push(t.R())}),{fieldPaths:i})};else if(e instanceof yu)n={transform:{document:ys(t,e.key),fieldTransforms:e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof Cs)return{fieldPath:t.field.R(),setToServerValue:"REQUEST_TIME"};if(e instanceof Ms)return{fieldPath:t.field.R(),appendMissingElements:{values:e.elements}};if(e instanceof Bs)return{fieldPath:t.field.R(),removeAllFromArray:{values:e.elements}};if(e instanceof Ws)return{fieldPath:t.field.R(),increment:e.We};throw Fr()})}};else{if(!(e instanceof Iu))return Fr();n={verify:ys(t,e.key)}}return e.Ke.je||(n.currentDocument=void 0!==(o=e.Ke).updateTime?{updateTime:(s=t,u=o.updateTime,fs(s,u.X()))}:void 0!==o.exists?{exists:o.exists}:Fr()),n}function _s(e,t){var n,r,i=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?tu.updateTime(ps(n.updateTime)):void 0!==n.exists?tu.exists(n.exists):tu.Ge():tu.Ge();if(t.update){t.update.name;var o=gs(e,t.update.name),s=new Tu({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=(r=t.updateMask.fieldPaths||[],new Xs(r.map(function(t){return Yr.S(t)})));return new fu(o,s,u,i)}return new hu(o,s,i)}if(t.delete){var a=gs(e,t.delete);return new Eu(a,i)}if(t.transform){var c=gs(e,t.transform.document),h=t.transform.fieldTransforms.map(function(t){return function(t,e){var n,r,i=null;"setToServerValue"in e?(jr("REQUEST_TIME"===e.setToServerValue),i=new Cs):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],i=new Ms(n)):"removeAllFromArray"in e?(r=e.removeAllFromArray.values||[],i=new Bs(r)):"increment"in e?i=new Ws(t,e.increment):Fr();var o=Yr.S(e.fieldPath);return new Js(o,i)}(e,t)});return jr(!0===i.exists),new yu(c,h)}if(t.verify){var f=gs(e,t.verify);return new Iu(f,i)}return Fr()}function Ns(t,e){return{documents:[ms(t,e.path)]}}function As(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ms(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ms(t,r.h()),n.structuredQuery.from=[{collectionId:r._()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){if("=="===t.op){if(rs(t.value))return{unaryFilter:{field:xs(t.field),op:"IS_NAN"}};if(ns(t.value))return{unaryFilter:{field:xs(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(rs(t.value))return{unaryFilter:{field:xs(t.field),op:"IS_NOT_NAN"}};if(ns(t.value))return{unaryFilter:{field:xs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xs(t.field),op:(e=t.op,ss[e]),value:t.value}};var e});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return{field:xs((e=t).field),direction:(n=e.dir,os[n])};var e,n})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s,u=(s=e.limit,t.Ue||zi(s)?s:{value:s});return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=Ss(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ss(e.endAt)),n}function Ss(t){return{before:t.before,values:t.position}}function Ds(t){var e=!!t.before,n=t.values||[];return new _a(n,e)}function xs(t){return{fieldPath:t.R()}}function Os(t){return Yr.S(t.fieldPath)}function Rs(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function ks(){this.ze=void 0}function Ls(t,e){return t instanceof Ws?ts(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}var Ps,Us,Cs=(o(Fs,Us=ks),Fs),Ms=(o(Vs,Ps=ks),Vs);function Vs(t){var e=this;return(e=Ps.call(this)||this).elements=t,e}function Fs(){return null!==Us&&Us.apply(this,arguments)||this}function js(t,e){for(var n=Ys(e),r=0,i=t.elements;r<i.length;r++)!function(e){n.some(function(t){return Ho(t,e)})||n.push(e)}(i[r]);return{arrayValue:{values:n}}}var qs,Bs=(o(zs,qs=ks),zs);function zs(t){var e=this;return(e=qs.call(this)||this).elements=t,e}function Gs(t,e){for(var n=Ys(e),r=0,i=t.elements;r<i.length;r++)!function(e){n=n.filter(function(t){return!Ho(t,e)})}(i[r]);return{arrayValue:{values:n}}}var Hs,Ws=(o(Ks,Hs=ks),Ks);function Ks(t,e){var n=this;return(n=Hs.call(this)||this).serializer=t,n.We=e,n}function Qs(t){return Jo(t.integerValue||t.doubleValue)}function Ys(t){return es(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Xs=(Zs.prototype.He=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].T(t))return!0;return!1},Zs.prototype.isEqual=function(t){return Ti(this.fields,t.fields,function(t,e){return t.isEqual(e)})},Zs),Js=function(t,e){this.field=t,this.transform=e};function Zs(t){(this.fields=t).sort(Yr.i)}function $s(t,e){this.version=t,this.transformResults=e}var tu=(eu.Ge=function(){return new eu},eu.exists=function(t){return new eu(void 0,t)},eu.updateTime=function(t){return new eu(t)},Object.defineProperty(eu.prototype,"je",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),eu.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},eu);function eu(t,e){this.updateTime=t,this.exists=e}function nu(t,e){return void 0!==t.updateTime?e instanceof Lu&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof Lu}function ru(){}function iu(t,e,n){return t instanceof hu?new Lu(t.key,n.version,t.value,{hasCommittedMutations:!0}):t instanceof fu?function(t,e,n){if(!nu(t.Ke,e))return new Uu(t.key,n.version);var r=du(t,e);return new Lu(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof yu?function(t,e,n){if(jr(null!=n.transformResults),!nu(t.Ke,e))return new Uu(t.key,n.version);var r=e,i=function(t,e,n){var r=[];jr(t.length===n.length);for(var i,o,s,u=0;u<n.length;u++){var a=t[u],c=a.transform,h=null;e instanceof Lu&&(h=e.field(a.field)),r.push((i=c,o=h,s=n[u],i instanceof Ms?js(i,o):i instanceof Bs?Gs(i,o):s))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=mu(t,r.data(),i);return new Lu(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):new Pu(t.key,n.version,{hasCommittedMutations:!0})}function ou(t,e,n,r){return t instanceof hu?function(t,e){if(!nu(t.Ke,e))return e;var n=uu(e);return new Lu(t.key,n,t.value,{Ye:!0})}(t,e):t instanceof fu?function(t,e){if(!nu(t.Ke,e))return e;var n=uu(e),r=du(t,e);return new Lu(t.key,n,r,{Ye:!0})}(t,e):t instanceof yu?function(t,e,n,r){if(!nu(t.Ke,e))return e;var i=e,o=function(t,e,n,r){for(var i,o,s,u,a,c,h,f=[],l=0,p=t;l<p.length;l++){var d=p[l],v=d.transform,y=null;n instanceof Lu&&(y=n.field(d.field)),null===y&&r instanceof Lu&&(y=r.field(d.field)),f.push((o=y,s=e,h=c=a=u=void 0,(i=v)instanceof Cs?(h={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}},o&&(h.fields.__previous_value__=o),{mapValue:h}):i instanceof Ms?js(i,o):i instanceof Bs?Gs(i,o):(a=Ls(u=i,o),c=Qs(a)+Qs(u.We),ts(a)&&ts(u.We)?as(c):cs(u.serializer,c))))}return f}(t.fieldTransforms,n,e,r),s=mu(t,i.data(),o);return new Lu(t.key,i.version,s,{Ye:!0})}(t,e,r,n):(o=e,nu((i=t).Ke,o)?new Pu(i.key,Mi.min()):o);var i,o}function su(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ke.isEqual(e.Ke)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Qe.isEqual(e.Qe):2!==t.type||Ti(t.fieldTransforms,t.fieldTransforms,function(t,e){return r=e,(n=t).field.isEqual(r.field)&&(i=n.transform,o=r.transform,i instanceof Ms&&o instanceof Ms||i instanceof Bs&&o instanceof Bs?Ti(i.elements,o.elements,Ho):i instanceof Ws&&o instanceof Ws?Ho(i.We,o.We):i instanceof Cs&&o instanceof Cs);var n,r,i,o}))}function uu(t){return t instanceof Lu?t.version:Mi.min()}var au,cu,hu=(o(pu,cu=ru),pu),fu=(o(lu,au=ru),lu);function lu(t,e,n,r){var i=this;return(i=au.call(this)||this).key=t,i.data=e,i.Qe=n,i.Ke=r,i.type=1,i}function pu(t,e,n){var r=this;return(r=cu.call(this)||this).key=t,r.value=e,r.Ke=n,r.type=0,r}function du(t,e){return n=t,r=e instanceof Lu?e.data():Tu.empty(),i=new _u(r),n.Qe.fields.forEach(function(t){var e;t.m()||(null!==(e=n.data.field(t))?i.set(t,e):i.delete(t))}),i.Je();var n,r,i}var vu,yu=(o(gu,vu=ru),gu);function gu(t,e){var n=this;return(n=vu.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Ke=tu.exists(!0),n}function mu(t,e,n){for(var r=new _u(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Je()}var wu,bu,Eu=(o(Du,bu=ru),Du),Iu=(o(Su,wu=ru),Su),Tu=(Au.empty=function(){return new Au({mapValue:{}})},Au.prototype.field=function(t){if(t.m())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!is(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t._()])||null},Au.prototype.isEqual=function(t){return Ho(this.proto,t.proto)},Au),_u=(Nu.prototype.set=function(t,e){return this.tn(t,e),this},Nu.prototype.delete=function(t){return this.tn(t,null),this},Nu.prototype.tn=function(t,e){for(var n=this.Ze,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===Go(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t._(),e)},Nu.prototype.Je=function(){var t=this.en(Yr.g(),this.Ze);return null!=t?new Tu(t):this.Xe},Nu.prototype.en=function(r,t){var i=this,o=!1,e=this.Xe.field(r),s=is(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.en(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Nu);function Nu(t){void 0===t&&(t=Tu.empty()),this.Xe=t,this.Ze=new Map}function Au(t){this.proto=t}function Su(t,e){var n=this;return(n=wu.call(this)||this).key=t,n.Ke=e,n.type=4,n}function Du(t,e){var n=this;return(n=bu.call(this)||this).key=t,n.Ke=e,n.type=3,n}function xu(t,e){this.key=t,this.version=e}var Ou,Ru,ku,Lu=(o(Fu,ku=xu),Fu.prototype.field=function(t){return this.nn.field(t)},Fu.prototype.data=function(){return this.nn},Fu.prototype.sn=function(){return this.nn.proto},Fu.prototype.isEqual=function(t){return t instanceof Fu&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ye===t.Ye&&this.hasCommittedMutations===t.hasCommittedMutations&&this.nn.isEqual(t.nn)},Fu.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.nn.toString()+", {hasLocalMutations: "+this.Ye+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Fu.prototype,"hasPendingWrites",{get:function(){return this.Ye||this.hasCommittedMutations},enumerable:!1,configurable:!0}),Fu),Pu=(o(Vu,Ru=xu),Vu.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Vu.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),Vu.prototype.isEqual=function(t){return t instanceof Vu&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Vu),Uu=(o(Mu,Ou=xu),Mu.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Mu.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),Mu.prototype.isEqual=function(t){return t instanceof Mu&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Mu),Cu=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.rn=n,this.filters=r,this.limit=i,this.on=o,this.startAt=s,this.endAt=u,this.an=null,this.cn=null,this.startAt,this.endAt};function Mu(){return null!==Ou&&Ou.apply(this,arguments)||this}function Vu(t,e,n){var r=this;return(r=Ru.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Fu(t,e,n,r){var i=this;return(i=ku.call(this,t,e)||this).nn=n,i.Ye=!!r.Ye,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function ju(t,e,n,r,i,o,s,u){return new Cu(t,e,n,r,i,o,s,u)}function qu(t){return new Cu(t)}function Bu(t){return!zi(t.limit)&&"F"===t.on}function zu(t){return!zi(t.limit)&&"L"===t.on}function Gu(t){return 0<t.rn.length?t.rn[0].field:null}function Hu(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.un())return r.field}return null}function Wu(t){return null!==t.collectionGroup}function Ku(t){var e=t;if(null===e.an){e.an=[];var n=Hu(e),r=Gu(e);if(null!==n&&null===r)n.p()||e.an.push(new ka(n)),e.an.push(new ka(Yr.v(),"asc"));else{for(var i,o=!1,s=0,u=e.rn;s<u.length;s++){var a=u[s];e.an.push(a),a.field.p()&&(o=!0)}o||(i=0<e.rn.length?e.rn[e.rn.length-1].dir:"asc",e.an.push(new ka(Yr.v(),i)))}}return e.an}function Qu(t){var e=t;if(!e.cn)if("F"===e.on)e.cn=Ki(e.path,e.collectionGroup,Ku(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Ku(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new ka(o.field,s))}var u=e.endAt?new _a(e.endAt.position,!e.endAt.before):null,a=e.startAt?new _a(e.startAt.position,!e.startAt.before):null;e.cn=Ki(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.cn}function Yu(t,e,n){return new Cu(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Xu(t,e){return new Cu(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),t.limit,t.on,e,t.endAt)}function Ju(t,e){return new Cu(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),t.limit,t.on,t.startAt,e)}function Zu(t,e){return Yi(Qu(t),Qu(e))&&t.on===e.on}function $u(t){return Qi(Qu(t))+"|lt:"+t.on}function ta(t){return"Query(target="+(e=Qu(t),n=e.path.R(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(e=t).field.R()+" "+e.op+" "+Yo(e.value);var e}).join(", ")+"]"),zi(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(e=t).field.R()+" ("+e.dir+")";var e}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+xa(e.startAt)),e.endAt&&(n+=", endAt: "+xa(e.endAt)),"Target("+n+")")+"; limitType="+t.on+")";var e,n}function ea(i,t){return r=i,o=t.key.path,(null!==r.collectionGroup?t.key.N(r.collectionGroup)&&r.path.T(o):Xr.F(r.path)?r.path.isEqual(o):r.path.I(o))&&function(t){for(var e=0,n=i.rn;e<n.length;e++){var r=n[e];if(!r.field.p()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(e=i).startAt||Oa(e.startAt,Ku(e),n))&&(!e.endAt||!Oa(e.endAt,Ku(e),n)));var e,n,r,o}function na(u){return function(t,e){for(var n=!1,r=0,i=Ku(u);r<i.length;r++){var o=i[r],s=function(t,i,e){var n=t.field.p()?Xr.i(i.key,e.key):function(t,e){var n=i.field(t),r=e.field(t);return null!==n&&null!==r?Ko(n,r):Fr()}(t.field,e);switch(t.dir){case"asc":return n;case"desc":return-1*n;default:return Fr()}}(o,t,e);if(0!==s)return s;n=n||o.field.p()}return 0}}var ra,ia=(o(oa,ra=function(){}),oa.create=function(t,e,n){if(t.p())return"in"===e||"not-in"===e?this.hn(t,e,n):new ca(t,e,n);if(ns(n)){if("=="!==e&&"!="!==e)throw new Rr(Or.INVALID_ARGUMENT,"Invalid query. Null only supports '==' and '!=' comparisons.");return new oa(t,e,n)}if(rs(n)){if("=="!==e&&"!="!==e)throw new Rr(Or.INVALID_ARGUMENT,"Invalid query. NaN only supports '==' and '!=' comparisons.");return new oa(t,e,n)}return"array-contains"===e?new ba(t,n):"in"===e?new Ea(t,n):"not-in"===e?new Ia(t,n):"array-contains-any"===e?new Ta(t,n):new oa(t,e,n)},oa.hn=function(t,e,n){return new("in"===e?ha:fa)(t,n)},oa.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.ln(Ko(e,this.value)):null!==e&&Go(this.value)===Go(e)&&this.ln(Ko(e,this.value))},oa.prototype.ln=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Fr()}},oa.prototype.un=function(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)},oa);function oa(t,e,n){var r=this;return(r=ra.call(this)||this).field=t,r.op=e,r.value=n,r}var sa,ua,aa,ca=(o(da,aa=ia),da.prototype.matches=function(t){var e=Xr.i(t.key,this.key);return this.ln(e)},da),ha=(o(pa,ua=ia),pa.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},pa),fa=(o(la,sa=ia),la.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},la);function la(t,e){var n=this;return(n=sa.call(this,t,"not-in",e)||this).keys=va(0,e),n}function pa(t,e){var n=this;return(n=ua.call(this,t,"in",e)||this).keys=va(0,e),n}function da(t,e,n){var r=this;return(r=aa.call(this,t,e,n)||this).key=Xr.C(n.referenceValue),r}function va(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return Xr.C(t.referenceValue)})}var ya,ga,ma,wa,ba=(o(Da,wa=ia),Da.prototype.matches=function(t){var e=t.field(this.field);return es(e)&&Wo(e.arrayValue,this.value)},Da),Ea=(o(Sa,ma=ia),Sa.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&Wo(this.value.arrayValue,e)},Sa),Ia=(o(Aa,ga=ia),Aa.prototype.matches=function(t){if(Wo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.field(this.field);return null!==e&&!Wo(this.value.arrayValue,e)},Aa),Ta=(o(Na,ya=ia),Na.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!es(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Wo(e.value.arrayValue,t)})},Na),_a=function(t,e){this.position=t,this.before=e};function Na(t,e){return ya.call(this,t,"array-contains-any",e)||this}function Aa(t,e){return ga.call(this,t,"not-in",e)||this}function Sa(t,e){return ma.call(this,t,"in",e)||this}function Da(t,e){return wa.call(this,t,"array-contains",e)||this}function xa(t){return(t.before?"b":"a")+":"+t.position.map(Yo).join(",")}function Oa(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.p()?Xr.i(Xr.C(s.referenceValue),n.key):Ko(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Ra(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Ho(t.position[n],e.position[n]))return!1;return!0}var ka=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function La(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var Pa,Ua=(Ga.prototype.reset=function(){this.Tn=0},Ga.prototype.An=function(){this.Tn=this.mn},Ga.prototype.Rn=function(t){var e=this;this.cancel();var n=Math.floor(this.Tn+this.Pn()),r=Math.max(0,Date.now()-this.In),i=Math.max(0,n-r);0<i&&Ur("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Tn+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.En=this._n.gn(this.fn,i,function(){return e.In=Date.now(),t()}),this.Tn*=this.wn,this.Tn<this.dn&&(this.Tn=this.dn),this.Tn>this.mn&&(this.Tn=this.mn)},Ga.prototype.yn=function(){null!==this.En&&(this.En.Vn(),this.En=null)},Ga.prototype.cancel=function(){null!==this.En&&(this.En.cancel(),this.En=null)},Ga.prototype.Pn=function(){return(Math.random()-.5)*this.Tn},Ga),Ca=(za.prototype.catch=function(t){return this.next(void 0,t)},za.prototype.next=function(r,i){var o=this;return this.Sn&&Fr(),this.Sn=!0,this.vn?this.error?this.Dn(i,this.error):this.Cn(r,this.result):new za(function(e,n){o.pn=function(t){o.Cn(r,t).next(e,n)},o.bn=function(t){o.Dn(i,t).next(e,n)}})},za.prototype.Nn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},za.prototype.Fn=function(t){try{var e=t();return e instanceof za?e:za.resolve(e)}catch(t){return za.reject(t)}},za.prototype.Cn=function(t,e){return t?this.Fn(function(){return t(e)}):za.resolve(e)},za.prototype.Dn=function(t,e){return t?this.Fn(function(){return t(e)}):za.reject(e)},za.resolve=function(n){return new za(function(t,e){t(n)})},za.reject=function(n){return new za(function(t,e){e(n)})},za.xn=function(t){return new za(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},za.$n=function(t){for(var n=za.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?za.resolve(t):e()})}(r[e]);return n},za.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.xn(i)},za),Ma=(Ba.delete=function(t){return Ur("SimpleDb","Removing database:",t),Xa(window.indexedDB.deleteDatabase(t)).Nn()},Ba.On=function(){if("undefined"==typeof indexedDB)return!1;if(Ba.Ln())return!0;var t=v(),e=Ba.Mn(t),n=0<e&&e<10,r=Ba.Bn(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Ba.Ln=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.qn)},Ba.Un=function(t,e){return t.store(e)},Ba.Mn=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Ba.Bn=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Ba.prototype.Qn=function(){return m(this,void 0,void 0,function(){var e,o=this;return w(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(Ur("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(n,r){var i=indexedDB.open(o.name,o.version);i.onsuccess=function(t){var e=t.target.result;n(e)},i.onblocked=function(){r(new Fa("Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new Rr(Or.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new Fa(e))},i.onupgradeneeded=function(t){Ur("SimpleDb",'Database "'+o.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;o.kn.createOrUpgrade(e,i.transaction,t.oldVersion,o.version).next(function(){Ur("SimpleDb","Database upgrade to version "+o.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.Wn&&(this.db.onversionchange=function(t){return o.Wn(t)}),this.db)]}})})},Ba.prototype.jn=function(e){this.Wn=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},Ba.prototype.runTransaction=function(r,c,h){return m(this,void 0,void 0,function(){var s,u,e,a,n;return w(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return w(this,function(t){switch(t.label){case 0:++u,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,a.Qn()];case 2:return a.db=t.sent(),e=Wa.open(a.db,s?"readonly":"readwrite",c),n=h(e).catch(function(t){return e.abort(t),Ca.reject(t)}).Nn(),r={},n.catch(function(){}),[4,e.Kn];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,Ur("SimpleDb","Transaction failed with error:",i.message,"Retrying:",o),a.close(),o?[3,5]:[2,{value:Promise.reject(i)}];case 5:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Ba.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},Ba),Va=(Object.defineProperty(qa.prototype,"vn",{get:function(){return this.zn},enumerable:!1,configurable:!0}),Object.defineProperty(qa.prototype,"Yn",{get:function(){return this.Hn},enumerable:!1,configurable:!0}),Object.defineProperty(qa.prototype,"cursor",{set:function(t){this.Gn=t},enumerable:!1,configurable:!0}),qa.prototype.done=function(){this.zn=!0},qa.prototype.Jn=function(t){this.Hn=t},qa.prototype.delete=function(){return Xa(this.Gn.delete())},qa),Fa=(o(ja,Pa=Rr),ja);function ja(t){var e=this;return(e=Pa.call(this,Or.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function qa(t){this.Gn=t,this.zn=!1,this.Hn=null}function Ba(t,e,n){this.name=t,this.version=e,this.kn=n,12.2===Ba.Mn(v())&&Cr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function za(t){var e=this;this.pn=null,this.bn=null,this.result=void 0,this.error=void 0,this.vn=!1,this.Sn=!1,t(function(t){e.vn=!0,e.result=t,e.pn&&e.pn(t)},function(t){e.vn=!0,e.error=t,e.bn&&e.bn(t)})}function Ga(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this._n=t,this.fn=e,this.dn=n,this.wn=r,this.mn=i,this.Tn=0,this.En=null,this.In=Date.now(),this.reset()}function Ha(t){return"IndexedDbTransactionError"===t.name}var Wa=(Ya.open=function(t,e,n){try{return new Ya(t.transaction(n,e))}catch(t){throw new Fa(t)}},Object.defineProperty(Ya.prototype,"Kn",{get:function(){return this.Xn.promise},enumerable:!1,configurable:!0}),Ya.prototype.abort=function(t){t&&this.Xn.reject(t),this.aborted||(Ur("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Ya.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Ka(e)},Ya),Ka=(Qa.prototype.put=function(t,e){var n=void 0!==e?(Ur("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Ur("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t));return Xa(n)},Qa.prototype.add=function(t){return Ur("SimpleDb","ADD",this.store.name,t,t),Xa(this.store.add(t))},Qa.prototype.get=function(e){var n=this;return Xa(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Ur("SimpleDb","GET",n.store.name,e,t),t})},Qa.prototype.delete=function(t){return Ur("SimpleDb","DELETE",this.store.name,t),Xa(this.store.delete(t))},Qa.prototype.count=function(){return Ur("SimpleDb","COUNT",this.store.name),Xa(this.store.count())},Qa.prototype.Zn=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.ts(n,function(t,e){r.push(e)}).next(function(){return r})},Qa.prototype.es=function(t,e){Ur("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.ns=!1;var r=this.cursor(n);return this.ts(r,function(t,e,n){return n.delete()})},Qa.prototype.ss=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.ts(r,e)},Qa.prototype.rs=function(i){var t=this.cursor({});return new Ca(function(n,r){t.onerror=function(t){var e=Za(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Qa.prototype.ts=function(t,s){var u=[];return new Ca(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n,r,i=t.target.result;i?(e=new Va(i),(n=s(i.primaryKey,i.value,e))instanceof Ca&&(r=n.catch(function(t){return e.done(),Ca.reject(t)}),u.push(r)),e.vn?o():null===e.Yn?i.continue():i.continue(e.Yn)):o()}}).next(function(){return Ca.xn(u)})},Qa.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Qa.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.ns?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Qa);function Qa(t){this.store=t}function Ya(t){var n=this;this.transaction=t,this.aborted=!1,this.Xn=new La,this.transaction.oncomplete=function(){n.Xn.resolve()},this.transaction.onabort=function(){t.error?n.Xn.reject(new Fa(t.error)):n.Xn.resolve()},this.transaction.onerror=function(t){var e=Za(t.target.error);n.Xn.reject(new Fa(e))}}function Xa(t){return new Ca(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Za(t.target.error);r(e)}})}var Ja=!1;function Za(t){var e=Ma.Mn(v());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Rr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ja||(Ja=!0,setTimeout(function(){throw r},0)),r}}return t}function $a(){return"undefined"!=typeof window?window:null}function tc(){return"undefined"!=typeof document?document:null}var ec=(ic.ls=function(t,e,n,r,i){var o=new ic(t,e,Date.now()+n,r,i);return o.start(n),o},ic.prototype.start=function(t){var e=this;this._s=setTimeout(function(){return e.fs()},t)},ic.prototype.Vn=function(){return this.fs()},ic.prototype.cancel=function(t){null!==this._s&&(this.clearTimeout(),this.hs.reject(new Rr(Or.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},ic.prototype.fs=function(){var e=this;this.os.ds(function(){return null!==e._s?(e.clearTimeout(),e.op().then(function(t){return e.hs.resolve(t)})):Promise.resolve()})},ic.prototype.clearTimeout=function(){null!==this._s&&(this.us(this),clearTimeout(this._s),this._s=null)},ic),nc=(Object.defineProperty(rc.prototype,"Vs",{get:function(){return this.Es},enumerable:!1,configurable:!0}),rc.prototype.ds=function(t){this.enqueue(t)},rc.prototype.ps=function(t){this.bs(),this.vs(t)},rc.prototype.Ss=function(){var t;this.Es||(this.Es=!0,(t=tc())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ys))},rc.prototype.enqueue=function(t){return this.bs(),this.Es?new Promise(function(t){}):this.vs(t)},rc.prototype.Ds=function(t){var e=this;this.Ts.push(t),this.ds(function(){return e.Cs()})},rc.prototype.Cs=function(){return m(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:if(0===this.Ts.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.Ts[0]()];case 2:return t.sent(),this.Ts.shift(),this.gs.reset(),[3,4];case 3:if(!Ha(e=t.sent()))throw e;return Ur("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.Ts.length&&this.gs.Rn(function(){return n.Cs()}),t.label=5;case 5:return[2]}})})},rc.prototype.vs=function(t){var r=this,e=this.ws.then(function(){return r.Rs=!0,t().catch(function(t){throw r.As=t,r.Rs=!1,Cr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.Rs=!1,t})});return this.ws=e},rc.prototype.gn=function(t,e,n){var r=this;this.bs(),-1<this.Ps.indexOf(t)&&(e=0);var i=ec.ls(this,t,e,n,function(t){return r.Ns(t)});return this.Is.push(i),i},rc.prototype.bs=function(){this.As&&Fr()},rc.prototype.Fs=function(){},rc.prototype.xs=function(){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return[4,e=this.ws];case 1:t.sent(),t.label=2;case 2:if(e!==this.ws)return[3,0];t.label=3;case 3:return[2]}})})},rc.prototype.$s=function(t){for(var e=0,n=this.Is;e<n.length;e++)if(n[e].fn===t)return!0;return!1},rc.prototype.ks=function(r){var i=this;return this.xs().then(function(){i.Is.sort(function(t,e){return t.cs-e.cs});for(var t=0,e=i.Is;t<e.length;t++){var n=e[t];if(n.Vn(),"all"!==r&&n.fn===r)break}return i.xs()})},rc.prototype.Ms=function(t){this.Ps.push(t)},rc.prototype.Ns=function(t){var e=this.Is.indexOf(t);this.Is.splice(e,1)},rc);function rc(){var e=this;this.ws=Promise.resolve(),this.Ts=[],this.Es=!1,this.Is=[],this.As=null,this.Rs=!1,this.Ps=[],this.gs=new Ua(this,"async_queue_retry"),this.ys=function(){var t=tc();t&&Ur("AsyncQueue","Visibility state changed to  ",t.visibilityState),e.gs.yn()};var t=tc();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.ys)}function ic(t,e,n,r,i){this.os=t,this.fn=e,this.cs=n,this.op=r,this.us=i,this.hs=new La,this.then=this.hs.promise.then.bind(this.hs.promise),this.hs.promise.catch(function(t){})}function oc(t,e){if(Cr("AsyncQueue",e+": "+t),Ha(t))return new Rr(Or.UNAVAILABLE,e+": "+t);throw t}function sc(){this.Os=void 0,this.listeners=[]}function uc(){this.Ls=new Ui($u,Zu),this.onlineState="Unknown",this.Bs=new Set}function ac(a,c){return m(this,void 0,void 0,function(){var e,n,r,i,o,s,u;return w(this,function(t){switch(t.label){case 0:if(e=a,n=c.query,r=!1,(i=e.Ls.get(n))||(r=!0,i=new sc),!r)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),o=i,[4,e.qs(n)];case 2:return o.Os=t.sent(),[3,4];case 3:return s=t.sent(),u=oc(s,"Initialization of query '"+ta(c.query)+"' failed"),[2,void c.onError(u)];case 4:return e.Ls.set(n,i),i.listeners.push(c),c.Us(e.onlineState),i.Os&&c.Qs(i.Os)&&hc(e),[2]}})})}function cc(s,u){return m(this,void 0,void 0,function(){var e,n,r,i,o;return w(this,function(t){return e=s,n=u.query,r=!1,(i=e.Ls.get(n))&&0<=(o=i.listeners.indexOf(u))&&(i.listeners.splice(o,1),r=0===i.listeners.length),r?[2,(e.Ls.delete(n),e.Ws(n))]:[2]})})}function hc(t){t.Bs.forEach(function(t){t.next()})}var fc=(dc.prototype.Qs=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new _o(t.query,t.docs,t.Ut,e,t.Qt,t.fromCache,t.Wt,!0)}var o=!1;return this.Ks?this.zs(t)&&(this.js.next(t),o=!0):this.Hs(t,this.onlineState)&&(this.Ys(t),o=!0),this.Gs=t,o},dc.prototype.onError=function(t){this.js.error(t)},dc.prototype.Us=function(t){this.onlineState=t;var e=!1;return this.Gs&&!this.Ks&&this.Hs(this.Gs,t)&&(this.Ys(this.Gs),e=!0),e},dc.prototype.Hs=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Js&&n||t.docs.m()&&"Offline"!==e)},dc.prototype.zs=function(t){if(0<t.docChanges.length)return!0;var e=this.Gs&&this.Gs.hasPendingWrites!==t.hasPendingWrites;return!(!t.Wt&&!e)&&!0===this.options.includeMetadataChanges},dc.prototype.Ys=function(t){t=_o.Kt(t.query,t.docs,t.Qt,t.fromCache),this.Ks=!0,this.js.next(t)},dc),lc=(pc.prototype.Xs=function(){return null!=this.uid},pc.prototype.Zs=function(){return this.Xs()?"uid:"+this.uid:"anonymous-user"},pc.prototype.isEqual=function(t){return t.uid===this.uid},pc);function pc(t){this.uid=t}function dc(t,e,n){this.query=t,this.js=e,this.Ks=!1,this.Gs=null,this.onlineState="Unknown",this.options=n||{}}lc.UNAUTHENTICATED=new lc(null),lc.ti=new lc("google-credentials-uid"),lc.ei=new lc("first-party-uid");var vc=(yc.prototype.si=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},yc.prototype.next=function(){var t=++this.previousValue;return this.ii&&this.ii(t),t},yc);function yc(t,e){var n=this;this.previousValue=t,e&&(e.ni=function(t){return n.si(t)},this.ii=function(t){return e.ri(t)})}function gc(t,e){return"firestore_clients_"+t+"_"+e}function mc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Xs()&&(r+="_"+e.uid),r}function wc(t,e){return"firestore_targets_"+t+"_"+e}vc.oi=-1;var bc=(Wc.ai=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Rr(r.error.code,r.error.message)),i?new Wc(t,e,r.state,o):(Cr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Wc.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Wc),Ec=(Hc.ai=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Rr(n.error.code,n.error.message)),r?new Hc(t,n.state,i):(Cr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Hc.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Hc),Ic=(Gc.ai=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Eo,o=0;r&&o<n.activeTargetIds.length;++o)r=Hi(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Gc(t,i):(Cr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Gc),Tc=(zc.ai=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new zc(e.clientId,e.onlineState):(Cr("SharedClientState","Failed to parse online state: "+t),null)},zc),_c=(Bc.prototype.ui=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Bc.prototype.hi=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Bc.prototype.ci=function(){var t={activeTargetIds:this.activeTargetIds.A(),updateTimeMs:Date.now()};return JSON.stringify(t)},Bc),Nc=(qc.On=function(t){return!(!t||!t.localStorage)},qc.prototype.start=function(){return m(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l=this;return w(this,function(t){switch(t.label){case 0:return[4,this._i.Vi()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.li&&(o=this.getItem(gc(this.persistenceKey,i)))&&(s=Ic.ai(i,o))&&(this.mi=this.mi.rt(s.clientId,s));for(this.pi(),(u=this.storage.getItem(this.yi))&&(a=this.bi(u))&&this.vi(a),c=0,h=this.Ei;c<h.length;c++)f=h[c],this.wi(f);return this.Ei=[],this.window.addEventListener("unload",function(){return l.Si()}),this.Ti=!0,[2]}})})},qc.prototype.ri=function(t){this.setItem(this.Ai,JSON.stringify(t))},qc.prototype.Di=function(){return this.Ci(this.mi)},qc.prototype.Ni=function(n){var r=!1;return this.mi.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},qc.prototype.Fi=function(t){this.xi(t,"pending")},qc.prototype.$i=function(t,e,n){this.xi(t,e,n),this.ki(t)},qc.prototype.Mi=function(t){var e,n,r="not-current";return this.Ni(t)&&(!(e=this.storage.getItem(wc(this.persistenceKey,t)))||(n=Ec.ai(t,e))&&(r=n.state)),this.Oi.ui(t),this.pi(),r},qc.prototype.Li=function(t){this.Oi.hi(t),this.pi()},qc.prototype.Bi=function(t){return this.Oi.activeTargetIds.has(t)},qc.prototype.qi=function(t){this.removeItem(wc(this.persistenceKey,t))},qc.prototype.Ui=function(t,e,n){this.Qi(t,e,n)},qc.prototype.Wi=function(t,e,n){var r=this;e.forEach(function(t){r.ki(t)}),this.currentUser=t,n.forEach(function(t){r.Fi(t)})},qc.prototype.ji=function(t){this.Ki(t)},qc.prototype.Si=function(){this.Ti&&(this.window.removeEventListener("storage",this.di),this.removeItem(this.Ii),this.Ti=!1)},qc.prototype.getItem=function(t){var e=this.storage.getItem(t);return Ur("SharedClientState","READ",t,e),e},qc.prototype.setItem=function(t,e){Ur("SharedClientState","SET",t,e),this.storage.setItem(t,e)},qc.prototype.removeItem=function(t){Ur("SharedClientState","REMOVE",t),this.storage.removeItem(t)},qc.prototype.wi=function(t){var e=this,u=t;if(u.storageArea===this.storage){if(Ur("SharedClientState","EVENT",u.key,u.newValue),u.key===this.Ii)return void Cr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this._n.Ds(function(){return m(e,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){if(this.Ti){if(null!==u.key)if(this.Ri.test(u.key)){if(null==u.newValue)return e=this.Gi(u.key),[2,this.zi(e,null)];if(n=this.Hi(u.key,u.newValue))return[2,this.zi(n.clientId,n)]}else if(this.Pi.test(u.key)){if(null!==u.newValue&&(r=this.Yi(u.key,u.newValue)))return[2,this.Ji(r)]}else if(this.gi.test(u.key)){if(null!==u.newValue&&(i=this.Xi(u.key,u.newValue)))return[2,this.Zi(i)]}else if(u.key===this.yi){if(null!==u.newValue&&(o=this.bi(u.newValue)))return[2,this.vi(o)]}else u.key===this.Ai&&(s=function(t){var e=vc.oi;if(null!=t)try{var n=JSON.parse(t);jr("number"==typeof n),e=n}catch(t){Cr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==vc.oi&&this.ni(s)}else this.Ei.push(u);return[2]})})})}},Object.defineProperty(qc.prototype,"Oi",{get:function(){return this.mi.get(this.li)},enumerable:!1,configurable:!0}),qc.prototype.pi=function(){this.setItem(this.Ii,this.Oi.ci())},qc.prototype.xi=function(t,e,n){var r=new bc(this.currentUser,t,e,n),i=mc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.ci())},qc.prototype.ki=function(t){var e=mc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},qc.prototype.Ki=function(t){var e={clientId:this.li,onlineState:t};this.storage.setItem(this.yi,JSON.stringify(e))},qc.prototype.Qi=function(t,e,n){var r=wc(this.persistenceKey,t),i=new Ec(t,e,n);this.setItem(r,i.ci())},qc.prototype.Gi=function(t){var e=this.Ri.exec(t);return e?e[1]:null},qc.prototype.Hi=function(t,e){var n=this.Gi(t);return Ic.ai(n,e)},qc.prototype.Yi=function(t,e){var n=this.Pi.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return bc.ai(new lc(i),r,e)},qc.prototype.Xi=function(t,e){var n=this.gi.exec(t),r=Number(n[1]);return Ec.ai(r,e)},qc.prototype.bi=function(t){return Tc.ai(t)},qc.prototype.Ji=function(e){return m(this,void 0,void 0,function(){return w(this,function(t){return e.user.uid===this.currentUser.uid?[2,this._i.tr(e.batchId,e.state,e.error)]:(Ur("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},qc.prototype.Zi=function(t){return this._i.er(t.targetId,t.state,t.error)},qc.prototype.zi=function(t,e){var n=this,r=e?this.mi.rt(t,e):this.mi.remove(t),i=this.Ci(this.mi),o=this.Ci(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this._i.nr(s,u).then(function(){n.mi=r})},qc.prototype.vi=function(t){this.mi.get(t.clientId)&&this.fi(t.onlineState)},qc.prototype.Ci=function(t){var n=Eo;return t.forEach(function(t,e){n=n.$t(e.activeTargetIds)}),n},qc),Ac=(jc.prototype.Fi=function(t){},jc.prototype.$i=function(t,e,n){},jc.prototype.Mi=function(t){return this.sr.ui(t),this.ir[t]||"not-current"},jc.prototype.Ui=function(t,e,n){this.ir[t]=e},jc.prototype.Li=function(t){this.sr.hi(t)},jc.prototype.Bi=function(t){return this.sr.activeTargetIds.has(t)},jc.prototype.qi=function(t){delete this.ir[t]},jc.prototype.Di=function(){return this.sr.activeTargetIds},jc.prototype.Ni=function(t){return this.sr.activeTargetIds.has(t)},jc.prototype.start=function(){return this.sr=new _c,Promise.resolve()},jc.prototype.Wi=function(t,e,n){},jc.prototype.ji=function(t){},jc.prototype.Si=function(){},jc.prototype.ri=function(t){},jc),Sc=(Fc.prototype.ar=function(t,e,n){for(var r=n.cr,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=iu(o,e,r[i]))}return e},Fc.prototype.ur=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=ou(i,e,e,this.rr))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=ou(a,e,o,this.rr))}return e},Fc.prototype.hr=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.ur(t.key,n.get(t.key));e&&(i=i.rt(t.key,e))}),i},Fc.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},bo())},Fc.prototype.isEqual=function(t){return this.batchId===t.batchId&&Ti(this.mutations,t.mutations,su)&&Ti(this.baseMutations,t.baseMutations,su)},Fc),Dc=(Vc.from=function(t,e,n){jr(t.mutations.length===n.length);for(var r=mo,i=t.mutations,o=0;o<i.length;o++)r=r.rt(i[o].key,n[o].version);return new Vc(t,e,n,r)},Vc),xc=(Object.defineProperty(Mc.prototype,"readTime",{get:function(){return this.mr},set:function(t){this.mr=t},enumerable:!1,configurable:!0}),Mc.prototype.Tr=function(t,e){this.Er(),this.readTime=e,this.dr.set(t.key,t)},Mc.prototype.Ir=function(t,e){this.Er(),e&&(this.readTime=e),this.dr.set(t,null)},Mc.prototype.Ar=function(t,e){this.Er();var n=this.dr.get(e);return void 0!==n?Ca.resolve(n):this.Rr(t,e)},Mc.prototype.getEntries=function(t,e){return this.Pr(t,e)},Mc.prototype.apply=function(t){return this.Er(),this.wr=!0,this.gr(t)},Mc.prototype.Er=function(){},Mc),Oc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Rc=(Cc.prototype.Vr=function(t){this.yr.push(t)},Cc.prototype.pr=function(){this.yr.forEach(function(t){return t()})},Cc),kc=(Uc.prototype.Dr=function(e,n){var r=this;return this.vr.Cr(e,n).next(function(t){return r.Nr(e,n,t)})},Uc.prototype.Nr=function(t,r,i){return this.br.Ar(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].ur(r,t);return t})},Uc.prototype.Fr=function(t,e,i){var o=po;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].ur(t,e);o=o.rt(t,e)}),o},Uc.prototype.$r=function(e,t){var n=this;return this.br.getEntries(e,t).next(function(t){return n.kr(e,t)})},Uc.prototype.kr=function(r,i){var o=this;return this.vr.Mr(r,i).next(function(t){var e=o.Fr(r,i,t),n=po;return e.forEach(function(t,e){e=e||new Pu(t,Mi.min()),n=n.rt(t,e)}),n})},Uc.prototype.Or=function(t,e,n){return r=e,Xr.F(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Lr(t,e.path):Wu(e)?this.Br(t,e,n):this.qr(t,e,n);var r},Uc.prototype.Lr=function(t,e){return this.Dr(t,new Xr(e)).next(function(t){var e=go;return t instanceof Lu&&(e=e.rt(t.key,t)),e})},Uc.prototype.Br=function(i,o,s){var u=this,a=o.collectionGroup,c=go;return this.Sr.Ur(i,a).next(function(t){return Ca.forEach(t,function(t){var e,n,r=(e=o,n=t.child(a),new Cu(n,null,e.rn.slice(),e.filters.slice(),e.limit,e.on,e.startAt,e.endAt));return u.qr(i,r,s).next(function(t){t.forEach(function(t,e){c=c.rt(t,e)})})}).next(function(){return c})})},Uc.prototype.qr=function(e,n,t){var h,f,r=this;return this.br.Or(e,n,t).next(function(t){return h=t,r.vr.Qr(e,n)}).next(function(t){return f=t,r.Wr(e,f,h).next(function(t){h=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=h.get(u),c=ou(s,a,a,r.rr);h=c instanceof Lu?h.rt(u,c):h.remove(u)}})}).next(function(){return h.forEach(function(t,e){ea(n,e)||(h=h.remove(t))}),h})},Uc.prototype.Wr=function(t,e,n){for(var r=bo(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof fu&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.br.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Lu&&(c=c.rt(t,e))}),c})},Uc),Lc=(Pc.Gr=function(t,e){for(var n=bo(),r=bo(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new Pc(t,e.fromCache,n,r)},Pc);function Pc(t,e,n,r){this.targetId=t,this.fromCache=e,this.jr=n,this.Kr=r}function Uc(t,e,n){this.br=t,this.vr=e,this.Sr=n}function Cc(){this.yr=[]}function Mc(){this.dr=new Ui(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.wr=!1}function Vc(t,e,n,r){this.batch=t,this.lr=e,this.cr=n,this._r=r}function Fc(t,e,n,r){this.batchId=t,this.rr=e,this.baseMutations=n,this.mutations=r}function jc(){this.sr=new _c,this.ir={},this.fi=null,this.ni=null}function qc(t,e,n,r,i){this.window=t,this._n=e,this.persistenceKey=n,this.li=r,this._i=null,this.fi=null,this.ni=null,this.di=this.wi.bind(this),this.mi=new io(Ii),this.Ti=!1,this.Ei=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ii=gc(this.persistenceKey,this.li),this.Ai="firestore_sequence_number_"+this.persistenceKey,this.mi=this.mi.rt(this.li,new _c),this.Ri=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Pi=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.gi=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.yi="firestore_online_state_"+this.persistenceKey,this.window.addEventListener("storage",this.di)}function Bc(){this.activeTargetIds=Eo}function zc(t,e){this.clientId=t,this.onlineState=e}function Gc(t,e){this.clientId=t,this.activeTargetIds=e}function Hc(t,e,n){this.targetId=t,this.state=e,this.error=n}function Wc(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Kc(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Ii(n,i);return 0===s?Ii(r,o):s}var Qc=(Zc.prototype.Yr=function(){return++this.Hr},Zc.prototype.Jr=function(t){var e,n=[t,this.Yr()];this.buffer.size<this.zr?this.buffer=this.buffer.add(n):Kc(n,e=this.buffer.last())<0&&(this.buffer=this.buffer.delete(e).add(n))},Object.defineProperty(Zc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Zc),Yc={Xr:!1,Zr:0,eo:0,no:0},Xc=(Jc.oo=function(t){return new Jc(t,Jc.ao,Jc.co)},Jc);function Jc(t,e,n){this.so=t,this.io=e,this.ro=n}function Zc(t){this.zr=t,this.buffer=new fo(Kc),this.Hr=0}Xc.uo=-1,Xc.ho=1048576,Xc.lo=41943040,Xc.ao=10,Xc.co=1e3,Xc._o=new Xc(Xc.lo,Xc.ao,Xc.co),Xc.fo=new Xc(Xc.uo,0,0);var $c=(nh.prototype.start=function(t){this.do.params.so!==Xc.uo&&this.To(t)},nh.prototype.stop=function(){this.mo&&(this.mo.cancel(),this.mo=null)},Object.defineProperty(nh.prototype,"Ti",{get:function(){return null!==this.mo},enumerable:!1,configurable:!0}),nh.prototype.To=function(n){var t=this,e=this.wo?3e5:6e4;Ur("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.mo=this.os.gn("lru_garbage_collection",e,function(){return m(t,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:this.mo=null,this.wo=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.Eo(this.do)];case 2:return t.sent(),[3,7];case 3:return Ha(e=t.sent())?(Ur("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,kf(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.To(n)];case 8:return t.sent(),[2]}})})})},nh),th=(eh.prototype.Ao=function(t,e){return this.Io.Ro(t).next(function(t){return Math.floor(e/100*t)})},eh.prototype.Po=function(t,e){var n=this;if(0===e)return Ca.resolve(vc.oi);var r=new Qc(e);return this.Io.De(t,function(t){return r.Jr(t.sequenceNumber)}).next(function(){return n.Io.yo(t,function(t){return r.Jr(t)})}).next(function(){return r.maxValue})},eh.prototype.Vo=function(t,e,n){return this.Io.Vo(t,e,n)},eh.prototype.po=function(t,e){return this.Io.po(t,e)},eh.prototype.bo=function(e,n){var r=this;return this.params.so===Xc.uo?(Ur("LruGarbageCollector","Garbage collection skipped; disabled"),Ca.resolve(Yc)):this.vo(e).next(function(t){return t<r.params.so?(Ur("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.so),Yc):r.So(e,n)})},eh.prototype.vo=function(t){return this.Io.vo(t)},eh.prototype.So=function(e,n){var r,i,o,s,u,a,c,h=this,f=Date.now();return this.Ao(e,this.params.io).next(function(t){return i=t>h.params.ro?(Ur("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.ro+" from "+t),h.params.ro):t,s=Date.now(),h.Po(e,i)}).next(function(t){return r=t,u=Date.now(),h.Vo(e,r,n)}).next(function(t){return o=t,a=Date.now(),h.po(e,r)}).next(function(t){return c=Date.now(),Pr()<=l.DEBUG&&Ur("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-f)+"ms"),Ca.resolve({Xr:!0,Zr:i,eo:o,no:t})})},eh);function eh(t,e){this.Io=t,this.params=e}function nh(t,e){this.do=t,this.os=e,this.wo=!1,this.mo=null}function rh(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=ih(e)),e=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}(t.get(n),e);return ih(e)}function ih(t){return t+""}function oh(t){var e=t.length;if(jr(2<=e),2===e)return jr(""===t.charAt(0)&&""===t.charAt(1)),Kr.g();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Fr(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Fr()}o=s+2}return new Kr(r)}var sh=function(t){this.Do=t};function uh(t,e){if(e.document)return n=t.Do,r=e.document,i=!!e.hasCommittedMutations,o=gs(n,r.name),s=ps(r.updateTime),u=new Tu({mapValue:{fields:r.fields}}),new Lu(o,s,u,{hasCommittedMutations:!!i});var n,r,i,o,s,u;if(e.noDocument){var a=Xr.$(e.noDocument.path),c=lh(e.noDocument.readTime);return new Pu(a,c,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var h=Xr.$(e.unknownDocument.path),f=lh(e.unknownDocument.version);return new Uu(h,f)}return Fr()}function ah(t,e,n){var r,i,o=ch(n),s=e.key.path.h().A();if(e instanceof Lu){var u={name:ys(r=t.Do,(i=e).key),fields:i.sn().mapValue.fields,updateTime:fs(r,i.version.X())},a=e.hasCommittedMutations;return new Hh(null,null,u,a,o,s)}if(e instanceof Pu){var c=e.key.path.A(),h=fh(e.version),f=e.hasCommittedMutations;return new Hh(null,new zh(c,h),null,f,o,s)}if(e instanceof Uu){var l=e.key.path.A(),p=fh(e.version);return new Hh(new Gh(l,p),null,null,!0,o,s)}return Fr()}function ch(t){var e=t.X();return[e.seconds,e.nanoseconds]}function hh(t){var e=new Ci(t[0],t[1]);return Mi.Y(e)}function fh(t){var e=t.X();return new Ph(e.seconds,e.nanoseconds)}function lh(t){var e=new Ci(t.seconds,t.nanoseconds);return Mi.Y(e)}function ph(e,t){var n=(t.baseMutations||[]).map(function(t){return _s(e.Do,t)}),r=t.mutations.map(function(t){return _s(e.Do,t)}),i=Ci.fromMillis(t.localWriteTimeMs);return new Sc(t.batchId,i,n,r)}function dh(t){var e,n=lh(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?lh(t.lastLimboFreeSnapshotVersion):Mi.min(),i=void 0!==t.query.documents?(jr(1===(e=t.query).documents.length),Qu(qu(ws(e.documents[0])))):function(t){var e,n=ws(t.parent),r=t.structuredQuery,i=r.from?r.from.length:0,o=null;0<i&&(jr(1===i),(e=r.from[0]).allDescendants?o=e.collectionId:n=n.child(e.collectionId));var s=[];r.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Os(t.unaryFilter.field);return ia.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Os(t.unaryFilter.field);return ia.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Os(t.unaryFilter.field);return ia.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Os(t.unaryFilter.field);return ia.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Fr()}}(e)]:void 0!==e.fieldFilter?[(n=e,ia.create(Os(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Fr()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(t).reduce(function(t,e){return t.concat(e)}):Fr():[];var n}(r.where));var u=[];r.orderBy&&(u=r.orderBy.map(function(t){return new ka(Os((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));var a,c,h=null;r.limit&&(a=r.limit,h=zi(c="object"==typeof a?a.value:a)?null:c);var f=null;r.startAt&&(f=Ds(r.startAt));var l=null;return r.endAt&&(l=Ds(r.endAt)),Qu(ju(n,o,u,s,h,"F",f,l))}(t.query);return new to(i,t.targetId,0,t.lastListenSequenceNumber,n,r,Ni.fromBase64String(t.resumeToken))}function vh(t,e){var n=fh(e.et),r=fh(e.lastLimboFreeSnapshotVersion),i=(Xi(e.target)?Ns:As)(t.Do,e.target),o=e.resumeToken.toBase64();return new Kh(e.targetId,Qi(e.target),n,o,e.sequenceNumber,r,i)}var yh=(gh.Fo=function(t,e,n,r){return jr(""!==t.uid),new gh(t.Xs()?t.uid:"",e,n,r)},gh.prototype.xo=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return bh(t).ss({index:jh.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},gh.prototype.$o=function(d,v,y,g){var m=this,w=Eh(d),b=bh(d);return b.add({}).next(function(t){jr("number"==typeof t);for(var e,n,r,i,o,s=new Sc(t,v,y,g),u=(e=m.serializer,n=m.userId,i=(r=s).baseMutations.map(function(t){return Ts(e.Do,t)}),o=r.mutations.map(function(t){return Ts(e.Do,t)}),new jh(n,r.batchId,r.rr.toMillis(),i,o)),a=[],c=new fo(function(t,e){return Ii(t.R(),e.R())}),h=0,f=g;h<f.length;h++){var l=f[h],p=qh.key(m.userId,l.key.path,t),c=c.add(l.key.path.h());a.push(b.put(u)),a.push(w.put(p,qh.PLACEHOLDER))}return c.forEach(function(t){a.push(m.Sr.ko(d,t))}),d.Vr(function(){m.No[t]=s.keys()}),Ca.xn(a).next(function(){return s})})},gh.prototype.Mo=function(t,e){var n=this;return bh(t).get(e).next(function(t){return t?(jr(t.userId===n.userId),ph(n.serializer,t)):null})},gh.prototype.Oo=function(t,n){var r=this;return this.No[n]?Ca.resolve(this.No[n]):this.Mo(t,n).next(function(t){if(t){var e=t.keys();return r.No[n]=e}return null})},gh.prototype.Lo=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return bh(t).ss({index:jh.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(jr(e.batchId>=i),o=ph(r.serializer,e)),n.done()}).next(function(){return o})},gh.prototype.Bo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return bh(t).ss({index:jh.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},gh.prototype.qo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return bh(t).Zn(jh.userMutationsIndex,n).next(function(t){return t.map(function(t){return ph(e.serializer,t)})})},gh.prototype.Cr=function(u,a){var c=this,t=qh.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),h=[];return Eh(u).ss({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=oh(i);if(r===c.userId&&a.path.isEqual(s))return bh(u).get(o).next(function(t){if(!t)throw Fr();jr(t.userId===c.userId),h.push(ph(c.serializer,t))});n.done()}).next(function(){return h})},gh.prototype.Mr=function(r,t){var a=this,c=new fo(Ii),i=[];return t.forEach(function(u){var t=qh.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=Eh(r).ss({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=oh(i);r===a.userId&&u.path.isEqual(s)?c=c.add(o):n.done()});i.push(n)}),Ca.xn(i).next(function(){return a.Uo(r,c)})},gh.prototype.Qr=function(t,e){var u=this,a=e.path,c=a.length+1,n=qh.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),h=new fo(Ii);return Eh(t).ss({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=oh(i);r===u.userId&&a.T(s)?s.length===c&&(h=h.add(o)):n.done()}).next(function(){return u.Uo(t,h)})},gh.prototype.Uo=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(bh(e).get(t).next(function(t){if(null===t)throw Fr();jr(t.userId===n.userId),r.push(ph(n.serializer,t))}))}),Ca.xn(i).next(function(){return r})},gh.prototype.Qo=function(e,n){var r=this;return wh(e.Wo,this.userId,n).next(function(t){return e.Vr(function(){r.jo(n.batchId)}),Ca.forEach(t,function(t){return r.Co.Ko(e,t)})})},gh.prototype.jo=function(t){delete this.No[t]},gh.prototype.Go=function(n){var o=this;return this.xo(n).next(function(t){if(!t)return Ca.resolve();var e=IDBKeyRange.lowerBound(qh.prefixForUser(o.userId)),i=[];return Eh(n).ss({range:e},function(t,e,n){var r;t[0]===o.userId?(r=oh(t[1]),i.push(r)):n.done()}).next(function(){jr(0===i.length)})})},gh.prototype.zo=function(t,e){return mh(t,this.userId,e)},gh.prototype.Ho=function(t){var e=this;return Ih(t).get(this.userId).next(function(t){return t||new Fh(e.userId,-1,"")})},gh);function gh(t,e,n,r){this.userId=t,this.serializer=e,this.Sr=n,this.Co=r,this.No={}}function mh(t,o,e){var n=qh.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return Eh(t).ss({range:r,ns:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function wh(t,e,n){var r=t.store(jh.store),i=t.store(qh.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.ss({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){jr(1===u)}));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=qh.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return Ca.xn(o).next(function(){return c})}function bh(t){return df.Un(t,jh.store)}function Eh(t){return df.Un(t,qh.store)}function Ih(t){return df.Un(t,Fh.store)}var Th,_h=(Nh.prototype.Tr=function(t,e,n){return Sh(t).put(Dh(e),n)},Nh.prototype.Ir=function(t,e){var n=Sh(t),r=Dh(e);return n.delete(r)},Nh.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.Yo(e,t)})},Nh.prototype.Ar=function(t,e){var n=this;return Sh(t).get(Dh(e)).next(function(t){return n.Jo(t)})},Nh.prototype.Xo=function(t,e){var n=this;return Sh(t).get(Dh(e)).next(function(t){var e=n.Jo(t);return e?{Zo:e,size:xh(t)}:null})},Nh.prototype.getEntries=function(t,e){var r=this,i=po;return this.ta(t,e,function(t,e){var n=r.Jo(e);i=i.rt(t,n)}).next(function(){return i})},Nh.prototype.ea=function(t,e){var r=this,i=po,o=new io(Xr.i);return this.ta(t,e,function(t,e){var n=r.Jo(e);o=n?(i=i.rt(t,n),o.rt(t,xh(e))):(i=i.rt(t,null),o.rt(t,0))}).next(function(){return{na:i,sa:o}})},Nh.prototype.ta=function(t,e,i){if(e.m())return Ca.resolve();var n=IDBKeyRange.bound(e.first().path.A(),e.last().path.A()),o=e.lt(),s=o.Et();return Sh(t).ss({range:n},function(t,e,n){for(var r=Xr.$(t);s&&Xr.i(s,r)<0;)i(s,null),s=o.Et();s&&s.isEqual(r)&&(i(s,e),s=o.It()?o.Et():null),s?n.Jn(s.path.A()):n.done()}).next(function(){for(;s;)i(s,null),s=o.It()?o.Et():null})},Nh.prototype.Or=function(t,i,e){var n,r,o,s=this,u=go,a=i.path.length+1,c={};return e.isEqual(Mi.min())?(n=i.path.A(),c.range=IDBKeyRange.lowerBound(n)):(r=i.path.A(),o=ch(e),c.range=IDBKeyRange.lowerBound([r,o],!0),c.index=Hh.collectionReadTimeIndex),Sh(t).ss(c,function(t,e,n){var r;t.length===a&&(r=uh(s.serializer,e),i.path.T(r.key.path)?r instanceof Lu&&ea(i,r)&&(u=u.rt(r.key,r)):n.done())}).next(function(){return u})},Nh.prototype.ia=function(t,e){var r=this,i=po,o=ch(e),n=Sh(t),s=IDBKeyRange.lowerBound(o,!0);return n.ss({index:Hh.readTimeIndex,range:s},function(t,e){var n=uh(r.serializer,e);i=i.rt(n.key,n),o=e.readTime}).next(function(){return{ra:i,readTime:hh(o)}})},Nh.prototype.oa=function(t){var e=Sh(t),r=Mi.min();return e.ss({index:Hh.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=hh(e.readTime)),n.done()}).next(function(){return r})},Nh.prototype.aa=function(t){return new Nh.ca(this,!!t&&t.ua)},Nh.prototype.ha=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Nh.prototype.getMetadata=function(t){return Ah(t).get(Wh.key).next(function(t){return jr(!!t),t})},Nh.prototype.Yo=function(t,e){return Ah(t).put(Wh.key,e)},Nh.prototype.Jo=function(t){if(t){var e=uh(this.serializer,t);return e instanceof Pu&&e.version.isEqual(Mi.min())?null:e}return null},Nh);function Nh(t,e){this.serializer=t,this.Sr=e}function Ah(t){return df.Un(t,Wh.store)}function Sh(t){return df.Un(t,Hh.store)}function Dh(t){return t.path.A()}function xh(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Fr();e=t.noDocument}return JSON.stringify(e).length}function Oh(t,e){var n=this;return(n=Th.call(this)||this).la=t,n.ua=e,n._a=new Ui(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}_h.ca=(o(Oh,Th=xc),Oh.prototype.gr=function(s){var u=this,a=[],c=0,h=new fo(function(t,e){return Ii(t.R(),e.R())});return this.dr.forEach(function(t,e){var n,r,i,o=u._a.get(t);e?(n=ah(u.la.serializer,e,u.readTime),h=h.add(t.path.h()),r=xh(n),c+=r-o,a.push(u.la.Tr(s,t,n))):(c-=o,u.ua?(i=ah(u.la.serializer,new Pu(t,Mi.min()),u.readTime),a.push(u.la.Tr(s,t,i))):a.push(u.la.Ir(s,t)))}),h.forEach(function(t){a.push(u.la.Sr.ko(s,t))}),a.push(this.la.updateMetadata(s,c)),Ca.xn(a)},Oh.prototype.Rr=function(t,e){var n=this;return this.la.Xo(t,e).next(function(t){return null===t?(n._a.set(e,0),null):(n._a.set(e,t.size),t.Zo)})},Oh.prototype.Pr=function(t,e){var n=this;return this.la.ea(t,e).next(function(t){var e=t.na;return t.sa.forEach(function(t,e){n._a.set(t,e)}),e})},Oh);var Rh=(Vh.prototype.ko=function(t,e){return this.fa.add(e),Ca.resolve()},Vh.prototype.Ur=function(t,e){return Ca.resolve(this.fa.getEntries(e))},Vh),kh=(Mh.prototype.add=function(t){var e=t._(),n=t.h(),r=this.index[e]||new fo(Kr.i),i=!r.has(n);return this.index[e]=r.add(n),i},Mh.prototype.has=function(t){var e=t._(),n=t.h(),r=this.index[e];return r&&r.has(n)},Mh.prototype.getEntries=function(t){return(this.index[t]||new fo(Kr.i)).A()},Mh),Lh=(Ch.prototype.createOrUpgrade=function(n,r,t,e){var i=this;jr(t<e&&0<=t&&e<=10);var o,s=new Wa(r);t<1&&1<=e&&(n.createObjectStore(Uh.store),(o=n).createObjectStore(Fh.store,{keyPath:Fh.keyPath}),o.createObjectStore(jh.store,{keyPath:jh.keyPath,autoIncrement:!0}).createIndex(jh.userMutationsIndex,jh.userMutationsKeyPath,{unique:!0}),o.createObjectStore(qh.store),Jh(n),n.createObjectStore(Hh.store));var u,a=Ca.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(Qh.store),u.deleteObjectStore(Kh.store),u.deleteObjectStore(Yh.store),Jh(n)),a=a.next(function(){return t=s.store(Yh.store),e=new Yh(0,0,Mi.min().X(),0),t.put(Yh.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(jh.store).Zn().next(function(t){r.deleteObjectStore(jh.store),r.createObjectStore(jh.store,{keyPath:jh.keyPath,autoIncrement:!0}).createIndex(jh.userMutationsIndex,jh.userMutationsKeyPath,{unique:!0});var e=i.store(jh.store),n=t.map(function(t){return e.put(t)});return Ca.xn(n)});var r,i})),a=a.next(function(){n.createObjectStore(Zh.store,{keyPath:Zh.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(Wh.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(Hh.store)).createIndex(Hh.readTimeIndex,Hh.readTimeIndexPath,{unique:!1}),t.createIndex(Hh.collectionReadTimeIndex,Hh.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},Ch.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Hh.store).ss(function(t,e){n+=xh(e)}).next(function(){var t=new Wh(n);return e.store(Wh.store).put(Wh.key,t)})},Ch.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(Fh.store),e=r.store(jh.store);return t.Zn().next(function(t){return Ca.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.Zn(jh.userMutationsIndex,t).next(function(t){return Ca.forEach(t,function(t){jr(t.userId===n.userId);var e=ph(i.serializer,t);return wh(r,n.userId,e).next(function(){})})})})})},Ch.prototype.ensureSequenceNumbers=function(t){var s=t.store(Qh.store),e=t.store(Hh.store);return t.store(Yh.store).get(Yh.key).next(function(i){var o=[];return e.ss(function(t,e){var n=new Kr(t),r=[0,rh(n)];o.push(s.get(r).next(function(t){return t?Ca.resolve():s.put(new Qh(0,rh(n),i.highestListenSequenceNumber))}))}).next(function(){return Ca.xn(o)})})},Ch.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(Xh.store,{keyPath:Xh.keyPath});function i(t){if(o.add(t)){var e=t._(),n=t.h();return r.put({collectionId:e,parent:rh(n)})}}var r=e.store(Xh.store),o=new kh;return e.store(Hh.store).ss({ns:!0},function(t,e){var n=new Kr(t);return i(n.h())}).next(function(){return e.store(qh.store).ss({ns:!0},function(t,e){t[0];var n=t[1],r=(t[2],oh(n));return i(r.h())})})},Ch.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store(Kh.store);return o.ss(function(t,e){var n=dh(e),r=vh(i.serializer,n);return o.put(r)})},Ch),Ph=function(t,e){this.seconds=t,this.nanoseconds=e},Uh=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function Ch(t){this.serializer=t}function Mh(){this.index={}}function Vh(){this.fa=new kh}Uh.store="owner",Uh.key="owner";var Fh=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Fh.store="mutationQueues",Fh.keyPath="userId";var jh=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};jh.store="mutations",jh.keyPath="batchId",jh.userMutationsIndex="userMutationsIndex",jh.userMutationsKeyPath=["userId","batchId"];var qh=(Bh.prefixForUser=function(t){return[t]},Bh.prefixForPath=function(t,e){return[t,rh(e)]},Bh.key=function(t,e,n){return[t,rh(e),n]},Bh);function Bh(){}qh.store="documentMutations",qh.PLACEHOLDER=new qh;var zh=function(t,e){this.path=t,this.readTime=e},Gh=function(t,e){this.path=t,this.version=e},Hh=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Hh.store="remoteDocuments",Hh.readTimeIndex="readTimeIndex",Hh.readTimeIndexPath="readTime",Hh.collectionReadTimeIndex="collectionReadTimeIndex",Hh.collectionReadTimeIndexPath=["parentPath","readTime"];var Wh=function(t){this.byteSize=t};Wh.store="remoteDocumentGlobal",Wh.key="remoteDocumentGlobalKey";var Kh=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Kh.store="targets",Kh.keyPath="targetId",Kh.queryTargetsIndexName="queryTargetsIndex",Kh.queryTargetsKeyPath=["canonicalId","targetId"];var Qh=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Qh.store="targetDocuments",Qh.keyPath=["targetId","path"],Qh.documentTargetsIndex="documentTargetsIndex",Qh.documentTargetsKeyPath=["path","targetId"];var Yh=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Yh.key="targetGlobalKey",Yh.store="targetGlobal";var Xh=function(t,e){this.collectionId=t,this.parent=e};function Jh(t){t.createObjectStore(Qh.store,{keyPath:Qh.keyPath}).createIndex(Qh.documentTargetsIndex,Qh.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Kh.store,{keyPath:Kh.keyPath}).createIndex(Kh.queryTargetsIndexName,Kh.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Yh.store)}Xh.store="collectionParents",Xh.keyPath=["collectionId","parent"];var Zh=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Zh.store="clientMetadata",Zh.keyPath="clientId";var $h=s(s(s([Fh.store,jh.store,qh.store,Hh.store,Kh.store,Uh.store,Yh.store,Qh.store],[Zh.store]),[Wh.store]),[Xh.store]),tf=(ef.prototype.ko=function(t,e){var n=this;if(this.da.has(e))return Ca.resolve();var r=e._(),i=e.h();t.Vr(function(){n.da.add(e)});var o={collectionId:r,parent:rh(i)};return nf(t).put(o)},ef.prototype.Ur=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[_i(i),""],!1,!0);return nf(t).Zn(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(oh(r.parent))}return o})},ef);function ef(){this.da=new kh}function nf(t){return df.Un(t,Xh.store)}var rf=(uf.prototype.next=function(){return this.wa+=2,this.wa},uf.ma=function(){return new uf(0)},uf.Ta=function(){return new uf(-1)},uf),of=(sf.prototype.Ea=function(n){var r=this;return this.Ia(n).next(function(t){var e=new rf(t.highestTargetId);return t.highestTargetId=e.next(),r.Aa(n,t).next(function(){return t.highestTargetId})})},sf.prototype.Ra=function(t){return this.Ia(t).next(function(t){return Mi.Y(new Ci(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},sf.prototype.Pa=function(t){return this.Ia(t).next(function(t){return t.highestListenSequenceNumber})},sf.prototype.ga=function(e,n,r){var i=this;return this.Ia(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.X()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Aa(e,t)})},sf.prototype.ya=function(e,n){var r=this;return this.Va(e,n).next(function(){return r.Ia(e).next(function(t){return t.targetCount+=1,r.pa(n,t),r.Aa(e,t)})})},sf.prototype.ba=function(t,e){return this.Va(t,e)},sf.prototype.va=function(e,t){var n=this;return this.Sa(e,t.targetId).next(function(){return af(e).delete(t.targetId)}).next(function(){return n.Ia(e)}).next(function(t){return jr(0<t.targetCount),--t.targetCount,n.Aa(e,t)})},sf.prototype.Vo=function(r,i,o){var s=this,u=0,a=[];return af(r).ss(function(t,e){var n=dh(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s.va(r,n)))}).next(function(){return Ca.xn(a)}).next(function(){return u})},sf.prototype.De=function(t,r){return af(t).ss(function(t,e){var n=dh(e);r(n)})},sf.prototype.Ia=function(t){return cf(t).get(Yh.key).next(function(t){return jr(null!==t),t})},sf.prototype.Aa=function(t,e){return cf(t).put(Yh.key,e)},sf.prototype.Va=function(t,e){return af(t).put(vh(this.serializer,e))},sf.prototype.pa=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},sf.prototype.Da=function(t){return this.Ia(t).next(function(t){return t.targetCount})},sf.prototype.Ca=function(t,i){var e=Qi(i),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),o=null;return af(t).ss({range:n,index:Kh.queryTargetsIndexName},function(t,e,n){var r=dh(e);Yi(i,r.target)&&(o=r,n.done())}).next(function(){return o})},sf.prototype.Na=function(n,t,r){var i=this,o=[],s=hf(n);return t.forEach(function(t){var e=rh(t.path);o.push(s.put(new Qh(r,e))),o.push(i.Co.Fa(n,r,t))}),Ca.xn(o)},sf.prototype.xa=function(n,t,r){var i=this,o=hf(n);return Ca.forEach(t,function(t){var e=rh(t.path);return Ca.xn([o.delete([r,e]),i.Co.$a(n,r,t)])})},sf.prototype.Sa=function(t,e){var n=hf(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},sf.prototype.ka=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=hf(t),o=bo();return r.ss({range:n,ns:!0},function(t,e,n){var r=oh(t[1]),i=new Xr(r);o=o.add(i)}).next(function(){return o})},sf.prototype.zo=function(t,e){var n=rh(e.path),r=IDBKeyRange.bound([n],[_i(n)],!1,!0),i=0;return hf(t).ss({index:Qh.documentTargetsIndex,ns:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},sf.prototype.qe=function(t,e){return af(t).get(e).next(function(t){return t?dh(t):null})},sf);function sf(t,e){this.Co=t,this.serializer=e}function uf(t){this.wa=t}function af(t){return df.Un(t,Kh.store)}function cf(t){return df.Un(t,Yh.store)}function hf(t){return df.Un(t,Qh.store)}var ff,lf="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",pf=(o(yf,ff=Rc),yf),df=(vf.Un=function(t,e){if(t instanceof pf)return Ma.Un(t.Wo,e);throw Fr()},vf.prototype.start=function(){var e=this;return this.Ja().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Rr(Or.FAILED_PRECONDITION,lf);return e.Xa(),e.Za(),e.tc(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.Ha.Pa(t)})}).then(function(t){e.Ba=new vc(t,e.Oa)}).then(function(){e.qa=!0}).catch(function(t){return e.za&&e.za.close(),Promise.reject(t)})},vf.prototype.ec=function(n){var t=this;return this.Ka=function(e){return m(t,void 0,void 0,function(){return w(this,function(t){return this.Ti?[2,n(e)]:[2]})})},n(this.isPrimary)},vf.prototype.nc=function(n){var t=this;this.za.jn(function(e){return m(t,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},vf.prototype.sc=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this._n.ds(function(){return m(e,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Ti?[4,this.Ja()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},vf.prototype.Ja=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return mf(e).put(new Zh(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.ic(e).next(function(t){t||(n.isPrimary=!1,n._n.Ds(function(){return n.Ka(!1)}))})}).next(function(){return n.rc(e)}).next(function(t){return n.isPrimary&&!t?n.oc(e).next(function(){return!1}):!!t&&n.ac(e).next(function(){return!0})})}).catch(function(t){if(Ha(t))return Ur("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return Ur("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n._n.Ds(function(){return n.Ka(t)}),n.isPrimary=t})},vf.prototype.ic=function(t){var e=this;return gf(t).get(Uh.key).next(function(t){return Ca.resolve(e.cc(t))})},vf.prototype.uc=function(t){return mf(t).delete(this.clientId)},vf.prototype.hc=function(){return m(this,void 0,void 0,function(){var e,n,r,i,o=this;return w(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.lc(this.ja,18e5)?[3,2]:(this.ja=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=vf.Un(t,Zh.store);return r.Zn().next(function(t){var e=o._c(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Ca.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.Ya)for(n=0,r=e;n<r.length;n++)i=r[n],this.Ya.removeItem(this.fc(i.clientId));t.label=2;case 2:return[2]}})})},vf.prototype.tc=function(){var t=this;this.Wa=this._n.gn("client_metadata_refresh",4e3,function(){return t.Ja().then(function(){return t.hc()}).then(function(){return t.tc()})})},vf.prototype.cc=function(t){return!!t&&t.ownerId===this.clientId},vf.prototype.rc=function(e){var i=this;return this.La?Ca.resolve(!0):gf(e).get(Uh.key).next(function(t){if(null!==t&&i.lc(t.leaseTimestampMs,5e3)&&!i.dc(t.ownerId)){if(i.cc(t)&&i.networkEnabled)return!0;if(!i.cc(t)){if(!t.allowTabSynchronization)throw new Rr(Or.FAILED_PRECONDITION,lf);return!1}}return!(!i.networkEnabled||!i.inForeground)||mf(e).Zn().next(function(t){return void 0===i._c(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Ur("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},vf.prototype.Si=function(){return m(this,void 0,void 0,function(){var n=this;return w(this,function(t){switch(t.label){case 0:return this.qa=!1,this.wc(),this.Wa&&(this.Wa.cancel(),this.Wa=null),this.mc(),this.Tc(),[4,this.za.runTransaction("readwrite",[Uh.store,Zh.store],function(t){var e=new pf(t,vc.oi);return n.oc(e).next(function(){return n.uc(e)})})];case 1:return t.sent(),this.za.close(),this.Ec(),[2]}})})},vf.prototype._c=function(t,e){var n=this;return t.filter(function(t){return n.lc(t.updateTimeMs,e)&&!n.dc(t.clientId)})},vf.prototype.Vi=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return mf(t).Zn().next(function(t){return e._c(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(vf.prototype,"Ti",{get:function(){return this.qa},enumerable:!1,configurable:!0}),vf.prototype.Ic=function(t){return yh.Fo(t,this.serializer,this.Sr,this.Co)},vf.prototype.Ac=function(){return this.Ha},vf.prototype.Rc=function(){return this.br},vf.prototype.Pc=function(){return this.Sr},vf.prototype.runTransaction=function(e,n,r){var i=this;Ur("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.za.runTransaction(t,$h,function(t){return o=new pf(t,i.Ba?i.Ba.next():vc.oi),"readwrite-primary"===n?i.ic(o).next(function(t){return!!t||i.rc(o)}).next(function(t){if(!t)throw Cr("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i._n.Ds(function(){return i.Ka(!1)}),new Rr(Or.FAILED_PRECONDITION,Oc);return r(o)}).next(function(t){return i.ac(o).next(function(){return t})}):i.gc(o).next(function(){return r(o)})}).then(function(t){return o.pr(),t})},vf.prototype.gc=function(t){var e=this;return gf(t).get(Uh.key).next(function(t){if(null!==t&&e.lc(t.leaseTimestampMs,5e3)&&!e.dc(t.ownerId)&&!e.cc(t)&&!(e.La||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Rr(Or.FAILED_PRECONDITION,lf)})},vf.prototype.ac=function(t){var e=new Uh(this.clientId,this.allowTabSynchronization,Date.now());return gf(t).put(Uh.key,e)},vf.On=function(){return Ma.On()},vf.prototype.oc=function(t){var e=this,n=gf(t);return n.get(Uh.key).next(function(t){return e.cc(t)?(Ur("IndexedDbPersistence","Releasing primary lease."),n.delete(Uh.key)):Ca.resolve()})},vf.prototype.lc=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Cr("Detected an update time that is in the future: "+t+" > "+n),1))},vf.prototype.Xa=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Qa=function(){t._n.ds(function(){return t.inForeground="visible"===t.document.visibilityState,t.Ja()})},this.document.addEventListener("visibilitychange",this.Qa),this.inForeground="visible"===this.document.visibilityState)},vf.prototype.mc=function(){this.Qa&&(this.document.removeEventListener("visibilitychange",this.Qa),this.Qa=null)},vf.prototype.Za=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Ua=function(){e.wc(),e._n.ds(function(){return e.Si()})},this.window.addEventListener("unload",this.Ua))},vf.prototype.Tc=function(){this.Ua&&(this.window.removeEventListener("unload",this.Ua),this.Ua=null)},vf.prototype.dc=function(t){var e;try{var n=null!==(null===(e=this.Ya)||void 0===e?void 0:e.getItem(this.fc(t)));return Ur("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Cr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},vf.prototype.wc=function(){if(this.Ya)try{this.Ya.setItem(this.fc(this.clientId),String(Date.now()))}catch(t){Cr("Failed to set zombie client id.",t)}},vf.prototype.Ec=function(){if(this.Ya)try{this.Ya.removeItem(this.fc(this.clientId))}catch(t){}},vf.prototype.fc=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},vf);function vf(t,e,n,r,i,o,s,u,a,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this._n=i,this.window=o,this.document=s,this.Oa=a,this.La=c,this.Ba=null,this.qa=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ua=null,this.inForeground=!1,this.Qa=null,this.Wa=null,this.ja=Number.NEGATIVE_INFINITY,this.Ka=function(t){return Promise.resolve()},!vf.On())throw new Rr(Or.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Co=new wf(this,r),this.Ga=e+"main",this.serializer=new sh(u),this.za=new Ma(this.Ga,10,new Lh(this.serializer)),this.Ha=new of(this.Co,this.serializer),this.Sr=new tf,this.br=new _h(this.serializer,this.Sr),this.window&&this.window.localStorage?this.Ya=this.window.localStorage:(this.Ya=null,!1===c&&Cr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function yf(t,e){var n=this;return(n=ff.call(this)||this).Wo=t,n.Ma=e,n}function gf(t){return df.Un(t,Uh.store)}function mf(t){return df.Un(t,Zh.store)}var wf=(bf.prototype.Ro=function(t){var n=this.yc(t);return this.db.Ac().Da(t).next(function(e){return n.next(function(t){return e+t})})},bf.prototype.yc=function(t){var e=0;return this.yo(t,function(t){e++}).next(function(){return e})},bf.prototype.De=function(t,e){return this.db.Ac().De(t,e)},bf.prototype.yo=function(t,n){return this.Vc(t,function(t,e){return n(e)})},bf.prototype.Fa=function(t,e,n){return Ef(t,n)},bf.prototype.$a=function(t,e,n){return Ef(t,n)},bf.prototype.Vo=function(t,e,n){return this.db.Ac().Vo(t,e,n)},bf.prototype.Ko=Ef,bf.prototype.bc=function(t,e){return r=e,i=!1,Ih(n=t).rs(function(t){return mh(n,t,r).next(function(t){return t&&(i=!0),Ca.resolve(!t)})}).next(function(){return i});var n,r,i},bf.prototype.po=function(r,i){var o=this,s=this.db.Rc().aa(),u=[],a=0;return this.Vc(r,function(e,t){var n;t<=i&&(n=o.bc(r,e).next(function(t){if(!t)return a++,s.Ar(r,e).next(function(){return s.Ir(e),hf(r).delete([0,rh(e.path)])})}),u.push(n))}).next(function(){return Ca.xn(u)}).next(function(){return s.apply(r)}).next(function(){return a})},bf.prototype.removeTarget=function(t,e){var n=e.nt(t.Ma);return this.db.Ac().ba(t,n)},bf.prototype.vc=Ef,bf.prototype.Vc=function(t,o){var s,e=hf(t),u=vc.oi;return e.ss({index:Qh.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==vc.oi&&o(new Xr(oh(s)),u),u=i,s=r):u=vc.oi}).next(function(){u!==vc.oi&&o(new Xr(oh(s)),u)})},bf.prototype.vo=function(t){return this.db.Rc().ha(t)},bf);function bf(t,e){this.db=t,this.do=new th(this,e)}function Ef(t,e){return hf(t).put((n=t.Ma,new Qh(0,rh(e.path),n)));var n}function If(t,e){var n=t.projectId;return t.W||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Tf=(_f.prototype.Eo=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.bo(t,n.Dc)})},_f);function _f(t,e,n){this.persistence=t,this.Sc=e,this.Dc=new io(Ii),this.Cc=new Ui(Qi,Yi),this.Nc=Mi.min(),this.vr=t.Ic(n),this.Fc=t.Rc(),this.Ha=t.Ac(),this.xc=new kc(this.Fc,this.vr,this.persistence.Pc()),this.Sc.$c(this.xc)}function Nf(t,h){var f=t;return f.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e,n,i,o,s,r,u,a=h.batch.keys(),c=f.Fc.aa({ua:!0});return e=f,n=t,o=c,s=(i=h).batch,r=s.keys(),u=Ca.resolve(),r.forEach(function(r){u=u.next(function(){return o.Ar(n,r)}).next(function(t){var e=t,n=i._r.get(r);jr(null!==n),(!e||e.version.L(n)<0)&&(e=s.ar(r,e,i))&&o.Tr(e,i.lr)})}),u.next(function(){return e.vr.Qo(n,s)}).next(function(){return c.apply(t)}).next(function(){return f.vr.Go(t)}).next(function(){return f.xc.$r(t,a)})})}function Af(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Ha.Ra(t)})}function Sf(t,s){var h=t,f=s.et,l=h.Dc;return h.persistence.runTransaction("Apply remote event","readwrite-primary",function(a){var i=h.Fc.aa({ua:!0});l=h.Dc;var c=[];s.Gt.forEach(function(t,e){var n,r,i,o,s,u=l.get(e);u&&(c.push(h.Ha.xa(a,t.ne,e).next(function(){return h.Ha.Na(a,t.te,e)})),0<(n=t.resumeToken).O()&&(r=u.st(n,f).nt(a.Ma),l=l.rt(e,r),i=u,s=t,jr(0<(o=r).resumeToken.O()),(0===i.resumeToken.O()||3e8<=o.et.J()-i.et.J()||0<s.te.size+s.ee.size+s.ne.size)&&c.push(h.Ha.ba(a,r))))});var t,o=po,n=bo();return s.Ht.forEach(function(t,e){n=n.add(t)}),c.push(i.getEntries(a,n).next(function(r){s.Ht.forEach(function(t,e){var n=r.get(t);e instanceof Pu&&e.version.isEqual(Mi.min())?(i.Ir(t,f),o=o.rt(t,e)):null==n||0<e.version.L(n.version)||0===e.version.L(n.version)&&n.hasPendingWrites?(i.Tr(e,f),o=o.rt(t,e)):Ur("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),s.Yt.has(t)&&c.push(h.persistence.Co.vc(a,t))})})),f.isEqual(Mi.min())||(t=h.Ha.Ra(a).next(function(t){return h.Ha.ga(a,a.Ma,f)}),c.push(t)),Ca.xn(c).next(function(){return i.apply(a)}).next(function(){return h.xc.kr(a,o)})}).then(function(t){return h.Dc=l,t})}function Df(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.Ha.Ca(e,r).next(function(t){return t?(n=t,Ca.resolve(n)):i.Ha.Ea(e).next(function(t){return n=new to(r,t,0,e.Ma),i.Ha.ya(e,n).next(function(){return n})})})}).then(function(t){var e=i.Dc.get(t.targetId);return(null===e||0<t.et.L(e.et))&&(i.Dc=i.Dc.rt(t.targetId,t),i.Cc.set(r,t.targetId)),t})}function xf(o,s,u){return m(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){switch(t.label){case 0:n=(e=o).Dc.get(s),r=u?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),u?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.Co.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!Ha(i=t.sent()))throw i;return Ur("LocalStore","Failed to update sequence numbers for target "+s+": "+i),[3,5];case 5:return e.Dc=e.Dc.remove(s),e.Cc.delete(n.target),[2]}})})}function Of(t,s,u){var a=t,c=Mi.min(),h=bo();return a.persistence.runTransaction("Execute query","readonly",function(e){return t=a,n=e,r=Qu(s),(void 0!==(o=(i=t).Cc.get(r))?Ca.resolve(i.Dc.get(o)):i.Ha.Ca(n,r)).next(function(t){if(t)return c=t.lastLimboFreeSnapshotVersion,a.Ha.ka(e,t.targetId).next(function(t){h=t})}).next(function(){return a.Sc.Or(e,s,u?c:Mi.min(),u?h:bo())}).next(function(t){return{documents:t,kc:h}});var t,n,r,i,o})}function Rf(t,e){var n=t,r=n.Ha,i=n.Dc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.qe(t,e).next(function(t){return t?t.target:null})})}function kf(e){return m(this,void 0,void 0,function(){return w(this,function(t){if(e.code!==Or.FAILED_PRECONDITION||e.message!==Oc)throw e;return Ur("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Lf(t,e){this.user=e,this.type="OAuth",this.zc={},this.zc.Authorization="Bearer "+t}function Pf(t,e,n,r,i){var o=this;this.zu=t,this.Hu=e,this.os=n,this.Yu={},this.Ju=[],this.Xu=new Map,this.Zu=new Set,this.th=[],this.eh=i,this.eh.nh(function(t){n.ds(function(){return m(o,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return vl(this)?(Ur("RemoteStore","Restarting streams for network reachability change."),[4,function(n){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return(e=n).Zu.add(4),[4,ul(e)];case 1:return t.sent(),e.sh.set("Unknown"),e.Zu.delete(4),[4,sl(e)];case 2:return t.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.sh=new Qf(n,r)}var Uf,Cf,Mf,Vf=(ol.prototype.m=function(){return this.Mc.m()},ol.prototype.Fa=function(t,e){var n=new Ff(t,e);this.Mc=this.Mc.add(n),this.Lc=this.Lc.add(n)},ol.prototype.qc=function(t,e){var n=this;t.forEach(function(t){return n.Fa(t,e)})},ol.prototype.$a=function(t,e){this.Uc(new Ff(t,e))},ol.prototype.Qc=function(t,e){var n=this;t.forEach(function(t){return n.$a(t,e)})},ol.prototype.Wc=function(t){var e=this,n=new Xr(new Kr([])),r=new Ff(n,t),i=new Ff(n,t+1),o=[];return this.Lc.Nt([r,i],function(t){e.Uc(t),o.push(t.key)}),o},ol.prototype.jc=function(){var e=this;this.Mc.forEach(function(t){return e.Uc(t)})},ol.prototype.Uc=function(t){this.Mc=this.Mc.delete(t),this.Lc=this.Lc.delete(t)},ol.prototype.Kc=function(t){var e=new Xr(new Kr([])),n=new Ff(e,t),r=new Ff(e,t+1),i=bo();return this.Lc.Nt([n,r],function(t){i=i.add(t.key)}),i},ol.prototype.zo=function(t){var e=new Ff(t,0),n=this.Mc.xt(e);return null!==n&&t.isEqual(n.key)},ol),Ff=(il.Oc=function(t,e){return Xr.i(t.key,e.key)||Ii(t.Gc,e.Gc)},il.Bc=function(t,e){return Ii(t.Gc,e.Gc)||Xr.i(t.key,e.key)},il),jf=(rl.prototype.getToken=function(){return Promise.resolve(null)},rl.prototype.Yc=function(){},rl.prototype.Jc=function(t){(this.Hc=t)(lc.UNAUTHENTICATED)},rl.prototype.Xc=function(){this.Hc=null},rl),qf=(nl.prototype.getToken=function(){var e=this,n=this.eu,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.eu!==n?(Ur("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(jr("string"==typeof t.accessToken),new Lf(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},nl.prototype.Yc=function(){this.forceRefresh=!0},nl.prototype.Jc=function(t){this.Hc=t,this.tu&&t(this.currentUser)},nl.prototype.Xc=function(){this.auth&&this.auth.removeAuthTokenListener(this.Zc),this.Zc=null,this.Hc=null},nl.prototype.nu=function(){var t=this.auth&&this.auth.getUid();return jr(null===t||"string"==typeof t),new lc(t)},nl),Bf=(Object.defineProperty(el.prototype,"zc",{get:function(){var t={"X-Goog-AuthUser":this.iu},e=this.su.auth.ru([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),el),zf=(tl.prototype.getToken=function(){return Promise.resolve(new Bf(this.su,this.iu))},tl.prototype.Jc=function(t){t(lc.ei)},tl.prototype.Xc=function(){},tl.prototype.Yc=function(){},tl),Gf=($f.prototype.lu=function(){return 1===this.state||2===this.state||4===this.state},$f.prototype._u=function(){return 2===this.state},$f.prototype.start=function(){3!==this.state?this.auth():this.fu()},$f.prototype.stop=function(){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.lu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},$f.prototype.du=function(){this.state=0,this.gs.reset()},$f.prototype.wu=function(){var t=this;this._u()&&null===this.hu&&(this.hu=this._n.gn(this.ou,6e4,function(){return t.mu()}))},$f.prototype.Tu=function(t){this.Eu(),this.stream.send(t)},$f.prototype.mu=function(){return m(this,void 0,void 0,function(){return w(this,function(t){return this._u()?[2,this.close(0)]:[2]})})},$f.prototype.Eu=function(){this.hu&&(this.hu.cancel(),this.hu=null)},$f.prototype.close=function(e,n){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Eu(),this.gs.cancel(),this.uu++,3!==e?this.gs.reset():n&&n.code===Or.RESOURCE_EXHAUSTED?(Cr(n.toString()),Cr("Using maximum backoff delay to prevent overloading the backend."),this.gs.An()):n&&n.code===Or.UNAUTHENTICATED&&this.cu.Yc(),null!==this.stream&&(this.Iu(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Au(n)];case 1:return t.sent(),[2]}})})},$f.prototype.Iu=function(){},$f.prototype.auth=function(){var n=this;this.state=1;var t=this.Ru(this.uu),e=this.uu;this.cu.getToken().then(function(t){n.uu===e&&n.Pu(t)},function(e){t(function(){var t=new Rr(Or.UNKNOWN,"Fetching auth token failed: "+e.message);return n.gu(t)})})},$f.prototype.Pu=function(t){var e=this,n=this.Ru(this.uu);this.stream=this.yu(t),this.stream.Vu(function(){n(function(){return e.state=2,e.listener.Vu()})}),this.stream.Au(function(t){n(function(){return e.gu(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},$f.prototype.fu=function(){var t=this;this.state=4,this.gs.Rn(function(){return m(t,void 0,void 0,function(){return w(this,function(t){return this.state=0,this.start(),[2]})})})},$f.prototype.gu=function(t){return Ur("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},$f.prototype.Ru=function(e){var n=this;return function(t){n._n.ds(function(){return n.uu===e?t():(Ur("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},$f),Hf=(o(Zf,Mf=Gf),Zf.prototype.yu=function(t){return this.au.pu("Listen",t)},Zf.prototype.onMessage=function(t){this.gs.reset();var e=function(t,e){var n,r,i,o;if("targetChange"in e){e.targetChange;var s="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Fr(),u=e.targetChange.targetIds||[],a=(i=e.targetChange.resumeToken,t.Ue?(jr(void 0===i||"string"==typeof i),Ni.fromBase64String(i||"")):(jr(void 0===i||i instanceof Uint8Array),Ni.fromUint8Array(i||new Uint8Array))),c=e.targetChange.cause,h=c&&(r=void 0===(n=c).code?Or.UNKNOWN:ro(n.code),new Rr(r,n.message||"")),f=new xo(s,u,a,h||null)}else if("documentChange"in e){e.documentChange;var l=e.documentChange;l.document,l.document.name,l.document.updateTime;var p=gs(t,l.document.name),d=ps(l.document.updateTime),v=new Tu({mapValue:{fields:l.document.fields}}),y=new Lu(p,d,v,{}),g=l.targetIds||[],m=l.removedTargetIds||[];f=new So(g,m,y.key,y)}else if("documentDelete"in e){e.documentDelete;var w=e.documentDelete;w.document;var b=gs(t,w.document),E=w.readTime?ps(w.readTime):Mi.min(),I=new Pu(b,E),T=w.removedTargetIds||[];f=new So([],T,I.key,I)}else if("documentRemove"in e){e.documentRemove;var _=e.documentRemove;_.document;var N=gs(t,_.document),A=_.removedTargetIds||[];f=new So([],A,N,null)}else{if(!("filter"in e))return Fr();e.filter;var S=e.filter;S.targetId;var D=S.count||0,x=new Ji(D),O=S.targetId;f=new Do(O,x)}return f}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Mi.min();var e=t.targetChange;return(!e.targetIds||!e.targetIds.length)&&e.readTime?ps(e.readTime):Mi.min()}(t);return this.listener.bu(e,n)},Zf.prototype.vu=function(t){var e,n,r,i,o={};o.database=bs(this.serializer),o.addTarget=(e=this.serializer,i=(n=t).target,(r=Xi(i)?{documents:Ns(e,i)}:{query:As(e,i)}).targetId=n.targetId,0<n.resumeToken.O()&&(r.resumeToken=ls(e,n.resumeToken)),r);var s,u,a=(this.serializer,s=t,null==(u=function(){switch(s.tt){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Fr()}}())?null:{"goog-listen-tags":u});a&&(o.labels=a),this.Tu(o)},Zf.prototype.Su=function(t){var e={};e.database=bs(this.serializer),e.removeTarget=t,this.Tu(e)},Zf),Wf=(o(Jf,Cf=Gf),Object.defineProperty(Jf.prototype,"Cu",{get:function(){return this.Du},enumerable:!1,configurable:!0}),Jf.prototype.start=function(){this.Du=!1,this.lastStreamToken=void 0,Cf.prototype.start.call(this)},Jf.prototype.Iu=function(){this.Du&&this.Nu([])},Jf.prototype.yu=function(t){return this.au.pu("Write",t)},Jf.prototype.onMessage=function(t){if(jr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Du){this.gs.reset();var e=(r=t.writeResults,i=t.commitTime,r&&0<r.length?(jr(void 0!==i),r.map(function(t){return function(t,e){var n=t.updateTime?ps(t.updateTime):ps(e);n.isEqual(Mi.min())&&(n=ps(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new $s(n,r)}(t,i)})):[]),n=ps(t.commitTime);return this.listener.Fu(n,e)}var r,i;return jr(!t.writeResults||0===t.writeResults.length),this.Du=!0,this.listener.xu()},Jf.prototype.$u=function(){var t={};t.database=bs(this.serializer),this.Tu(t)},Jf.prototype.Nu=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Ts(e.serializer,t)})};this.Tu(n)},Jf),Kf=(o(Xf,Uf=function(){}),Xf.prototype.Mu=function(){if(this.ku)throw new Rr(Or.FAILED_PRECONDITION,"The client has already been terminated.")},Xf.prototype.Ou=function(e,n,r){var i=this;return this.Mu(),this.credentials.getToken().then(function(t){return i.au.Ou(e,n,r,t)}).catch(function(t){throw t.code===Or.UNAUTHENTICATED&&i.credentials.Yc(),t})},Xf.prototype.Lu=function(e,n,r){var i=this;return this.Mu(),this.credentials.getToken().then(function(t){return i.au.Lu(e,n,r,t)}).catch(function(t){throw t.code===Or.UNAUTHENTICATED&&i.credentials.Yc(),t})},Xf.prototype.terminate=function(){this.ku=!1},Xf),Qf=(Yf.prototype.Qu=function(){var t=this;0===this.Bu&&(this.Wu("Unknown"),this.qu=this.os.gn("online_state_timeout",1e4,function(){return t.qu=null,t.ju("Backend didn't respond within 10 seconds."),t.Wu("Offline"),Promise.resolve()}))},Yf.prototype.Ku=function(t){"Online"===this.state?this.Wu("Unknown"):(this.Bu++,1<=this.Bu&&(this.Gu(),this.ju("Connection failed 1 times. Most recent error: "+t.toString()),this.Wu("Offline")))},Yf.prototype.set=function(t){this.Gu(),this.Bu=0,"Online"===t&&(this.Uu=!1),this.Wu(t)},Yf.prototype.Wu=function(t){t!==this.state&&(this.state=t,this.fi(t))},Yf.prototype.ju=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Uu?(Cr(e),this.Uu=!1):Ur("OnlineStateTracker",e)},Yf.prototype.Gu=function(){null!==this.qu&&(this.qu.cancel(),this.qu=null)},Yf);function Yf(t,e){this.os=t,this.fi=e,this.state="Unknown",this.Bu=0,this.qu=null,this.Uu=!0}function Xf(t,e,n){var r=this;return(r=Uf.call(this)||this).credentials=t,r.au=e,r.serializer=n,r.ku=!1,r}function Jf(t,e,n,r,i){var o=this;return(o=Cf.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.Du=!1,o}function Zf(t,e,n,r,i){var o=this;return(o=Mf.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function $f(t,e,n,r,i,o){this._n=t,this.ou=n,this.au=r,this.cu=i,this.listener=o,this.state=0,this.uu=0,this.hu=null,this.stream=null,this.gs=new Ua(t,e)}function tl(t,e){this.su=t,this.iu=e}function el(t,e){this.su=t,this.iu=e,this.type="FirstParty",this.user=lc.ei}function nl(t){var e=this;this.Zc=null,this.currentUser=lc.UNAUTHENTICATED,this.tu=!1,this.eu=0,this.Hc=null,this.forceRefresh=!1,this.Zc=function(){e.eu++,e.currentUser=e.nu(),e.tu=!0,e.Hc&&e.Hc(e.currentUser)},this.eu=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Zc):(this.Zc(null),t.get().then(function(t){e.auth=t,e.Zc&&e.auth.addAuthTokenListener(e.Zc)},function(){}))}function rl(){this.Hc=null}function il(t,e){this.key=t,this.Gc=e}function ol(){this.Mc=new fo(Ff.Oc),this.Lc=new fo(Ff.Bc)}function sl(r){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:if(!vl(r))return[3,4];e=0,n=r.th,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function ul(r){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:e=0,n=r.th,t.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:t.sent(),t.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function al(n){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return e=n,Ur("RemoteStore","RemoteStore shutting down."),e.Zu.add(5),[4,ul(e)];case 1:return t.sent(),e.eh.Si(),e.sh.set("Unknown"),[2]}})})}function cl(t,e){var n=t;n.Xu.has(e.targetId)||(n.Xu.set(e.targetId,e),dl(n)?pl(n):_l(n)._u()&&fl(n,e))}function hl(t,e){var n=t,r=_l(n);n.Xu.delete(e),r._u()&&ll(n,e),0===n.Xu.size&&(r._u()?r.wu():vl(n)&&n.sh.set("Unknown"))}function fl(t,e){t.ih.Ee(e.targetId),_l(t).vu(e)}function ll(t,e){t.ih.Ee(e),_l(t).Su(e)}function pl(e){e.ih=new Ro({Be:function(t){return e.Yu.Be(t)},qe:function(t){return e.Xu.get(t)||null}}),_l(e).start(),e.sh.Qu()}function dl(t){return vl(t)&&!_l(t).lu()&&0<t.Xu.size}function vl(t){return 0===t.Zu.size}function yl(t){t.ih=void 0}function gl(u,a,c){return m(this,void 0,void 0,function(){var n,o,s;return w(this,function(t){switch(t.label){case 0:if(u.sh.set("Online"),!(a instanceof xo&&2===a.state&&a.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,function(o,s){return m(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){switch(t.label){case 0:e=s.cause,n=0,r=s.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],o.Xu.has(i)?[4,o.Yu.rh(i,e)]:[3,3]):[3,5];case 2:t.sent(),o.Xu.delete(i),o.ih.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})}(u,a)];case 2:return t.sent(),[3,5];case 3:return n=t.sent(),Ur("RemoteStore","Failed to remove targets %s: %s ",a.targetIds.join(","),n),[4,ml(u,n)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(a instanceof So?u.ih.pe(a):a instanceof Do?u.ih.xe(a):u.ih.Se(a),c.isEqual(Mi.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,Af(u.zu)];case 8:return o=t.sent(),0<=c.L(o)?[4,(i=c,(e=(r=u).ih.Me(i)).Gt.forEach(function(t,e){var n;0<t.resumeToken.O()&&((n=r.Xu.get(e))&&r.Xu.set(e,n.st(t.resumeToken,i)))}),e.zt.forEach(function(t){var e,n=r.Xu.get(t);n&&(r.Xu.set(t,n.st(Ni.B,n.et)),ll(r,t),e=new to(n.target,t,1,n.sequenceNumber),fl(r,e))}),r.Yu.oh(e))]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Ur("RemoteStore","Failed to raise snapshot:",s=t.sent()),[4,ml(u,s)];case 12:return t.sent(),[3,13];case 13:return[2]}var r,i,e})})}function ml(n,r,i){return m(this,void 0,void 0,function(){var e=this;return w(this,function(t){switch(t.label){case 0:if(!Ha(r))throw r;return n.Zu.add(1),[4,ul(n)];case 1:return t.sent(),n.sh.set("Offline"),i=i||function(){return Af(n.zu)},n.os.Ds(function(){return m(e,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return Ur("RemoteStore","Retrying IndexedDB access"),[4,i()];case 1:return t.sent(),n.Zu.delete(1),[4,sl(n)];case 2:return t.sent(),[2]}})})}),[2]}})})}function wl(e,n){return n().catch(function(t){return ml(e,t,n)})}function bl(c){return m(this,void 0,void 0,function(){var i,o,s,u,a;return w(this,function(t){switch(t.label){case 0:o=Nl(i=c),s=0<i.Ju.length?i.Ju[i.Ju.length-1].batchId:-1,t.label=1;case 1:if(!(vl(i)&&i.Ju.length<10))return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(e=i.zu,n=s,(r=e).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===n&&(n=-1),r.vr.Lo(t,n)}))];case 3:return null===(u=t.sent())?(0===i.Ju.length&&o.wu(),[3,7]):(s=u.batchId,function(t,e){t.Ju.push(e);var n=Nl(t);n._u()&&n.Cu&&n.Nu(e.mutations)}(i,u),[3,6]);case 4:return a=t.sent(),[4,ml(i,a)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return El(i)&&Il(i),[2]}var e,n,r})})}function El(t){return vl(t)&&!Nl(t).lu()&&0<t.Ju.length}function Il(t){Nl(t).start()}function Tl(n,r){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return e=n,r?(e.Zu.delete(2),[4,sl(e)]):[3,2];case 1:return t.sent(),[3,5];case 2:return r?[3,4]:(e.Zu.add(2),[4,ul(e)]);case 3:t.sent(),e.sh.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})}function _l(n){var t,e,r,i,o=this;return n.hh||(n.hh=(t=n.Hu,e=n.os,r={Vu:function(n){return m(this,void 0,void 0,function(){return w(this,function(t){return n.Xu.forEach(function(t,e){fl(n,t)}),[2]})})}.bind(null,n),Au:function(e,n){return m(this,void 0,void 0,function(){return w(this,function(t){return yl(e),dl(e)?(e.sh.Ku(n),pl(e)):e.sh.set("Unknown"),[2]})})}.bind(null,n),bu:gl.bind(null,n)},(i=t).Mu(),new Hf(e,i.au,i.credentials,i.serializer,r)),n.th.push(function(e){return m(o,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return e?(n.hh.du(),dl(n)?pl(n):n.sh.set("Unknown"),[3,3]):[3,1];case 1:return[4,n.hh.stop()];case 2:t.sent(),yl(n),t.label=3;case 3:return[2]}})})})),n.hh}function Nl(n){var t,e,r,i,o=this;return n.lh||(n.lh=(t=n.Hu,e=n.os,r={Vu:function(e){return m(this,void 0,void 0,function(){return w(this,function(t){return Nl(e).$u(),[2]})})}.bind(null,n),Au:function(e,n){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return n&&Nl(e).Cu?[4,function(r,i){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:return no(n=i.code)&&n!==Or.ABORTED?(e=r.Ju.shift(),Nl(r).du(),[4,wl(r,function(){return r.Yu.uh(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,bl(r)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}(e,n)]:[3,2];case 1:t.sent(),t.label=2;case 2:return El(e)&&Il(e),[2]}})})}.bind(null,n),xu:function(o){return m(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){for(e=Nl(o),n=0,r=o.Ju;n<r.length;n++)i=r[n],e.Nu(i.mutations);return[2]})})}.bind(null,n),Fu:function(r,i,o){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:return e=r.Ju.shift(),n=Dc.from(e,i,o),[4,wl(r,function(){return r.Yu.ah(n)})];case 1:return t.sent(),[4,bl(r)];case 2:return t.sent(),[2]}})})}.bind(null,n)},(i=t).Mu(),new Wf(e,i.au,i.credentials,i.serializer,r)),n.th.push(function(e){return m(o,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return e?(n.lh.du(),[4,bl(n)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,n.lh.stop()];case 3:t.sent(),0<n.Ju.length&&(Ur("RemoteStore","Stopping write stream with "+n.Ju.length+" pending writes"),n.Ju=[]),t.label=4;case 4:return[2]}})})})),n.lh}var Al=function(t){this.key=t},Sl=function(t){this.key=t},Dl=(Object.defineProperty(Ll.prototype,"Th",{get:function(){return this._h},enumerable:!1,configurable:!0}),Ll.prototype.Eh=function(t,e){var u=this,a=e?e.Ih:new To,c=e?e.mh:this.mh,h=e?e.Qt:this.Qt,f=c,l=!1,p=Bu(this.query)&&c.size===this.query.limit?c.last():null,d=zu(this.query)&&c.size===this.query.limit?c.first():null;if(t.ut(function(t,e){var n=c.get(t),r=(r=e instanceof Lu?e:null)&&(ea(u.query,r)?r:null),i=!!n&&u.Qt.has(n.key),o=!!r&&(r.Ye||u.Qt.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.Ah(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.wh(r,p)||d&&u.wh(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(h=r?(f=f.add(r),o?h.add(t):h.delete(t)):(f=f.delete(t),h.delete(t)))}),Bu(this.query)||zu(this.query))for(;f.size>this.query.limit;){var n=Bu(this.query)?f.last():f.first(),f=f.delete(n.key),h=h.delete(n.key);a.track({type:1,doc:n})}return{mh:f,Ih:a,Rh:l,Qt:h}},Ll.prototype.Ah=function(t,e){return t.Ye&&e.hasCommittedMutations&&!e.Ye},Ll.prototype.gr=function(t,e,n){var o=this,r=this.mh;this.mh=t.mh,this.Qt=t.Qt;var i=t.Ih.qt();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.wh(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Fr()}}var r,i}),this.Ph(n);var s=e?this.gh():[],u=0===this.dh.size&&this.Zt?1:0,a=u!==this.fh;return this.fh=u,0!==i.length||a?{snapshot:new _o(this.query,t.mh,r,i,t.Qt,0==u,a,!1),yh:s}:{yh:s}},Ll.prototype.Us=function(t){return this.Zt&&"Offline"===t?(this.Zt=!1,this.gr({mh:this.mh,Ih:new To,Qt:this.Qt,Rh:!1},!1)):{yh:[]}},Ll.prototype.Vh=function(t){return!this._h.has(t)&&!!this.mh.has(t)&&!this.mh.get(t).Ye},Ll.prototype.Ph=function(t){var e=this;t&&(t.te.forEach(function(t){return e._h=e._h.add(t)}),t.ee.forEach(function(t){}),t.ne.forEach(function(t){return e._h=e._h.delete(t)}),this.Zt=t.Zt)},Ll.prototype.gh=function(){var e=this;if(!this.Zt)return[];var n=this.dh;this.dh=bo(),this.mh.forEach(function(t){e.Vh(t.key)&&(e.dh=e.dh.add(t.key))});var r=[];return n.forEach(function(t){e.dh.has(t)||r.push(new Sl(t))}),this.dh.forEach(function(t){n.has(t)||r.push(new Al(t))}),r},Ll.prototype.ph=function(t){this._h=t.kc,this.dh=bo();var e=this.Eh(t.documents);return this.gr(e,!0)},Ll.prototype.bh=function(){return _o.Kt(this.query,this.mh,this.Qt,0===this.fh)},Ll),xl=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Ol=function(t){this.key=t,this.Sh=!1},Rl=(Object.defineProperty(kl.prototype,"jh",{get:function(){return!0===this.Wh},enumerable:!1,configurable:!0}),kl);function kl(t,e,n,r,i,o){this.zu=t,this.Dh=e,this.Ch=n,this.Nh=r,this.currentUser=i,this.Fh=o,this.xh={},this.$h=new Ui($u,Zu),this.kh=new Map,this.Mh=[],this.Oh=new io(Xr.i),this.Lh=new Map,this.Bh=new Vf,this.qh={},this.Uh=new Map,this.Qh=rf.Ta(),this.onlineState="Unknown",this.Wh=void 0}function Ll(t,e){this.query=t,this._h=e,this.fh=null,this.Zt=!1,this.dh=bo(),this.Qt=bo(),this.wh=na(t),this.mh=new Io(this.wh)}function Pl(u,a,c,h){return m(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return u.Kh=function(t,e,n){return function(i,o,s,u){return m(this,void 0,void 0,function(){var n,e,r;return w(this,function(t){switch(t.label){case 0:return(n=o.view.Eh(s)).Rh?[4,Of(i.zu,o.query,!1).then(function(t){var e=t.documents;return o.view.Eh(e,n)})]:[3,2];case 1:n=t.sent(),t.label=2;case 2:return e=u&&u.Gt.get(o.targetId),r=o.view.gr(n,i.jh,e),[2,(Bl(i,o.targetId,r.yh),r.snapshot)]}})})}(u,t,e,n)},[4,Of(u.zu,a,!0)];case 1:return e=t.sent(),n=new Dl(a,e.kc),r=n.Eh(e.documents),i=Ao.Xt(c,h&&"Offline"!==u.onlineState),o=n.gr(r,u.jh,i),Bl(u,c,o.yh),s=new xl(a,c,n),[2,(u.$h.set(a,s),u.kh.has(c)?u.kh.get(c).push(a):u.kh.set(c,[a]),o.snapshot)]}})})}function Ul(n,i){return m(this,void 0,void 0,function(){var r,e;return w(this,function(t){switch(t.label){case 0:r=n,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,Sf(r.zu,i)];case 2:return e=t.sent(),i.Gt.forEach(function(t,e){var n=r.Lh.get(e);n&&(jr(t.te.size+t.ee.size+t.ne.size<=1),0<t.te.size?n.Sh=!0:0<t.ee.size?jr(n.Sh):0<t.ne.size&&(jr(n.Sh),n.Sh=!1))}),[4,Gl(r,e,i)];case 3:return t.sent(),[3,6];case 4:return[4,kf(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}function Cl(t,r,e){var i,n=t;(n.jh&&0===e||!n.jh&&1===e)&&(i=[],n.$h.forEach(function(t,e){var n=e.view.Us(r);n.snapshot&&i.push(n.snapshot)}),function(t,i){var e=t;e.onlineState=i;var o=!1;e.Ls.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].Us(i)&&(o=!0)}),o&&hc(e)}(n.Ch,r),i.length&&n.xh.bu(i),n.onlineState=r,n.jh&&n.Nh.ji(r))}function Ml(s,u,a){return m(this,void 0,void 0,function(){var n,o;return w(this,function(t){switch(t.label){case 0:n=s,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=n.zu,r=u,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.vr.Mo(e,r).next(function(t){return jr(null!==t),n=t.keys(),i.vr.Qo(e,t)}).next(function(){return i.vr.Go(e)}).next(function(){return i.xc.$r(e,n)})}))];case 2:return o=t.sent(),Fl(n,u,a),Vl(n,u),n.Nh.$i(u,"rejected",a),[4,Gl(n,o)];case 3:return t.sent(),[3,6];case 4:return[4,kf(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})}function Vl(t,e){(t.Uh.get(e)||[]).forEach(function(t){t.resolve()}),t.Uh.delete(e)}function Fl(t,e,n){var r,i=t,o=i.qh[i.currentUser.Zs()];o&&((r=o.get(e))&&(n?r.reject(n):r.resolve(),o=o.remove(e)),i.qh[i.currentUser.Zs()]=o)}function jl(e,t,n){void 0===n&&(n=null),e.Nh.Li(t);for(var r=0,i=e.kh.get(t);r<i.length;r++){var o=i[r];e.$h.delete(o),n&&e.xh.Gh(o,n)}e.kh.delete(t),e.jh&&e.Bh.Wc(t).forEach(function(t){e.Bh.zo(t)||ql(e,t)})}function ql(t,e){var n=t.Oh.get(e);null!==n&&(hl(t.Dh,n),t.Oh=t.Oh.remove(e),t.Lh.delete(n),zl(t))}function Bl(t,e,n){for(var r,i,o=0,s=n;o<s.length;o++){var u=s[o];u instanceof Al?(t.Bh.Fa(u.key,e),r=t,i=void 0,i=u.key,r.Oh.get(i)||(Ur("SyncEngine","New document in limbo: "+i),r.Mh.push(i),zl(r))):u instanceof Sl?(Ur("SyncEngine","Document no longer in limbo: "+u.key),t.Bh.$a(u.key,e),t.Bh.zo(u.key)||ql(t,u.key)):Fr()}}function zl(t){for(;0<t.Mh.length&&t.Oh.size<t.Fh;){var e=t.Mh.shift(),n=t.Qh.next();t.Lh.set(n,new Ol(e)),t.Oh=t.Oh.rt(e,n),cl(t.Dh,new to(Qu(qu(e.path)),n,2,vc.oi))}}function Gl(n,s,u){return m(this,void 0,void 0,function(){var r,i,o,e;return w(this,function(t){switch(t.label){case 0:return i=[],o=[],e=[],(r=n).$h.m()?[3,3]:(r.$h.forEach(function(t,n){e.push(r.Kh(n,s,u).then(function(t){var e;t&&(r.jh&&r.Nh.Ui(n.targetId,t.fromCache?"not-current":"current"),i.push(t),e=Lc.Gr(n.targetId,t),o.push(e))}))}),[4,Promise.all(e)]);case 1:return t.sent(),r.xh.bu(i),[4,function(h,f){return m(this,void 0,void 0,function(){var r,e,n,i,o,s,u,a,c;return w(this,function(t){switch(t.label){case 0:r=h,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Ca.forEach(f,function(e){return Ca.forEach(e.jr,function(t){return r.persistence.Co.Fa(n,e.targetId,t)}).next(function(){return Ca.forEach(e.Kr,function(t){return r.persistence.Co.$a(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!Ha(e=t.sent()))throw e;return Ur("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=f;n<i.length;n++)o=i[n],s=o.targetId,o.fromCache||(u=r.Dc.get(s),a=u.et,c=u.it(a),r.Dc=r.Dc.rt(s,c));return[2]}})})}(r.zu,o)];case 2:t.sent(),t.label=3;case 3:return[2]}})})}function Hl(i,o){return m(this,void 0,void 0,function(){var n,r;return w(this,function(t){switch(t.label){case 0:return(n=i).currentUser.isEqual(o)?[3,3]:(Ur("SyncEngine","User change. New user:",o.Zs()),[4,function(i,o){return m(this,void 0,void 0,function(){var e,n,m,r;return w(this,function(t){switch(t.label){case 0:return n=(e=i).vr,m=e.xc,[4,e.persistence.runTransaction("Handle user change","readonly",function(y){var g;return e.vr.qo(y).next(function(t){return g=t,n=e.persistence.Ic(o),m=new kc(e.Fc,n,e.persistence.Pc()),n.qo(y)}).next(function(t){for(var e=[],n=[],r=bo(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var c=a[u],r=r.add(c.key)}for(var h=0,f=t;h<f.length;h++){var l=f[h];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var v=d[p];r=r.add(v.key)}}return m.$r(y,r).next(function(t){return{zh:t,Hh:e,Yh:n}})})})];case 1:return r=t.sent(),[2,(e.vr=n,e.xc=m,e.Sc.$c(e.xc),r)]}})})}(n.zu,o)]);case 1:return r=t.sent(),n.currentUser=o,(e=n).Uh.forEach(function(t){t.forEach(function(t){t.reject(new Rr(Or.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Uh.clear(),n.Nh.Wi(o,r.Hh,r.Yh),[4,Gl(n,r.zh)];case 2:t.sent(),t.label=3;case 3:return[2]}var e})})}function Wl(u,a,c,h){return m(this,void 0,void 0,function(){var o,s;return w(this,function(t){switch(t.label){case 0:return[4,(e=(o=u).zu,n=a,i=(r=e).vr,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.Oo(e,n).next(function(t){return t?r.xc.$r(e,t):Ca.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,bl(o.Dh)];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(Fl(o,a,h||null),o.zu.vr.jo(a)):Fr(),t.label=4;case 4:return[4,Gl(o,s)];case 5:return t.sent(),[3,7];case 6:Ur("SyncEngine","Cannot apply mutation batch with id: "+a),t.label=7;case 7:return[2]}var e,n,r,i})})}function Kl(h,f){return m(this,void 0,void 0,function(){var r,e,i,o,s,u,a,c;return w(this,function(t){switch(t.label){case 0:return Jl(r=h),Zl(r),!0!==f||!0===r.Wh?[3,3]:(e=r.Nh.Di(),[4,Ql(r,e.A())]);case 1:return i=t.sent(),r.Wh=!0,[4,Tl(r.Dh,!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)u=s[o],cl(r.Dh,u);return[3,7];case 3:return!1!==f||!1===r.Wh?[3,7]:(a=[],c=Promise.resolve(),r.kh.forEach(function(t,e){r.Nh.Bi(e)?a.push(e):c=c.then(function(){return jl(r,e),xf(r.zu,e,!0)}),hl(r.Dh,e)}),[4,c]);case 4:return t.sent(),[4,Ql(r,a)];case 5:return t.sent(),(n=r).Lh.forEach(function(t,e){hl(n.Dh,e)}),n.Bh.jc(),n.Lh=new Map,n.Oh=new io(Xr.i),r.Wh=!1,[4,Tl(r.Dh,!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}function Ql(v,y){return m(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l,p,d;return w(this,function(t){switch(t.label){case 0:e=v,n=[],r=[],i=0,o=y,t.label=1;case 1:return i<o.length?(s=o[i],u=void 0,(a=e.kh.get(s))&&0!==a.length?[4,Df(e.zu,Qu(a[0]))]:[3,7]):[3,13];case 2:u=t.sent(),c=0,h=a,t.label=3;case 3:return c<h.length?(f=h[c],l=e.$h.get(f),[4,function(i,o){return m(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return[4,Of((e=i).zu,o.query,!0)];case 1:return n=t.sent(),r=o.view.ph(n),[2,(e.jh&&Bl(e,o.targetId,r.yh),r)]}})})}(e,l)]):[3,6];case 4:(p=t.sent()).snapshot&&r.push(p.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,Rf(e.zu,s)];case 8:return d=t.sent(),[4,Df(e.zu,d)];case 9:return u=t.sent(),[4,Pl(e,Yl(d),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(u),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.xh.bu(r),n)]}})})}function Yl(t){return ju(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Xl(s,u,a,c){return m(this,void 0,void 0,function(){var n,i,o;return w(this,function(t){switch(t.label){case 0:return(n=s).Wh?(Ur("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!n.kh.has(u))return[3,8];switch(a){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,(r=n.zu,e=r.Fc,r.persistence.runTransaction("Get new document changes","readonly",function(t){return e.ia(t,r.Nc)}).then(function(t){var e=t.ra,n=t.readTime;return r.Nc=n,e}))];case 3:return i=t.sent(),o=No.Jt(u,"current"===a),[4,Gl(n,i,o)];case 4:return t.sent(),[3,8];case 5:return[4,xf(n.zu,u,!0)];case 6:return t.sent(),jl(n,u,c),[3,8];case 7:Fr(),t.label=8;case 8:return[2]}var r,e})})}function Jl(t){var e=t;return e.Dh.Yu.oh=Ul.bind(null,e),e.Dh.Yu.Be=function(t,e){var n=t,r=n.Lh.get(e);if(r&&r.Sh)return bo().add(r.key);var i=bo(),o=n.kh.get(e);if(!o)return i;for(var s=0,u=o;s<u.length;s++)var a=u[s],c=n.$h.get(a),i=i.$t(c.view.Th);return i}.bind(null,e),e.Dh.Yu.rh=function(u,a,c){return m(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return(e=u).Nh.Ui(a,"rejected",c),n=e.Lh.get(a),(r=n&&n.key)?(i=(i=new io(Xr.i)).rt(r,new Pu(r,Mi.min())),o=bo().add(r),s=new No(Mi.min(),new Map,new fo(Ii),i,o),[4,Ul(e,s)]):[3,2];case 1:return t.sent(),e.Oh=e.Oh.remove(r),e.Lh.delete(a),zl(e),[3,4];case 2:return[4,xf(e.zu,a,!1).then(function(){return jl(e,a,c)}).catch(kf)];case 3:t.sent(),t.label=4;case 4:return[2]}})})}.bind(null,e),e.xh.bu=function(t,e){for(var n=t,r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query,a=n.Ls.get(u);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].Qs(s)&&(r=!0);a.Os=s}}r&&hc(n)}.bind(null,e.Ch),e.xh.Gh=function(t,e,n){var r=t,i=r.Ls.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.Ls.delete(e)}.bind(null,e.Ch),e}function Zl(t){var e=t;return e.Dh.Yu.ah=function(i,o){return m(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:e=i,n=o.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,Nf(e.zu,o)];case 2:return r=t.sent(),Fl(e,n,null),Vl(e,n),e.Nh.$i(n,"acknowledged"),[4,Gl(e,r)];case 3:return t.sent(),[3,6];case 4:return[4,kf(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})}.bind(null,e),e.Dh.Yu.uh=Ml.bind(null,e),e}var $l,tp=(op.prototype.$c=function(t){this.Jh=t},op.prototype.Or=function(e,r,i,o){var s=this;return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.rn.length||1===r.rn.length&&r.rn[0].field.p())||i.isEqual(Mi.min())?this.Xh(e,r):this.Jh.$r(e,o).next(function(t){var n=s.Zh(r,t);return(Bu(r)||zu(r))&&s.Rh(r.on,n,o,i)?s.Xh(e,r):(Pr()<=l.DEBUG&&Ur("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ta(r)),s.Jh.Or(e,r,i).next(function(e){return n.forEach(function(t){e=e.rt(t.key,t)}),e}))})},op.prototype.Zh=function(n,t){var r=new fo(na(n));return t.forEach(function(t,e){e instanceof Lu&&ea(n,e)&&(r=r.add(e))}),r},op.prototype.Rh=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.L(r))},op.prototype.Xh=function(t,e){return Pr()<=l.DEBUG&&Ur("IndexFreeQueryEngine","Using full collection scan to execute query:",ta(e)),this.Jh.Or(t,e,Mi.min())},op),ep=(ip.prototype.xo=function(t){return Ca.resolve(0===this.vr.length)},ip.prototype.$o=function(t,e,n,r){var i=this.tl;this.tl++,0<this.vr.length&&this.vr[this.vr.length-1];var o=new Sc(i,e,n,r);this.vr.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.el=this.el.add(new Ff(a.key,i)),this.Sr.ko(t,a.key.path.h())}return Ca.resolve(o)},ip.prototype.Mo=function(t,e){return Ca.resolve(this.nl(e))},ip.prototype.Lo=function(t,e){var n=e+1,r=this.sl(n),i=r<0?0:r;return Ca.resolve(this.vr.length>i?this.vr[i]:null)},ip.prototype.Bo=function(){return Ca.resolve(0===this.vr.length?-1:this.tl-1)},ip.prototype.qo=function(t){return Ca.resolve(this.vr.slice())},ip.prototype.Cr=function(t,e){var n=this,r=new Ff(e,0),i=new Ff(e,Number.POSITIVE_INFINITY),o=[];return this.el.Nt([r,i],function(t){var e=n.nl(t.Gc);o.push(e)}),Ca.resolve(o)},ip.prototype.Mr=function(t,e){var r=this,i=new fo(Ii);return e.forEach(function(t){var e=new Ff(t,0),n=new Ff(t,Number.POSITIVE_INFINITY);r.el.Nt([e,n],function(t){i=i.add(t.Gc)})}),Ca.resolve(this.il(i))},ip.prototype.Qr=function(t,e){var n=e.path,r=n.length+1,i=n;Xr.F(i)||(i=i.child(""));var o=new Ff(new Xr(i),0),s=new fo(Ii);return this.el.Ft(function(t){var e=t.key.path;return!!n.T(e)&&(e.length===r&&(s=s.add(t.Gc)),!0)},o),Ca.resolve(this.il(s))},ip.prototype.il=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.nl(t);null!==e&&r.push(e)}),r},ip.prototype.Qo=function(n,r){var i=this;jr(0===this.rl(r.batchId,"removed")),this.vr.shift();var o=this.el;return Ca.forEach(r.mutations,function(t){var e=new Ff(t.key,r.batchId);return o=o.delete(e),i.Co.Ko(n,t.key)}).next(function(){i.el=o})},ip.prototype.jo=function(t){},ip.prototype.zo=function(t,e){var n=new Ff(e,0),r=this.el.xt(n);return Ca.resolve(e.isEqual(r&&r.key))},ip.prototype.Go=function(t){return this.vr.length,Ca.resolve()},ip.prototype.rl=function(t,e){return this.sl(t)},ip.prototype.sl=function(t){return 0===this.vr.length?0:t-this.vr[0].batchId},ip.prototype.nl=function(t){var e=this.sl(t);return e<0||e>=this.vr.length?null:this.vr[e]},ip),np=(rp.prototype.Tr=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ol(e);return this.docs=this.docs.rt(r,{Zo:e,size:s,readTime:n}),this.size+=s-o,this.Sr.ko(t,r.path.h())},rp.prototype.Ir=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},rp.prototype.Ar=function(t,e){var n=this.docs.get(e);return Ca.resolve(n?n.Zo:null)},rp.prototype.getEntries=function(t,e){var n=this,r=po;return e.forEach(function(t){var e=n.docs.get(t);r=r.rt(t,e?e.Zo:null)}),Ca.resolve(r)},rp.prototype.Or=function(t,e,n){for(var r=go,i=new Xr(e.path.child("")),o=this.docs._t(i);o.It();){var s=o.Et(),u=s.key,a=s.value,c=a.Zo,h=a.readTime;if(!e.path.T(u.path))break;h.L(n)<=0||c instanceof Lu&&ea(e,c)&&(r=r.rt(c.key,c))}return Ca.resolve(r)},rp.prototype.al=function(t,e){return Ca.forEach(this.docs,function(t){return e(t)})},rp.prototype.aa=function(t){return new rp.ca(this)},rp.prototype.ha=function(t){return Ca.resolve(this.size)},rp);function rp(t,e){this.Sr=t,this.ol=e,this.docs=new io(Xr.i),this.size=0}function ip(t,e){this.Sr=t,this.Co=e,this.vr=[],this.tl=1,this.el=new fo(Ff.Oc)}function op(){}function sp(t){var e=this;return(e=$l.call(this)||this).la=t,e}np.ca=(o(sp,$l=xc),sp.prototype.gr=function(n){var r=this,i=[];return this.dr.forEach(function(t,e){e?i.push(r.la.Tr(n,e,r.readTime)):r.la.Ir(t)}),Ca.xn(i)},sp.prototype.Rr=function(t,e){return this.la.Ar(t,e)},sp.prototype.Pr=function(t,e){return this.la.getEntries(t,e)},sp);var up,ap,cp=(Ap.prototype.De=function(t,n){return this.cl.forEach(function(t,e){return n(e)}),Ca.resolve()},Ap.prototype.Ra=function(t){return Ca.resolve(this.lastRemoteSnapshotVersion)},Ap.prototype.Pa=function(t){return Ca.resolve(this.ul)},Ap.prototype.Ea=function(t){return this.highestTargetId=this.ll.next(),Ca.resolve(this.highestTargetId)},Ap.prototype.ga=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ul&&(this.ul=e),Ca.resolve()},Ap.prototype.Va=function(t){this.cl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ll=new rf(e),this.highestTargetId=e),t.sequenceNumber>this.ul&&(this.ul=t.sequenceNumber)},Ap.prototype.ya=function(t,e){return this.Va(e),this.targetCount+=1,Ca.resolve()},Ap.prototype.ba=function(t,e){return this.Va(e),Ca.resolve()},Ap.prototype.va=function(t,e){return this.cl.delete(e.target),this.hl.Wc(e.targetId),--this.targetCount,Ca.resolve()},Ap.prototype.Vo=function(n,r,i){var o=this,s=0,u=[];return this.cl.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.cl.delete(t),u.push(o.Sa(n,e.targetId)),s++)}),Ca.xn(u).next(function(){return s})},Ap.prototype.Da=function(t){return Ca.resolve(this.targetCount)},Ap.prototype.Ca=function(t,e){var n=this.cl.get(e)||null;return Ca.resolve(n)},Ap.prototype.Na=function(t,e,n){return this.hl.qc(e,n),Ca.resolve()},Ap.prototype.xa=function(e,t,n){this.hl.Qc(t,n);var r=this.persistence.Co,i=[];return r&&t.forEach(function(t){i.push(r.Ko(e,t))}),Ca.xn(i)},Ap.prototype.Sa=function(t,e){return this.hl.Wc(e),Ca.resolve()},Ap.prototype.ka=function(t,e){var n=this.hl.Kc(e);return Ca.resolve(n)},Ap.prototype.zo=function(t,e){return Ca.resolve(this.hl.zo(e))},Ap),hp=(Np.prototype.start=function(){return Promise.resolve()},Np.prototype.Si=function(){return this.qa=!1,Promise.resolve()},Object.defineProperty(Np.prototype,"Ti",{get:function(){return this.qa},enumerable:!1,configurable:!0}),Np.prototype.nc=function(){},Np.prototype.sc=function(){},Np.prototype.Pc=function(){return this.Sr},Np.prototype.Ic=function(t){var e=this._l[t.Zs()];return e||(e=new ep(this.Sr,this.Co),this._l[t.Zs()]=e),e},Np.prototype.Ac=function(){return this.Ha},Np.prototype.Rc=function(){return this.br},Np.prototype.runTransaction=function(t,e,n){var r=this;Ur("MemoryPersistence","Starting transaction:",t);var i=new fp(this.Ba.next());return this.Co.dl(),n(i).next(function(t){return r.Co.wl(i).next(function(){return t})}).Nn().then(function(t){return i.pr(),t})},Np.prototype.ml=function(e,n){return Ca.$n(Object.values(this._l).map(function(t){return function(){return t.zo(e,n)}}))},Np),fp=(o(_p,ap=Rc),_p),lp=(Tp.Il=function(t){return new Tp(t)},Object.defineProperty(Tp.prototype,"Al",{get:function(){if(this.El)return this.El;throw Fr()},enumerable:!1,configurable:!0}),Tp.prototype.Fa=function(t,e,n){return this.Tl.Fa(n,e),this.Al.delete(n.toString()),Ca.resolve()},Tp.prototype.$a=function(t,e,n){return this.Tl.$a(n,e),this.Al.add(n.toString()),Ca.resolve()},Tp.prototype.Ko=function(t,e){return this.Al.add(e.toString()),Ca.resolve()},Tp.prototype.removeTarget=function(t,e){var n=this;this.Tl.Wc(e.targetId).forEach(function(t){return n.Al.add(t.toString())});var r=this.persistence.Ac();return r.ka(t,e.targetId).next(function(t){t.forEach(function(t){return n.Al.add(t.toString())})}).next(function(){return r.va(t,e)})},Tp.prototype.dl=function(){this.El=new Set},Tp.prototype.wl=function(n){var r=this,i=this.persistence.Rc().aa();return Ca.forEach(this.Al,function(t){var e=Xr.D(t);return r.Rl(n,e).next(function(t){t||i.Ir(e)})}).next(function(){return r.El=null,i.apply(n)})},Tp.prototype.vc=function(t,e){var n=this;return this.Rl(t,e).next(function(t){t?n.Al.delete(e.toString()):n.Al.add(e.toString())})},Tp.prototype.fl=function(t){return 0},Tp.prototype.Rl=function(t,e){var n=this;return Ca.$n([function(){return Ca.resolve(n.Tl.zo(e))},function(){return n.persistence.Ac().zo(t,e)},function(){return n.persistence.ml(t,e)}])},Tp),pp=(Ip.prototype.Vu=function(t){this.yl=t},Ip.prototype.Au=function(t){this.Vl=t},Ip.prototype.onMessage=function(t){this.pl=t},Ip.prototype.close=function(){this.gl()},Ip.prototype.send=function(t){this.Pl(t)},Ip.prototype.bl=function(){this.yl()},Ip.prototype.vl=function(t){this.Vl(t)},Ip.prototype.Sl=function(t){this.pl(t)},Ip),dp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},vp=(Ep.prototype.Ou=function(e,t,n,r){var i=this.Fl(e,t);Ur("RestConnection","Sending: ",i,n);var o={};return this.xl(o,r),this.$l(e,i,o,n).then(function(t){return Ur("RestConnection","Received: ",t),t},function(t){throw Mr("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},Ep.prototype.Lu=function(t,e,n,r){return this.Ou(t,e,n,r)},Ep.prototype.xl=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.21.0",t["Content-Type"]="text/plain",e)for(var n in e.zc)e.zc.hasOwnProperty(n)&&(t[n]=e.zc[n])},Ep.prototype.Fl=function(t,e){var n=dp[t];return this.Cl+"/v1/"+e+":"+n},o(bp,up=Ep),bp.prototype.$l=function(a,e,n,r){return new Promise(function(o,s){var u=new Ar;u.listenOnce(_r.COMPLETE,function(){try{switch(u.getLastErrorCode()){case Tr.NO_ERROR:var t=u.getResponseJson();Ur("Connection","XHR received:",JSON.stringify(t)),o(t);break;case Tr.TIMEOUT:Ur("Connection",'RPC "'+a+'" timed out'),s(new Rr(Or.DEADLINE_EXCEEDED,"Request time out"));break;case Tr.HTTP_ERROR:var e,n,r=u.getStatus();Ur("Connection",'RPC "'+a+'" failed with status:',r,"response text:",u.getResponseText()),0<r?(e=u.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace("_","-"),n=0<=Object.values(Or).indexOf(i)?i:Or.UNKNOWN,s(new Rr(n,e.message))):s(new Rr(Or.UNKNOWN,"Server responded with status "+u.getStatus())):s(new Rr(Or.UNAVAILABLE,"Connection failed."));break;default:Fr()}}finally{Ur("Connection",'RPC "'+a+'" completed.')}var i});var t=JSON.stringify(r);u.send(e,"POST",t,n,15)})},bp.prototype.pu=function(t,e){var n,r,i=[this.Cl,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=Ir(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.U.projectId+"/databases/"+this.U.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.xl(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=v().indexOf("Electron/")||(0<=(r=v()).indexOf("MSIE ")||0<=r.indexOf("Trident/"))||0<=v().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");Ur("Connection","Creating WebChannel: "+u,s);function a(t,e){c.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}var c=o.createWebChannel(u,s),h=!1,f=!1,l=new pp({Pl:function(t){f?Ur("Connection","Not sending because WebChannel is closed:",t):(h||(Ur("Connection","Opening WebChannel transport."),c.open(),h=!0),Ur("Connection","WebChannel sending:",t),c.send(t))},gl:function(){return c.close()}});return a(Nr.EventType.OPEN,function(){f||Ur("Connection","WebChannel transport opened.")}),a(Nr.EventType.CLOSE,function(){f||(f=!0,Ur("Connection","WebChannel transport closed"),l.vl())}),a(Nr.EventType.ERROR,function(t){f||(f=!0,Mr("Connection","WebChannel transport errored:",t),l.vl(new Rr(Or.UNAVAILABLE,"The operation could not be completed")))}),a(Nr.EventType.MESSAGE,function(t){var e,n,r,i,o,s;f||(jr(!!(n=t.data[0])),(r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error))?(Ur("Connection","WebChannel received error:",r),i=r.status,o=function(){var t=Zi[i];if(void 0!==t)return ro(t)}(),s=r.message,void 0===o&&(o=Or.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.vl(new Rr(o,s)),c.close()):(Ur("Connection","WebChannel received:",n),l.Sl(n)))}),setTimeout(function(){l.bl()},0),l},bp),yp=(wp.prototype.nh=function(t){this.Bl.push(t)},wp.prototype.Si=function(){window.removeEventListener("online",this.kl),window.removeEventListener("offline",this.Ol)},wp.prototype.ql=function(){window.addEventListener("online",this.kl),window.addEventListener("offline",this.Ol)},wp.prototype.Ml=function(){Ur("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Bl;t<e.length;t++)(0,e[t])(0)},wp.prototype.Ll=function(){Ur("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Bl;t<e.length;t++)(0,e[t])(1)},wp.On=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},wp),gp=(mp.prototype.nh=function(t){},mp.prototype.Si=function(){},mp);function mp(){}function wp(){var t=this;this.kl=function(){return t.Ml()},this.Ol=function(){return t.Ll()},this.Bl=[],this.ql()}function bp(t){var e=this;return(e=up.call(this,t)||this).forceLongPolling=t.forceLongPolling,e}function Ep(t){this.Dl=t,this.U=t.U;var e=t.ssl?"https":"http";this.Cl=e+"://"+t.host,this.Nl="projects/"+this.U.projectId+"/databases/"+this.U.database+"/documents"}function Ip(t){this.Pl=t.Pl,this.gl=t.gl}function Tp(t){this.persistence=t,this.Tl=new Vf,this.El=null}function _p(t){var e=this;return(e=ap.call(this)||this).Ma=t,e}function Np(t){var e=this;this._l={},this.Ba=new vc(0),this.qa=!1,this.qa=!0,this.Co=t(this),this.Ha=new cp(this),this.Sr=new Rh,this.br=new np(this.Sr,function(t){return e.Co.fl(t)})}function Ap(t){this.persistence=t,this.cl=new Ui(Qi,Yi),this.lastRemoteSnapshotVersion=Mi.min(),this.highestTargetId=0,this.ul=0,this.hl=new Vf,this.targetCount=0,this.ll=rf.ma()}function Sp(t){return new us(t,!0)}var Dp,xp,Op,Rp,kp="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Lp=(Qp.prototype.initialize=function(e){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Nh=this.Ul(e),this.persistence=this.Ql(e),[4,this.persistence.start()];case 1:return t.sent(),this.Wl=this.jl(e),this.zu=this.Kl(e),[2]}})})},Qp.prototype.jl=function(t){return null},Qp.prototype.Kl=function(t){return e=this.persistence,n=new tp,r=t.Gl,new Tf(e,n,r);var e,n,r},Qp.prototype.Ql=function(t){if(t.persistenceSettings.zl)throw new Rr(Or.FAILED_PRECONDITION,kp);return new hp(lp.Il)},Qp.prototype.Ul=function(t){return new Ac},Qp.prototype.terminate=function(){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Wl&&this.Wl.stop(),[4,this.Nh.Si()];case 1:return t.sent(),[4,this.persistence.Si()];case 2:return t.sent(),[2]}})})},Qp.prototype.clearPersistence=function(t,e){throw new Rr(Or.FAILED_PRECONDITION,kp)},Qp),Pp=(o(Kp,Rp=Lp),Kp.prototype.initialize=function(e){return m(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,Rp.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,function(r){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){return n=(e=r).Fc,[2,e.persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.oa(t)}).then(function(t){e.Nc=t})]})})}(this.zu)];case 2:return t.sent(),[4,this.Hl.initialize(this,e)];case 3:return t.sent(),[4,Zl(this.Hl._i)];case 4:return t.sent(),[4,bl(this.Hl.Dh)];case 5:return t.sent(),[2]}})})},Kp.prototype.jl=function(t){var e=this.persistence.Co.do;return new $c(e,t.os)},Kp.prototype.Ql=function(t){var e=If(t.Dl.U,t.Dl.persistenceKey),n=Sp(t.Dl.U);return new df(t.persistenceSettings.synchronizeTabs,e,t.clientId,Xc.oo(t.persistenceSettings.cacheSizeBytes),t.os,$a(),tc(),n,this.Nh,t.persistenceSettings.La)},Kp.prototype.Ul=function(t){return new Ac},Kp.prototype.clearPersistence=function(t,e){return function(n){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return Ma.On()?(e=n+"main",[4,Ma.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(If(t,e))},o(Wp,Op=Kp),Wp.prototype.initialize=function(r){return m(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:return[4,Op.prototype.initialize.call(this,r)];case 1:return t.sent(),e=this.Hl._i,this.Nh instanceof Nc?(this.Nh._i={tr:Wl.bind(null,e),er:Xl.bind(null,e),nr:function(f,l,p){return m(this,void 0,void 0,function(){var n,e,r,i,o,s,u,a,c,h;return w(this,function(t){switch(t.label){case 0:if(!(n=Jl(f)).Wh)return[3,10];e=0,r=l,t.label=1;case 1:return e<r.length?(i=r[e],n.kh.has(i)?(Ur("SyncEngine","Adding an already active target "+i),[3,5]):[4,Rf(n.zu,i)]):[3,6];case 2:return o=t.sent(),[4,Df(n.zu,o)];case 3:return s=t.sent(),[4,Pl(n,Yl(o),s.targetId,!1)];case 4:t.sent(),cl(n.Dh,s),t.label=5;case 5:return e++,[3,1];case 6:u=function(e){return w(this,function(t){switch(t.label){case 0:return n.kh.has(e)?[4,xf(n.zu,e,!1).then(function(){hl(n.Dh,e),jl(n,e)}).catch(kf)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=0,c=p,t.label=7;case 7:return a<c.length?(h=c[a],[5,u(h)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})}.bind(null,e),Vi:function(t){return t.zu.persistence.Vi()}.bind(null,e)},[4,this.Nh.start()]):[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.persistence.ec(function(e){return m(n,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,Kl(this.Hl._i,e)];case 1:return t.sent(),this.Wl&&(e&&!this.Wl.Ti?this.Wl.start(this.zu):e||this.Wl.stop()),[2]}})})})];case 4:return t.sent(),[2]}})})},Wp.prototype.Ul=function(t){if(t.persistenceSettings.zl&&t.persistenceSettings.synchronizeTabs){var e=$a();if(!Nc.On(e))throw new Rr(Or.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=If(t.Dl.U,t.Dl.persistenceKey);return new Nc(e,t.os,n,t.clientId,t.Gl)}return new Ac},Wp),Up=(Hp.prototype.initialize=function(n,r){return m(this,void 0,void 0,function(){var e=this;return w(this,function(t){switch(t.label){case 0:return this.zu?[3,2]:(this.zu=n.zu,this.Nh=n.Nh,this.Hu=this.Yl(r),this.Dh=this.Jl(r),this.Ch=this.Xl(r),this._i=this.Zl(r),this.Nh.fi=function(t){return Cl(e._i,t,1)},this.Dh.Yu.t_=Hl.bind(null,this._i),[4,Tl(this.Dh,this._i.jh)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Hp.prototype.Xl=function(t){return new uc},Hp.prototype.Yl=function(t){var e,n,r=Sp(t.Dl.U),i=(e=t.Dl,new vp(e));return n=t.credentials,new Kf(n,i,r)},Hp.prototype.Jl=function(t){var e=this,n=this.zu,r=this.Hu,i=t.os,o=function(t){return Cl(e._i,t,0)},s=new(yp.On()?yp:gp);return new Pf(n,r,i,o,s)},Hp.prototype.Zl=function(t){return e=this.zu,n=this.Dh,r=this.Ch,i=this.Nh,o=t.Gl,s=t.Fh,u=!t.persistenceSettings.zl||!t.persistenceSettings.synchronizeTabs,a=new Rl(e,n,r,i,o,s),u&&(a.Wh=!0),a;var e,n,r,i,o,s,u,a},Hp.prototype.terminate=function(){return al(this.Dh)},Hp),Cp=(Gp.prototype.next=function(t){this.observer.next&&this.e_(this.observer.next,t)},Gp.prototype.error=function(t){this.observer.error?this.e_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Gp.prototype.n_=function(){this.muted=!0},Gp.prototype.e_=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Gp),Mp=function(t){!function(){if(!(t instanceof Array)||t.length<1)throw new Rr(Or.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var e=0;e<t.length;++e)if(oi("FieldPath","string",e,t[e]),0===t[e].length)throw new Rr(Or.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.s_=new Yr(t)},Vp=(o(zp,xp=Mp),zp.documentId=function(){return new zp(Yr.v().R())},zp.prototype.isEqual=function(t){if(!(t instanceof zp))throw yi("isEqual","FieldPath",1,t);return this.s_.isEqual(t.s_)},zp),Fp=new RegExp("[~\\*/\\[\\]]"),jp=function(){this.i_=this},qp=(o(Bp,Dp=jp),Bp.prototype.o_=function(t){if(2!==t.a_)throw 1===t.a_?t.c_(this.r_+"() can only appear at the top level of your update data"):t.c_(this.r_+"() cannot be used with set() unless you pass {merge:true}");return t.Qe.push(t.path),null},Bp.prototype.isEqual=function(t){return t instanceof Bp},Bp);function Bp(t){var e=this;return(e=Dp.call(this)||this).r_=t,e}function zp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return xp.call(this,t)||this}function Gp(t){this.observer=t,this.muted=!1}function Hp(){}function Wp(){return null!==Op&&Op.apply(this,arguments)||this}function Kp(t){var e=this;return(e=Rp.call(this)||this).Hl=t,e}function Qp(){}function Yp(t,e,n){return new Td({a_:3,u_:e.settings.u_,methodName:t.r_,h_:n},e.U,e.serializer,e.ignoreUndefinedProperties)}var Xp,Jp,Zp,$p,td,ed,nd=(o(Ed,ed=jp),Ed.prototype.o_=function(t){return new Js(t.path,new Cs)},Ed.prototype.isEqual=function(t){return t instanceof Ed},Ed),rd=(o(bd,td=jp),bd.prototype.o_=function(t){var e=Yp(this,t,!0),n=this.l_.map(function(t){return Rd(t,e)}),r=new Ms(n);return new Js(t.path,r)},bd.prototype.isEqual=function(t){return this===t},bd),id=(o(wd,$p=jp),wd.prototype.o_=function(t){var e=Yp(this,t,!0),n=this.l_.map(function(t){return Rd(t,e)}),r=new Bs(n);return new Js(t.path,r)},wd.prototype.isEqual=function(t){return this===t},wd),od=(o(md,Zp=jp),md.prototype.o_=function(t){var e=new Ws(t.serializer,hs(t.serializer,this.__));return new Js(t.path,e)},md.prototype.isEqual=function(t){return this===t},md),sd=(o(gd,Jp=jp),gd.delete=function(){return ei("FieldValue.delete",arguments),new ud(new qp("FieldValue.delete"))},gd.serverTimestamp=function(){return ei("FieldValue.serverTimestamp",arguments),new ud(new nd("FieldValue.serverTimestamp"))},gd.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ri("FieldValue.arrayUnion",arguments,1),new ud(new rd("FieldValue.arrayUnion",t))},gd.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ri("FieldValue.arrayRemove",arguments,1),new ud(new id("FieldValue.arrayRemove",t))},gd.increment=function(t){return oi("FieldValue.increment","number",1,t),ni("FieldValue.increment",arguments,1),new ud(new od("FieldValue.increment",t))},gd),ud=(o(yd,Xp=sd),yd.prototype.o_=function(t){return this.i_.o_(t)},yd.prototype.isEqual=function(t){return t instanceof yd&&this.i_.isEqual(t.i_)},yd),ad=(Object.defineProperty(vd.prototype,"latitude",{get:function(){return this.f_},enumerable:!1,configurable:!0}),Object.defineProperty(vd.prototype,"longitude",{get:function(){return this.d_},enumerable:!1,configurable:!0}),vd.prototype.isEqual=function(t){return this.f_===t.f_&&this.d_===t.d_},vd.prototype.toJSON=function(){return{latitude:this.f_,longitude:this.d_}},vd.prototype.H=function(t){return Ii(this.f_,t.f_)||Ii(this.d_,t.d_)},vd),cd=/^__.*__$/,hd=function(t,e,n){this.w_=t,this.m_=e,this.T_=n},fd=(dd.prototype.E_=function(t,e){var n=[];return null!==this.Qe?n.push(new fu(t,this.data,this.Qe,e)):n.push(new hu(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new yu(t,this.fieldTransforms)),n},dd),ld=(pd.prototype.E_=function(t,e){var n=[new fu(t,this.data,this.Qe,e)];return 0<this.fieldTransforms.length&&n.push(new yu(t,this.fieldTransforms)),n},pd);function pd(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}function dd(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}function vd(t,e){if(ni("GeoPoint",arguments,2),oi("GeoPoint","number",1,t),oi("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Rr(Or.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Rr(Or.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.f_=t,this.d_=e}function yd(t){var e=this;return(e=Xp.call(this)||this).i_=t,e.r_=t.r_,e}function gd(){return Jp.call(this)||this}function md(t,e){var n=this;return(n=Zp.call(this)||this).r_=t,n.__=e,n}function wd(t,e){var n=this;return(n=$p.call(this)||this).r_=t,n.l_=e,n}function bd(t,e){var n=this;return(n=td.call(this)||this).r_=t,n.l_=e,n}function Ed(t){var e=this;return(e=ed.call(this)||this).r_=t,e}function Id(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Fr()}}var Td=(Object.defineProperty(Ad.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Ad.prototype,"a_",{get:function(){return this.settings.a_},enumerable:!1,configurable:!0}),Ad.prototype.A_=function(t){return new Ad(Object.assign(Object.assign({},this.settings),t),this.U,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Qe)},Ad.prototype.R_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.A_({path:n,h_:!1});return r.P_(t),r},Ad.prototype.g_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.A_({path:n,h_:!1});return r.I_(),r},Ad.prototype.y_=function(t){return this.A_({path:void 0,h_:!0})},Ad.prototype.c_=function(t){return Md(t,this.settings.methodName,this.settings.V_||!1,this.path,this.settings.u_)},Ad.prototype.contains=function(e){return void 0!==this.Qe.find(function(t){return e.T(t)})||void 0!==this.fieldTransforms.find(function(t){return e.T(t.field)})},Ad.prototype.I_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.P_(this.path.get(t))},Ad.prototype.P_=function(t){if(0===t.length)throw this.c_("Document fields must not be empty");if(Id(this.a_)&&cd.test(t))throw this.c_('Document fields cannot begin and end with "__"')},Ad),_d=(Nd.prototype.p_=function(t,e,n,r){return void 0===r&&(r=!1),new Td({a_:t,methodName:e,u_:n,path:Yr.g(),h_:!1,V_:r},this.U,this.serializer,this.ignoreUndefinedProperties)},Nd);function Nd(t,e,n){this.U=t,this.ignoreUndefinedProperties=e,this.serializer=n||Sp(t)}function Ad(t,e,n,r,i,o){this.settings=t,this.U=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.I_(),this.fieldTransforms=i||[],this.Qe=o||[]}function Sd(t,e,n,r,i,o){void 0===o&&(o={});var s=t.p_(o.merge||o.mergeFields?2:0,e,n,i);Pd("Data must be an object, but it was:",s,r);var u,a,c=kd(r,s);if(o.merge)u=new Xs(s.Qe),a=s.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var p=l[f],d=void 0;if(p instanceof Mp)d=p.s_;else{if("string"!=typeof p)throw Fr();d=Cd(e,p,n)}if(!s.contains(d))throw new Rr(Or.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Vd(h,d)||h.push(d)}u=new Xs(h),a=s.fieldTransforms.filter(function(t){return u.He(t.field)})}else u=null,a=s.fieldTransforms;return new fd(new Tu(c),u,a)}function Dd(t,o,s,e){var u=t.p_(1,o,s);Pd("Data must be an object, but it was:",u,e);var a=[],c=new _u;Br(e,function(t,e){var n,r=Cd(o,t,s),i=u.g_(r);e instanceof jp&&e.i_ instanceof qp?a.push(r):null!=(n=Rd(e,i))&&(a.push(r),c.set(r,n))});var n=new Xs(a);return new ld(c.Je(),n,u.fieldTransforms)}function xd(t,e,n,r,i,o){var s=t.p_(1,e,n),u=[Ud(e,r,n)],a=[i];if(o.length%2!=0)throw new Rr(Or.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(Ud(e,o[c])),a.push(o[c+1]);for(var h,f,l,p,d=[],v=new _u,y=u.length-1;0<=y;--y){Vd(d,u[y])||(h=u[y],f=a[y],l=s.g_(h),f instanceof jp&&f.i_ instanceof qp?d.push(h):null!=(p=Rd(f,l))&&(d.push(h),v.set(h,p)))}var g=new Xs(d);return new ld(v.Je(),g,s.fieldTransforms)}function Od(t,e,n,r){return void 0===r&&(r=!1),Rd(n,t.p_(r?4:3,e))}function Rd(s,t){if(Ld(s))return Pd("Unsupported field value:",t,s),kd(s,t);if(s instanceof jp)return function(t,e){if(!Id(e.a_))throw e.c_(t.r_+"() can only be used with update() and set()");if(!e.path)throw e.c_(t.r_+"() is not currently supported inside arrays");var n=t.o_(e);n&&e.fieldTransforms.push(n)}(s,t),null;if(t.path&&t.Qe.push(t.path),s instanceof Array){if(t.settings.h_&&4!==t.a_)throw t.c_("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Rd(i[r],t.y_(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return hs(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Ci.fromDate(t);return{timestampValue:fs(e.serializer,n)}}if(t instanceof Ci){var r=new Ci(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:fs(e.serializer,r)}}if(t instanceof ad)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Si)return{bytesValue:ls(e.serializer,t.q)};if(t instanceof hd){var i=e.U,o=t.w_;if(!o.isEqual(i))throw e.c_("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:ds(t.w_||e.U,t.m_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.c_("Unsupported field value: "+pi(t))}(s,t)}function kd(t,r){var i={};return zr(t)?r.path&&0<r.path.length&&r.Qe.push(r.path):Br(t,function(t,e){var n=Rd(e,r.R_(t));null!=n&&(i[t]=n)}),{mapValue:{fields:i}}}function Ld(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ci||t instanceof ad||t instanceof Si||t instanceof hd||t instanceof jp)}function Pd(t,e,n){if(!Ld(n)||!li(n)){var r=pi(n);throw"an object"===r?e.c_(t+" a custom object"):e.c_(t+" "+r)}}function Ud(t,e,n){if(e instanceof Mp)return e.s_;if("string"==typeof e)return Cd(t,e);throw Md("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Cd(t,e,n){try{return function(e){if(0<=e.search(Fp))throw new Rr(Or.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Vp.bind.apply(Vp,s([void 0],e.split("."))))}catch(t){throw new Rr(Or.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).s_}catch(e){throw Md(e instanceof Error?e.message:e.toString(),t,!1,void 0,n)}}function Md(t,e,n,r,i){var o=r&&!r.m(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new Rr(Or.INVALID_ARGUMENT,(u+=". ")+t+a)}function Vd(t,e){return t.some(function(t){return t.isEqual(e)})}var Fd=(Gd.prototype.C_=function(r){return m(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:if(this.N_(),0<this.mutations.length)throw new Rr(Or.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(u,a){return m(this,void 0,void 0,function(){var i,e,n,r,o,s;return w(this,function(t){switch(t.label){case 0:return e=bs((i=u).serializer)+"/documents",n={documents:a.map(function(t){return ys(i.serializer,t)})},[4,i.Lu("BatchGetDocuments",e,n)];case 1:return r=t.sent(),o=new Map,r.forEach(function(t){var e,n,r=(e=i.serializer,"found"in(n=t)?function(t,e){jr(!!e.found),e.found.name,e.found.updateTime;var n=gs(t,e.found.name),r=ps(e.found.updateTime),i=new Tu({mapValue:{fields:e.found.fields}});return new Lu(n,r,i,{})}(e,n):"missing"in n?function(t,e){jr(!!e.missing),jr(!!e.readTime);var n=gs(t,e.missing),r=ps(e.readTime);return new Pu(n,r)}(e,n):Fr());o.set(r.key.toString(),r)}),s=[],[2,(a.forEach(function(t){var e=o.get(t.toString());jr(!!e),s.push(e)}),s)]}})})}(this.Hu,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof Pu||t instanceof Lu?n.F_(t):Fr()}),e)]}})})},Gd.prototype.set=function(t,e){this.write(e.E_(t,this.Ke(t))),this.D_.add(t.toString())},Gd.prototype.update=function(t,e){try{this.write(e.E_(t,this.x_(t)))}catch(t){this.S_=t}this.D_.add(t.toString())},Gd.prototype.delete=function(t){this.write([new Eu(t,this.Ke(t))]),this.D_.add(t.toString())},Gd.prototype.commit=function(){return m(this,void 0,void 0,function(){var e,r=this;return w(this,function(t){switch(t.label){case 0:if(this.N_(),this.S_)throw this.S_;return e=this.b_,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){var n=Xr.D(e);r.mutations.push(new Iu(n,r.Ke(n)))}),[4,function(i,o){return m(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return n=bs((e=i).serializer)+"/documents",r={writes:o.map(function(t){return Ts(e.serializer,t)})},[4,e.Ou("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.Hu,this.mutations)];case 1:return t.sent(),this.v_=!0,[2]}})})},Gd.prototype.F_=function(t){var e;if(t instanceof Lu)e=t.version;else{if(!(t instanceof Pu))throw Fr();e=Mi.min()}var n=this.b_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Rr(Or.ABORTED,"Document version changed between two reads.")}else this.b_.set(t.key.toString(),e)},Gd.prototype.Ke=function(t){var e=this.b_.get(t.toString());return!this.D_.has(t.toString())&&e?tu.updateTime(e):tu.Ge()},Gd.prototype.x_=function(t){var e=this.b_.get(t.toString());if(this.D_.has(t.toString())||!e)return tu.exists(!0);if(e.isEqual(Mi.min()))throw new Rr(Or.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return tu.updateTime(e)},Gd.prototype.write=function(t){this.N_(),this.mutations=this.mutations.concat(t)},Gd.prototype.N_=function(){},Gd),jd=(zd.prototype.run=function(){this.M_()},zd.prototype.M_=function(){var t=this;this.gs.Rn(function(){return m(t,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){return e=new Fd(this.Hu),(n=this.O_(e))&&n.then(function(t){r.os.ds(function(){return e.commit().then(function(){r.hs.resolve(t)}).catch(function(t){r.L_(t)})})}).catch(function(t){r.L_(t)}),[2]})})})},zd.prototype.O_=function(t){try{var e=this.updateFunction(t);return!zi(e)&&e.catch&&e.then?e:(this.hs.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.hs.reject(t),null}},zd.prototype.L_=function(t){var e=this;0<this.k_&&this.B_(t)?(--this.k_,this.os.ds(function(){return e.M_(),Promise.resolve()})):this.hs.reject(t)},zd.prototype.B_=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!no(e)},zd),qd=(Bd.prototype.start=function(t,e,n,r){var i=this;this.U_(),this.Dl=t;var o=new La,s=!1;return this.credentials.Jc(function(t){return s?void i.os.Ds(function(){return function(r,i){return m(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:return(e=r).os.Fs(),Ur("RemoteStore","RemoteStore received new credentials"),n=vl(e),e.Zu.add(3),[4,ul(e)];case 1:return t.sent(),n&&e.sh.set("Unknown"),[4,e.Yu.t_(i)];case 2:return t.sent(),e.Zu.delete(3),[4,sl(e)];case 3:return t.sent(),[2]}})})}(i.Dh,t)}):(s=!0,Ur("FirestoreClient","Initializing. user=",t.uid),i.Q_(e,n,r,t,o).then(i.q_.resolve,i.q_.reject))}),this.os.ds(function(){return i.q_.promise}),o.promise},Bd.prototype.enableNetwork=function(){var e=this;return this.U_(),this.os.enqueue(function(){return e.persistence.sc(!0),(t=e.Dh).Zu.delete(0),sl(t);var t})},Bd.prototype.Q_=function(i,o,s,u,a){return m(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),e={os:this.os,Dl:this.Dl,clientId:this.clientId,credentials:this.credentials,Gl:u,Fh:100,persistenceSettings:s},[4,i.initialize(e)];case 1:return t.sent(),[4,o.initialize(i,e)];case 2:return t.sent(),this.persistence=i.persistence,this.Nh=i.Nh,this.zu=i.zu,this.Wl=i.Wl,this.Hu=o.Hu,this.Dh=o.Dh,this._i=o._i,this.W_=o.Ch,this.W_.qs=function(u,a){return m(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return e=Jl(u),(i=e.$h.get(a))?(n=i.targetId,e.Nh.Mi(n),r=i.view.bh(),[3,4]):[3,1];case 1:return[4,Df(e.zu,Qu(a))];case 2:return o=t.sent(),s=e.Nh.Mi(o.targetId),n=o.targetId,[4,Pl(e,a,n,"current"===s)];case 3:r=t.sent(),e.jh&&cl(e.Dh,o),t.label=4;case 4:return[2,r]}})})}.bind(null,this._i),this.W_.Ws=function(i,o){return m(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return n=(e=i).$h.get(o),1<(r=e.kh.get(n.targetId)).length?[2,(e.kh.set(n.targetId,r.filter(function(t){return!Zu(t,o)})),void e.$h.delete(o))]:e.jh?(e.Nh.Li(n.targetId),e.Nh.Ni(n.targetId)?[3,2]:[4,xf(e.zu,n.targetId,!1).then(function(){e.Nh.qi(n.targetId),hl(e.Dh,n.targetId),jl(e,n.targetId)}).catch(kf)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return jl(e,n.targetId),[4,xf(e.zu,n.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})}.bind(null,this._i),this.persistence.nc(function(){return m(r,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),a.resolve(),[3,4];case 3:if(n=t.sent(),a.reject(n),!this.j_(n))throw n;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+n),this.Q_(new Lp,new Up,{zl:!1},u,a))];case 4:return[2]}})})},Bd.prototype.j_=function(t){return"FirebaseError"===t.name?t.code===Or.FAILED_PRECONDITION||t.code===Or.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Bd.prototype.U_=function(){if(this.os.Vs)throw new Rr(Or.FAILED_PRECONDITION,"The client has already been terminated.")},Bd.prototype.disableNetwork=function(){var t=this;return this.U_(),this.os.enqueue(function(){return t.persistence.sc(!1),function(n){return m(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return(e=n).Zu.add(0),[4,ul(e)];case 1:return t.sent(),e.sh.set("Offline"),[2]}})})}(t.Dh)})},Bd.prototype.terminate=function(){var t=this;this.os.Ss();var r=new La;return this.os.ps(function(){return m(t,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),this.Wl&&this.Wl.stop(),[4,al(this.Dh)];case 1:return t.sent(),[4,this.Nh.Si()];case 2:return t.sent(),[4,this.persistence.Si()];case 3:return t.sent(),this.credentials.Xc(),r.resolve(),[3,5];case 4:return e=t.sent(),n=oc(e,"Failed to shutdown persistence"),r.reject(n),[3,5];case 5:return[2]}})})}),r.promise},Bd.prototype.waitForPendingWrites=function(){var t=this;this.U_();var e=new La;return this.os.ds(function(){return function(u,a){return m(this,void 0,void 0,function(){var n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:vl((n=u).Dh)||Ur("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=n.zu).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.vr.Bo(t)})];case 2:return-1===(r=t.sent())?[2,void a.resolve()]:((i=n.Uh.get(r)||[]).push(a),n.Uh.set(r,i),[3,4]);case 3:return o=t.sent(),s=oc(o,"Initialization of waitForPendingWrites() operation failed"),a.reject(s),[3,4];case 4:return[2]}var e})})}(t._i,e)}),e.promise},Bd.prototype.listen=function(t,e,n){var r=this;this.U_();var i=new Cp(n),o=new fc(t,i,e);return this.os.ds(function(){return ac(r.W_,o)}),function(){i.n_(),r.os.ds(function(){return cc(r.W_,o)})}},Bd.prototype.K_=function(r){return m(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:return this.U_(),[4,this.q_.promise];case 1:return t.sent(),e=new La,[2,(this.os.ds(function(){return function(s,u,a){return m(this,void 0,void 0,function(){var r,i,o;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=u,(n=s).persistence.runTransaction("read document","readonly",function(t){return n.xc.Dr(t,e)}))];case 1:return(r=t.sent())instanceof Lu?a.resolve(r):r instanceof Pu?a.resolve(null):a.reject(new Rr(Or.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return i=t.sent(),o=oc(i,"Failed to get document '"+u+" from cache"),a.reject(o),[3,3];case 3:return[2]}var e,n})})}(n.zu,r,e)}),e.promise)]}})})},Bd.prototype.G_=function(c,h){return void 0===h&&(h={}),m(this,void 0,void 0,function(){var e,a=this;return w(this,function(t){switch(t.label){case 0:return this.U_(),[4,this.q_.promise];case 1:return t.sent(),e=new La,[2,(this.os.ds(function(){return n=a.W_,r=a.os,i=c,o=h,s=e,t=new Cp({next:function(t){r.ds(function(){return cc(n,u)});var e=t.docs.has(i);!e&&t.fromCache?s.reject(new Rr(Or.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&o&&"server"===o.source?s.reject(new Rr(Or.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:function(t){return s.reject(t)}}),u=new fc(qu(i.path),t,{includeMetadataChanges:!0,Js:!0}),ac(n,u);var n,r,i,o,s,t,u}),e.promise)]}})})},Bd.prototype.z_=function(r){return m(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:return this.U_(),[4,this.q_.promise];case 1:return t.sent(),e=new La,[2,(this.os.ds(function(){return function(u,a,c){return m(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,Of(u,a,!0)];case 1:return e=t.sent(),n=new Dl(a,e.kc),r=n.Eh(e.documents),i=n.gr(r,!1),c.resolve(i.snapshot),[3,3];case 2:return o=t.sent(),s=oc(o,"Failed to execute query '"+a+" against cache"),c.reject(s),[3,3];case 3:return[2]}})})}(n.zu,r,e)}),e.promise)]}})})},Bd.prototype.H_=function(c,h){return void 0===h&&(h={}),m(this,void 0,void 0,function(){var u,a=this;return w(this,function(t){switch(t.label){case 0:return this.U_(),[4,this.q_.promise];case 1:return t.sent(),u=new La,[2,(this.os.ds(function(){return e=a.W_,n=a.os,t=c,r=h,i=u,o=new Cp({next:function(t){n.ds(function(){return cc(e,s)}),t.fromCache&&"server"===r.source?i.reject(new Rr(Or.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),s=new fc(t,o,{includeMetadataChanges:!0,Js:!0}),ac(e,s);var e,n,t,r,i,o,s}),u.promise)]}})})},Bd.prototype.write=function(t){var e=this;this.U_();var n=new La;return this.os.ds(function(){return function(v,y,g){return m(this,void 0,void 0,function(){var u,a,p,d;return w(this,function(t){switch(t.label){case 0:u=Zl(v),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(o=u.zu,c=y,f=o,l=Ci.now(),s=c.reduce(function(t,e){return t.add(e.key)},bo()),f.persistence.runTransaction("Locally write mutations","readwrite",function(a){return f.xc.$r(a,s).next(function(t){h=t;for(var u,e,n=[],r=0,i=c;r<i.length;r++){var o=i[r],s=(u=o,e=h.get(o.key),u instanceof yu?function(t){for(var e=null,n=0,r=u.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Lu?t.field(i.field):void 0,s=Ls(i.transform,o||null);null!=s&&(e=null==e?(new _u).set(i.field,s):e.set(i.field,s))}return e?e.Je():null}(e):null);null!=s&&n.push(new fu(o.key,s,function u(t){var a=[];return Br(t.fields||{},function(t,e){var n=new Yr([t]);if(is(e)){var r=u(e.mapValue).fields;if(0===r.length)a.push(n);else for(var i=0,o=r;i<o.length;i++){var s=o[i];a.push(n.child(s))}}else a.push(n)}),new Xs(a)}(s.proto.mapValue),tu.exists(!0)))}return f.vr.$o(a,l,n,c)})}).then(function(t){var e=t.hr(h);return{batchId:t.batchId,dr:e}}))];case 2:return a=t.sent(),u.Nh.Fi(a.batchId),e=u,n=a.batchId,r=g,i=(i=(i=e.qh[e.currentUser.Zs()])||new io(Ii)).rt(n,r),e.qh[e.currentUser.Zs()]=i,[4,Gl(u,a.dr)];case 3:return t.sent(),[4,bl(u.Dh)];case 4:return t.sent(),[3,6];case 5:return p=t.sent(),d=oc(p,"Failed to persist write"),g.reject(d),[3,6];case 6:return[2]}var e,n,r,i,o,c,h,f,l,s})})}(e._i,t,n)}),n.promise},Bd.prototype.U=function(){return this.Dl.U},Bd.prototype.Y_=function(t){var e=this;this.U_();var r=new Cp(t);return this.os.ds(function(){return m(e,void 0,void 0,function(){return w(this,function(t){return[2,(e=this.W_,n=r,e.Bs.add(n),void n.next())];var e,n})})}),function(){r.n_(),e.os.ds(function(){return m(e,void 0,void 0,function(){return w(this,function(t){return[2,void this.W_.Bs.delete(r)]})})})}},Object.defineProperty(Bd.prototype,"J_",{get:function(){return this.os.Vs},enumerable:!1,configurable:!0}),Bd.prototype.transaction=function(t){var e=this;this.U_();var n=new La;return this.os.ds(function(){return new jd(e.os,e.Hu,t,n).run(),Promise.resolve()}),n.promise},Bd);function Bd(t,e){this.credentials=t,this.os=e,this.clientId=bi.k(),this.q_=new La}function zd(t,e,n,r){this.os=t,this.Hu=e,this.updateFunction=n,this.hs=r,this.k_=5,this.gs=new Ua(this.os,"transaction_retry")}function Gd(t){this.Hu=t,this.b_=new Map,this.mutations=[],this.v_=!1,this.S_=null,this.D_=new Set}function Hd(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Wd,Kd,Qd=(lv.prototype.ef=function(t){switch(Go(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Jo(t.integerValue||t.doubleValue);case 3:return this.nf(t.timestampValue);case 4:return this.sf(t);case 5:return t.stringValue;case 6:return this.tf(Zo(t.bytesValue));case 7:return this.if(t.referenceValue);case 8:return this.rf(t.geoPointValue);case 9:return this.af(t.arrayValue);case 10:return this.cf(t.mapValue);default:throw Fr()}},lv.prototype.cf=function(t){var n=this,r={};return Br(t.fields||{},function(t,e){r[t]=n.ef(e)}),r},lv.prototype.rf=function(t){return new ad(Jo(t.latitude),Jo(t.longitude))},lv.prototype.af=function(t){var e=this;return(t.values||[]).map(function(t){return e.ef(t)})},lv.prototype.sf=function(t){switch(this.X_){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return qo(n)?t(n):n}(t);return null==e?null:this.ef(e);case"estimate":return this.nf(Bo(t));default:return null}},lv.prototype.nf=function(t){var e=Xo(t),n=new Ci(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},lv.prototype.if=function(t){var e=Kr.P(t);jr(Rs(e));var n=new Pi(e.get(1),e.get(3)),r=new Xr(e.u(5));return n.isEqual(this.U)||Cr("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.U.projectId+"/"+this.U.database+") instead."),this.Z_(r)},lv),Yd=Xc.uo,Xd=(fv.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},fv),Jd=(Object.defineProperty(hv.prototype,"If",{get:function(){return this.Af||(this.Af=new _d(this.w_,this.Ef.ignoreUndefinedProperties)),this.Af},enumerable:!1,configurable:!0}),hv.prototype.settings=function(t){ni("Firestore.settings",arguments,1),oi("Firestore.settings","object",1,t),t.merge&&delete(t=Object.assign(Object.assign({},this.Ef),t)).merge;var e=new Xd(t);if(this.df&&!this.Ef.isEqual(e))throw new Rr(Or.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.Ef=e).credentials&&(this.Tf=function(t){if(!t)return new jf;switch(t.type){case"gapi":var e=t.Rf;return jr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new zf(e,t.iu||"0");case"provider":return t.Rf;default:throw new Rr(Or.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},hv.prototype.enableNetwork=function(){return this.ff(),this.df.enableNetwork()},hv.prototype.disableNetwork=function(){return this.ff(),this.df.disableNetwork()},hv.prototype.enablePersistence=function(t){var e,n;if(this.df)throw new Rr(Or.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&Cr("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new Rr(Or.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.Pf(this.uf,this.hf,{zl:!0,cacheSizeBytes:this.Ef.cacheSizeBytes,synchronizeTabs:r,La:i})},hv.prototype.clearPersistence=function(){return m(this,void 0,void 0,function(){var n,e=this;return w(this,function(t){if(void 0!==this.df&&!this.df.J_)throw new Rr(Or.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return n=new La,[2,(this._f.ps(function(){return m(e,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.uf.clearPersistence(this.w_,this.mf)];case 1:return t.sent(),n.resolve(),[3,3];case 2:return e=t.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise)]})})},hv.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(hv.prototype,"gf",{get:function(){return this.ff(),this.df.J_},enumerable:!1,configurable:!0}),hv.prototype.waitForPendingWrites=function(){return this.ff(),this.df.waitForPendingWrites()},hv.prototype.onSnapshotsInSync=function(t){if(this.ff(),Hd(t))return this.df.Y_(t);oi("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.df.Y_(e)},hv.prototype.ff=function(){return this.df||this.Pf(new Lp,new Up,{zl:!1}),this.df},hv.prototype.yf=function(){return new Ri(this.w_,this.mf,this.Ef.host,this.Ef.ssl,this.Ef.experimentalForceLongPolling)},hv.prototype.Pf=function(t,e,n){var r=this.yf();return this.df=new qd(this.Tf,this._f),this.df.start(r,t,e,n)},hv.wf=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new Rr(Or.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new Rr(Or.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Pi(n)},Object.defineProperty(hv.prototype,"app",{get:function(){if(!this.lf)throw new Rr(Or.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.lf},enumerable:!1,configurable:!0}),hv.prototype.collection=function(t){return ni("Firestore.collection",arguments,1),oi("Firestore.collection","non-empty string",1,t),this.ff(),new bv(Kr.P(t),this,null)},hv.prototype.doc=function(t){return ni("Firestore.doc",arguments,1),oi("Firestore.doc","non-empty string",1,t),this.ff(),tv.Vf(Kr.P(t),this,null)},hv.prototype.collectionGroup=function(t){if(ni("Firestore.collectionGroup",arguments,1),oi("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Rr(Or.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ff(),new mv((e=t,new Cu(Kr.g(),e)),this,null);var e},hv.prototype.runTransaction=function(e){var n=this;return ni("Firestore.runTransaction",arguments,1),oi("Firestore.runTransaction","function",1,e),this.ff().transaction(function(t){return e(new Zd(n,t))})},hv.prototype.batch=function(){return this.ff(),new $d(this)},Object.defineProperty(hv,"logLevel",{get:function(){switch(Pr()){case l.DEBUG:return"debug";case l.ERROR:return"error";case l.SILENT:return"silent";case l.WARN:return"warn";case l.INFO:return"info";case l.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),hv.setLogLevel=function(t){ni("Firestore.setLogLevel",arguments,1),hi("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),kr.setLogLevel(t)},hv.prototype.pf=function(){return this.Ef.timestampsInSnapshots},hv.prototype.bf=function(){return this.Ef},hv),Zd=(cv.prototype.get=function(t){var n=this;ni("Transaction.get",arguments,1);var r=Sv("Transaction.get",t,this.vf);return this.Sf.C_([r.m_]).then(function(t){if(!t||1!==t.length)return Fr();var e=t[0];if(e instanceof Pu)return new nv(n.vf,r.m_,null,!1,!1,r.T_);if(e instanceof Lu)return new nv(n.vf,r.m_,e,!1,!1,r.T_);throw Fr()})},cv.prototype.set=function(t,e,n){ii("Transaction.set",arguments,2,3);var r=Sv("Transaction.set",t,this.vf);n=_v("Transaction.set",n);var i=Dv(r.T_,e,n),o=Sd(this.vf.If,"Transaction.set",r.m_,i,null!==r.T_,n);return this.Sf.set(r.m_,o),this},cv.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof Vp?(ri("Transaction.update",arguments,3),r=Sv("Transaction.update",t,this.vf),xd(this.vf.If,"Transaction.update",r.m_,e,n,o)):(ni("Transaction.update",arguments,2),r=Sv("Transaction.update",t,this.vf),Dd(this.vf.If,"Transaction.update",r.m_,e)),this.Sf.update(r.m_,i),this},cv.prototype.delete=function(t){ni("Transaction.delete",arguments,1);var e=Sv("Transaction.delete",t,this.vf);return this.Sf.delete(e.m_),this},cv),$d=(av.prototype.set=function(t,e,n){ii("WriteBatch.set",arguments,2,3),this.Nf();var r=Sv("WriteBatch.set",t,this.vf);n=_v("WriteBatch.set",n);var i=Dv(r.T_,e,n),o=Sd(this.vf.If,"WriteBatch.set",r.m_,i,null!==r.T_,n);return this.Df=this.Df.concat(o.E_(r.m_,tu.Ge())),this},av.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.Nf(),i="string"==typeof e||e instanceof Vp?(ri("WriteBatch.update",arguments,3),r=Sv("WriteBatch.update",t,this.vf),xd(this.vf.If,"WriteBatch.update",r.m_,e,n,o)):(ni("WriteBatch.update",arguments,2),r=Sv("WriteBatch.update",t,this.vf),Dd(this.vf.If,"WriteBatch.update",r.m_,e)),this.Df=this.Df.concat(i.E_(r.m_,tu.exists(!0))),this},av.prototype.delete=function(t){ni("WriteBatch.delete",arguments,1),this.Nf();var e=Sv("WriteBatch.delete",t,this.vf);return this.Df=this.Df.concat(new Eu(e.m_,tu.Ge())),this},av.prototype.commit=function(){return this.Nf(),this.Cf=!0,0<this.Df.length?this.vf.ff().write(this.Df):Promise.resolve()},av.prototype.Nf=function(){if(this.Cf)throw new Rr(Or.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},av),tv=(o(uv,Kd=hd),uv.Vf=function(t,e,n){if(t.length%2!=0)throw new Rr(Or.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.R()+" has "+t.length);return new uv(new Xr(t),e,n)},Object.defineProperty(uv.prototype,"id",{get:function(){return this.m_.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(uv.prototype,"parent",{get:function(){return new bv(this.m_.path.h(),this.firestore,this.T_)},enumerable:!1,configurable:!0}),Object.defineProperty(uv.prototype,"path",{get:function(){return this.m_.path.R()},enumerable:!1,configurable:!0}),uv.prototype.collection=function(t){if(ni("DocumentReference.collection",arguments,1),oi("DocumentReference.collection","non-empty string",1,t),!t)throw new Rr(Or.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Kr.P(t);return new bv(this.m_.path.child(e),this.firestore,null)},uv.prototype.isEqual=function(t){if(!(t instanceof uv))throw yi("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.m_.isEqual(t.m_)&&this.T_===t.T_},uv.prototype.set=function(t,e){ii("DocumentReference.set",arguments,1,2),e=_v("DocumentReference.set",e);var n=Dv(this.T_,t,e),r=Sd(this.firestore.If,"DocumentReference.set",this.m_,n,null!==this.T_,e);return this.df.write(r.E_(this.m_,tu.Ge()))},uv.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof Vp?(ri("DocumentReference.update",arguments,2),xd(this.firestore.If,"DocumentReference.update",this.m_,t,e,r)):(ni("DocumentReference.update",arguments,1),Dd(this.firestore.If,"DocumentReference.update",this.m_,t)),this.df.write(n.E_(this.m_,tu.exists(!0)))},uv.prototype.delete=function(){return ni("DocumentReference.delete",arguments,0),this.df.write([new Eu(this.m_,tu.Ge())])},uv.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];ii("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||Hd(i[u])||(vi("DocumentReference.onSnapshot",s=i[u],["includeMetadataChanges"]),ai("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++);var a,c={includeMetadataChanges:s.includeMetadataChanges};Hd(i[u])?(a=i[u],i[u]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[u+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[u+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)):(oi("DocumentReference.onSnapshot","function",u,i[u]),si("DocumentReference.onSnapshot","function",u+1,i[u+1]),si("DocumentReference.onSnapshot","function",u+2,i[u+2]));var h={next:function(t){i[u]&&i[u](r.Ff(t))},error:i[u+1],complete:i[u+2]};return this.df.listen(qu(this.m_.path),c,h)},uv.prototype.get=function(t){var e=this;ii("DocumentReference.get",arguments,0,1),Av("DocumentReference.get",t);var n=this.firestore.ff();return t&&"cache"===t.source?n.K_(this.m_).then(function(t){return new nv(e.firestore,e.m_,t,!0,t instanceof Lu&&t.Ye,e.T_)}):n.G_(this.m_,t).then(function(t){return e.Ff(t)})},uv.prototype.withConverter=function(t){return new uv(this.m_,this.firestore,t)},uv.prototype.Ff=function(t){var e=t.docs.get(this.m_);return new nv(this.firestore,this.m_,e,t.fromCache,t.hasPendingWrites,this.T_)},uv),ev=(sv.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},sv),nv=(ov.prototype.data=function(t){var e=this;if(ii("DocumentSnapshot.data",arguments,0,1),t=Nv("DocumentSnapshot.data",t),this.xf){if(this.T_){var n=new rv(this.vf,this.m_,this.xf,this.$f,this.kf,null);return this.T_.fromFirestore(n,t)}return new Qd(this.vf.w_,this.vf.pf(),t.serverTimestamps||"none",function(t){return new tv(t,e.vf,null)},function(t){return new Li(t)}).ef(this.xf.sn())}},ov.prototype.get=function(t,e){var n=this;if(ii("DocumentSnapshot.get",arguments,1,2),e=Nv("DocumentSnapshot.get",e),this.xf){var r=this.xf.data().field(Ud("DocumentSnapshot.get",t,this.m_));if(null!==r)return new Qd(this.vf.w_,this.vf.pf(),e.serverTimestamps||"none",function(t){return new tv(t,n.vf,n.T_)},function(t){return new Li(t)}).ef(r)}},Object.defineProperty(ov.prototype,"id",{get:function(){return this.m_.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(ov.prototype,"ref",{get:function(){return new tv(this.m_,this.vf,this.T_)},enumerable:!1,configurable:!0}),Object.defineProperty(ov.prototype,"exists",{get:function(){return null!==this.xf},enumerable:!1,configurable:!0}),Object.defineProperty(ov.prototype,"metadata",{get:function(){return new ev(this.kf,this.$f)},enumerable:!1,configurable:!0}),ov.prototype.isEqual=function(t){if(!(t instanceof ov))throw yi("isEqual","DocumentSnapshot",1,t);return this.vf===t.vf&&this.$f===t.$f&&this.m_.isEqual(t.m_)&&(null===this.xf?null===t.xf:this.xf.isEqual(t.xf))&&this.T_===t.T_},ov),rv=(o(iv,Wd=nv),iv.prototype.data=function(t){return Wd.prototype.data.call(this,t)},iv);function iv(){return null!==Wd&&Wd.apply(this,arguments)||this}function ov(t,e,n,r,i,o){this.vf=t,this.m_=e,this.xf=n,this.$f=r,this.kf=i,this.T_=o}function sv(t,e){this.hasPendingWrites=t,this.fromCache=e}function uv(t,e,n){var r=this;return(r=Kd.call(this,e.w_,t,n)||this).m_=t,r.firestore=e,r.T_=n,r.df=r.firestore.ff(),r}function av(t){this.vf=t,this.Df=[],this.Cf=!1}function cv(t,e){this.vf=t,this.Sf=e}function hv(t,e,n,r){var i=this;if(void 0===n&&(n=new Lp),void 0===r&&(r=new Up),this.uf=n,this.hf=r,this.lf=null,this._f=new nc,this.INTERNAL={delete:function(){return m(i,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.ff(),[4,this.df.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var o=t;this.lf=o,this.w_=hv.wf(o),this.mf=o.name,this.Tf=new qf(e)}else{var s=t;if(!s.projectId)throw new Rr(Or.INVALID_ARGUMENT,"Must provide projectId");this.w_=new Pi(s.projectId,s.database),this.mf="[DEFAULT]",this.Tf=new jf}this.Ef=new Xd({})}function fv(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new Rr(Or.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else ui("settings","non-empty string","host",t.host),this.host=t.host,ai("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(vi("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),ai("settings","object","credentials",t.credentials),this.credentials=t.credentials,ai("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),ai("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?Cr("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Cr("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,ai("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Xc.lo;else{if(t.cacheSizeBytes!==Yd&&t.cacheSizeBytes<Xc.ho)throw new Rr(Or.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Xc.ho);this.cacheSizeBytes=t.cacheSizeBytes}ai("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.experimentalForceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}function lv(t,e,n,r,i){this.U=t,this.timestampsInSnapshots=e,this.X_=n,this.Z_=r,this.tf=i}function pv(t,e,n){if("string"==typeof n){if(""===n)throw new Rr(Or.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Wu(e)&&-1!==n.indexOf("/"))throw new Rr(Or.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Kr.P(n));if(!Xr.F(r))throw new Rr(Or.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return $o(t,new Xr(r))}if(n instanceof hd)return $o(t,n.m_);throw new Rr(Or.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+pi(n)+".")}function dv(t,e){if(!Array.isArray(t)||0===t.length)throw new Rr(Or.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Rr(Or.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if("in"===e||"array-contains-any"===e){if(0<=t.indexOf(null))throw new Rr(Or.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new Rr(Or.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")}}function vv(t,e,n){if(!n.isEqual(e))throw new Rr(Or.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function yv(t){if(zu(t)&&0===t.rn.length)throw new Rr(Or.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var gv,mv=(Tv.prototype.where=function(t,e,n){ni("Query.where",arguments,3),di("Query.where",3,n);var r,i,o=hi("Query.where",["<","<=","==","!=",">=",">","array-contains","in","array-contains-any","not-in"],2,e),s=Ud("Query.where",t),u=function(t,e,n,r,i,o,s){var u;if(i.p()){if("array-contains"===o||"array-contains-any"===o)throw new Rr(Or.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){dv(s,o);for(var a=[],c=0,h=s;c<h.length;c++){var f=h[c];a.push(pv(r,t,f))}u={arrayValue:{values:a}}}else u=pv(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||dv(s,o),u=Od(n,e,s,"in"===o||"not-in"===o);var l=ia.create(i,o,u);return function(t,e){if(e.un()){var n=Hu(t);if(null!==n&&!n.isEqual(e.field))throw new Rr(Or.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=Gu(t);null!==r&&vv(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(0<=e.indexOf(i.op))return i.op}return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==i)throw i===e.op?new Rr(Or.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new Rr(Or.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(this.Mf,"Query.where",this.firestore.If,this.firestore.w_,s,o,n);return new Tv((r=this.Mf,i=r.filters.concat([u]),new Cu(r.path,r.collectionGroup,r.rn.slice(),i,r.limit,r.on,r.startAt,r.endAt)),this.firestore,this.T_)},Tv.prototype.orderBy=function(t,e){var n;if(ii("Query.orderBy",arguments,1,2),si("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new Rr(Or.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}var r,i,o=Ud("Query.orderBy",t),s=function(t,e,n){if(null!==t.startAt)throw new Rr(Or.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Rr(Or.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,i,o,s=new ka(e,n);return i=s,null!==Gu(r=t)||null!==(o=Hu(r))&&vv(0,o,i.field),s}(this.Mf,o,n);return new Tv((r=this.Mf,i=r.rn.concat([s]),new Cu(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.on,r.startAt,r.endAt)),this.firestore,this.T_)},Tv.prototype.limit=function(t){return ni("Query.limit",arguments,1),oi("Query.limit","number",1,t),gi("Query.limit",1,t),new Tv(Yu(this.Mf,t,"F"),this.firestore,this.T_)},Tv.prototype.limitToLast=function(t){return ni("Query.limitToLast",arguments,1),oi("Query.limitToLast","number",1,t),gi("Query.limitToLast",1,t),new Tv(Yu(this.Mf,t,"L"),this.firestore,this.T_)},Tv.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ri("Query.startAt",arguments,1);var r=this.Of("Query.startAt",t,e,!0);return new Tv(Xu(this.Mf,r),this.firestore,this.T_)},Tv.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ri("Query.startAfter",arguments,1);var r=this.Of("Query.startAfter",t,e,!1);return new Tv(Xu(this.Mf,r),this.firestore,this.T_)},Tv.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ri("Query.endBefore",arguments,1);var r=this.Of("Query.endBefore",t,e,!0);return new Tv(Ju(this.Mf,r),this.firestore,this.T_)},Tv.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ri("Query.endAt",arguments,1);var r=this.Of("Query.endAt",t,e,!1);return new Tv(Ju(this.Mf,r),this.firestore,this.T_)},Tv.prototype.isEqual=function(t){if(!(t instanceof Tv))throw yi("isEqual","Query",1,t);return this.firestore===t.firestore&&Zu(this.Mf,t.Mf)&&this.T_===t.T_},Tv.prototype.withConverter=function(t){return new Tv(this.Mf,this.firestore,t)},Tv.prototype.Of=function(h,t,e,n){if(di(h,1,t),t instanceof nv)return ni(h,s([t],e),1),function(t,e,n,r){if(!n)throw new Rr(Or.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+h+"().");for(var i=[],o=0,s=Ku(t);o<s.length;o++){var u=s[o];if(u.field.p())i.push($o(e,n.key));else{var a=n.field(u.field);if(qo(a))throw new Rr(Or.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){var c=u.field.R();throw new Rr(Or.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+c+"' (used as the orderBy) does not exist.")}i.push(a)}}return new _a(i,r)}(this.Mf,this.firestore.w_,t.xf,n);var r=[t].concat(e);return function(t,e,n,r,i,o){var s=t.rn;if(i.length>s.length)throw new Rr(Or.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.p()){if("string"!=typeof c)throw new Rr(Or.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Wu(t)&&-1!==c.indexOf("/"))throw new Rr(Or.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Kr.P(c));if(!Xr.F(h))throw new Rr(Or.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var f=new Xr(h);u.push($o(e,f))}else{var l=Od(n,r,c);u.push(l)}}return new _a(u,o)}(this.Mf,this.firestore.w_,this.firestore.If,h,r,n)},Tv.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];ii("Query.onSnapshot",arguments,1,4);var s,u={},a=0;"object"!=typeof i[a]||Hd(i[a])||(vi("Query.onSnapshot",u=i[a],["includeMetadataChanges"]),ai("Query.onSnapshot","boolean","includeMetadataChanges",u.includeMetadataChanges),a++),Hd(i[a])?(s=i[a],i[a]=null===(t=s.next)||void 0===t?void 0:t.bind(s),i[a+1]=null===(e=s.error)||void 0===e?void 0:e.bind(s),i[a+2]=null===(n=s.complete)||void 0===n?void 0:n.bind(s)):(oi("Query.onSnapshot","function",a,i[a]),si("Query.onSnapshot","function",a+1,i[a+1]),si("Query.onSnapshot","function",a+2,i[a+2]));var c={next:function(t){i[a]&&i[a](new wv(r.firestore,r.Mf,t,r.T_))},error:i[a+1],complete:i[a+2]};return yv(this.Mf),this.firestore.ff().listen(this.Mf,u,c)},Tv.prototype.get=function(t){var e=this;ii("Query.get",arguments,0,1),Av("Query.get",t),yv(this.Mf);var n=this.firestore.ff();return(t&&"cache"===t.source?n.z_(this.Mf):n.H_(this.Mf,t)).then(function(t){return new wv(e.firestore,e.Mf,t,e.T_)})},Tv),wv=(Object.defineProperty(Iv.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(Iv.prototype,"empty",{get:function(){return this.Bf.docs.m()},enumerable:!1,configurable:!0}),Object.defineProperty(Iv.prototype,"size",{get:function(){return this.Bf.docs.size},enumerable:!1,configurable:!0}),Iv.prototype.forEach=function(e,n){var r=this;ii("QuerySnapshot.forEach",arguments,1,2),oi("QuerySnapshot.forEach","function",1,e),this.Bf.docs.forEach(function(t){e.call(n,r.Qf(t,r.metadata.fromCache,r.Bf.Qt.has(t.key)))})},Object.defineProperty(Iv.prototype,"query",{get:function(){return new mv(this.Lf,this.vf,this.T_)},enumerable:!1,configurable:!0}),Iv.prototype.docChanges=function(t){t&&(vi("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),ai("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Bf.jt)throw new Rr(Or.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.qf&&this.Uf===e||(this.qf=function(i,e,o){if(i.Ut.m()){var n=0;return i.docChanges.map(function(t){var e=o(t.doc,i.fromCache,i.Qt.has(t.doc.key));return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var s=i.Ut;return i.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=o(t.doc,i.fromCache,i.Qt.has(t.doc.key)),n=-1,r=-1;return 0!==t.type&&(n=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(r=(s=s.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Fr()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.Bf,e,this.Qf.bind(this)),this.Uf=e),this.qf},Iv.prototype.isEqual=function(t){if(!(t instanceof Iv))throw yi("isEqual","QuerySnapshot",1,t);return this.vf===t.vf&&Zu(this.Lf,t.Lf)&&this.Bf.isEqual(t.Bf)&&this.T_===t.T_},Iv.prototype.Qf=function(t,e,n){return new rv(this.vf,t.key,t,e,n,this.T_)},Iv),bv=(o(Ev,gv=mv),Object.defineProperty(Ev.prototype,"id",{get:function(){return this.Mf.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(Ev.prototype,"parent",{get:function(){var t=this.Mf.path.h();return t.m()?null:new tv(new Xr(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(Ev.prototype,"path",{get:function(){return this.Mf.path.R()},enumerable:!1,configurable:!0}),Ev.prototype.doc=function(t){ii("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=bi.k()),oi("CollectionReference.doc","non-empty string",1,t);var e=Kr.P(t);return tv.Vf(this.Mf.path.child(e),this.firestore,this.T_)},Ev.prototype.add=function(t){ni("CollectionReference.add",arguments,1);var e=this.T_?this.T_.toFirestore(t):t;oi("CollectionReference.add","object",1,e);var n=this.doc();return new tv(n.m_,this.firestore,null).set(e).then(function(){return n})},Ev.prototype.withConverter=function(t){return new Ev(this.Wf,this.firestore,t)},Ev);function Ev(t,e,n){var r=this;if(((r=gv.call(this,qu(t),e,n)||this).Wf=t).length%2!=1)throw new Rr(Or.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.R()+" has "+t.length);return r}function Iv(t,e,n,r){this.vf=t,this.Lf=e,this.Bf=n,this.T_=r,this.qf=null,this.Uf=null,this.metadata=new ev(n.hasPendingWrites,n.fromCache)}function Tv(t,e,n){this.Mf=t,this.firestore=e,this.T_=n}function _v(t,e){if(void 0===e)return{merge:!1};if(vi(t,e,["merge","mergeFields"]),ai(t,"boolean","merge",e.merge),void 0!==(n=e.mergeFields)&&function(t,e,n,r){if(!(n instanceof Array))throw new Rr(Or.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+pi(n));for(var i=0;i<n.length;++i)if(!r(n[i]))throw new Rr(Or.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+pi(n[i]))}(t,"mergeFields",n,function(t){return"string"==typeof t||t instanceof Vp}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Rr(Or.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function Nv(t,e){return void 0===e?{}:(vi(t,e,["serverTimestamps"]),ci(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Av(t,e){si(t,"object",1,e),e&&(vi(t,e,["source"]),ci(t,0,"source",e.source,["default","server","cache"]))}function Sv(t,e,n){if(e instanceof hd){if(e.firestore!==n)throw new Rr(Or.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw yi(t,"DocumentReference",1,e)}function Dv(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var xv,Ov={Firestore:Jd,GeoPoint:ad,Timestamp:Ci,Blob:Li,Transaction:Zd,WriteBatch:$d,DocumentReference:tv,DocumentSnapshot:nv,Query:mv,QueryDocumentSnapshot:rv,QuerySnapshot:wv,CollectionReference:bv,FieldPath:Vp,FieldValue:sd,setLogLevel:Jd.setLogLevel,CACHE_SIZE_UNLIMITED:Yd};(xv=r.default).INTERNAL.registerComponent(new Sr("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),r=new Up,i=new Pp(r),new Jd(e,n,i,r);var e,n,r,i},"PUBLIC").setServiceProps(Object.assign({},Ov))),xv.registerVersion("@firebase/firestore","1.17.0")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
